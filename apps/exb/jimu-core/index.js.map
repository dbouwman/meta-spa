{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./jimu-core/lib/layouts/utils.ts","webpack:///./jimu-core/lib/layouts/types.ts","webpack:///./jimu-core/lib/layouts/layout-item.tsx","webpack:///./jimu-core/lib/app-actions.ts","webpack:///./jimu-core/lib/store.ts","webpack:///./jimu-core/lib/extension-spec/extension-spec.ts","webpack:///./jimu-core/lib/types/constants.ts","webpack:///./jimu-core/lib/extension-manager.tsx","webpack:///./jimu-core/lib/layouts/actions/global-layout-actions.ts","webpack:///./jimu-core/lib/utils/app-config.ts","webpack:///./jimu-core/lib/layouts/action-context.ts","webpack:///./jimu-core/lib/layouts/default-common-setting.ts","webpack:///./jimu-core/lib/utils/utils.ts","webpack:///./jimu-core/lib/amd-loader.ts","webpack:///./jimu-core/lib/session-manager.tsx","webpack:///./jimu-core/lib/browser-history.tsx","webpack:///./jimu-core/lib/widget-manager.tsx","webpack:///./jimu-core/lib/layouts/global-layout-redux-store-extension.ts","webpack:///./jimu-core/lib/app-builder-sync.ts","webpack:///./jimu-core/lib/layouts/layout-factory.tsx","webpack:///./jimu-core/lib/layouts/react-dnd-resizable.tsx","webpack:///./jimu-core/lib/layouts/react-dnd-types.ts","webpack:///./jimu-core/lib/layouts/section-layout/layout.tsx","webpack:///./jimu-core/lib/layouts/sidebar-layout/default-sidebar-setting.ts","webpack:///./jimu-core/lib/layouts/sidebar-layout/layout.tsx","webpack:///./jimu-core/lib/layouts/fixed-layout/style/layout.scss?c43f","webpack:///./jimu-core/lib/layouts/fixed-layout/default-setting.ts","webpack:///./jimu-core/lib/layouts/grid-layout/style/grid.scss?acc5","webpack:///./jimu-core/lib/layouts/grid-layout/grid-utils.ts","webpack:///./jimu-core/lib/layouts/grid-layout/default-setting.ts","webpack:///./jimu-core/lib/layouts/react-dnd-draggable.tsx","webpack:///./jimu-core/lib/message-manager.tsx","webpack:///./jimu-core/lib/utils/url-utils.ts","webpack:///./jimu-core/lib/data-source/base-types.ts","webpack:///./jimu-core/lib/data-source-manager.tsx","webpack:///./jimu-core/lib/base-widget.tsx","webpack:///./jimu-core/lib/types/app-config.ts","webpack:///./jimu-core/lib/i18n-manager.ts","webpack:///./jimu-core/lib/message/base-types.ts","webpack:///./jimu-core/lib/layouts/fixed-layout/layout-viewer.tsx","webpack:///./jimu-core/lib/layouts/grid-layout/layout-viewer.tsx","webpack:///./jimu-core/lib/layouts/layout-viewer-entry.tsx","webpack:///./jimu-core/lib/layouts/global-action-utils.ts","webpack:///./jimu-core/lib/layouts/reducers/global-reducers.ts","webpack:///./jimu-core/lib/layouts/sidebar-layout/sidebar-layout-util.ts","webpack:///./jimu-core/lib/layouts/sidebar-layout/style/sidebar-layout.scss","webpack:///./jimu-core/lib/layouts/sidebar-layout/style/sidebar-layout.scss?9d67","webpack:///./jimu-core/lib/layouts/sidebar-layout/style/sidebar.scss","webpack:///./jimu-core/lib/layouts/sidebar-layout/style/sidebar.scss?189a","webpack:///./jimu-core/lib/layouts/sidebar-layout/sidebar.tsx","webpack:///./jimu-core/lib/layouts/fixed-layout/style/layout.scss","webpack:///./jimu-core/lib/layouts/fixed-layout/fixed-layout-util.ts","webpack:///./jimu-core/lib/layouts/fixed-layout/layout.tsx","webpack:///./jimu-core/lib/layouts/grid-layout/style/grid.scss","webpack:///./jimu-core/lib/layouts/style/layout-item.scss","webpack:///./jimu-core/lib/layouts/style/layout-item.scss?48cb","webpack:///./jimu-core/lib/layouts/style/images/settings.svg","webpack:///./jimu-core/lib/layouts/style/images/delete.svg","webpack:///./jimu-core/lib/layouts/style/widget.scss","webpack:///./jimu-core/lib/layouts/style/widget.scss?8a6c","webpack:///./jimu-core/lib/layouts/widget-renderer.tsx","webpack:///./jimu-core/lib/layouts/style/handle.scss","webpack:///./jimu-core/lib/layouts/style/handle.scss?b201","webpack:///./jimu-core/lib/layouts/grid-layout/layout.tsx","webpack:///./jimu-core/lib/layouts/layout-entry.tsx","webpack:///./jimu-core/lib/config-manager.tsx","webpack:///./jimu-core/lib/app-root-component.tsx","webpack:///./jimu-core/lib/app-reducer.ts","webpack:///./jimu-core/lib/app-root.tsx","webpack:///./jimu-core/index.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","1","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Immutable","invariant","types_1","generateLayoutStructure","layoutId","layouts","layoutMap","isImmutable","rootLayoutId","simpleLayoutMap","keys","forEach","isNaN","parseInt","node","parentId","updatedLayoutMap","visit","rootId","set","content","id","update","concat","toRatio","total","Math","round","fromRatio","ratio","adjustHorizontal","pos","width","alignCenter","hPriority","x","y","w","h","max","adjustVertical","height","vPriority","emptyFunc","perc","num","clamp","min","autoBindHandlers","el","fns","setTransform","translate","transform","WebkitTransform","MozTransform","msTransform","OTransform","position","isStaticLayout","layout","setting","static","isActiveLayout","active","getSectionLayout","appConfig","info","layoutItemId","widthInPixel","heightInPixel","getMaximumId","setNextNodeId","nextId","randomColor","floor","random","getLayoutItem","len","validateLayoutType","type","LayoutType","SIDEBAR_LAYOUT","FIXED_LAYOUT","GRID_LAYOUT","WIDGET","SECTION_LAYOUT","UNKNOWN","useInteract","jimuConfig","isInBuilder","calPixelPosition","xyInPixel","gridSize","calLayoutPosition","restrict","Infinity","AttachType","OrderAdjustType","CompactType","React","classNames","layout_factory_1","utils_1","widget_renderer_1","action_context_1","constants_1","LayoutItem","_super","_this","this","arguments","state","hasFocus","__extends","_onMouseEnter","setState","_onMouseLeave","render","layoutNode","_a","props","style","className","appMode","createElement","default","widgetId","isRegistered","LayoutFactory","createLayout","isViewerRegistered","createLayoutViewer","focused","AppMode","Run","mergedStyle","__assign","mergedClassNames","has-focus","ActionContext","Consumer","actions","data-layoutitemid","data-layoutid","onClick","e","Design","preventDefault","stopPropagation","activate","onMouseEnter","onMouseLeave","PureComponent","ActionKeys","appConfigLoaded","AppConfigLoaded","appConfigChanged","appConfigDiff","AppConfigChanged","widgetClassLoaded","WidgetClassLoaded","openWidget","OpenWidget","closeWidget","CloseWidget","initAppContext","appContext","AppContextInit","jimuCoreNlsLoaded","nls","JimuCoreNlsLoaded","queryObjectChanged","query","QueryObjectChanged","setAppInBuilder","SetAppInBuilder","appModeChanged","AppModeChanged","toggleWidgetHighlight","isHighlight","ToggleWidgetHighLight","layoutClassLoaded","layoutName","LayoutClassLoaded","dataSourceStatusChanged","dataSourceId","status","DataSourceStatusChanged","initStoreExtensionState","InitStoreExtensionState","widgetStatePropChange","propKey","WidgetStatePropChange","initPortalUrl","portalUrl","InitPortalUrl","dataSourceCurrentIndexesChanged","indexes","DataSourceCurrentIndexesChanged","currentIndexes","sessionStart","token","SessionStart","userSignIn","user","UserSignIn","userSignOut","UserSignOut","isMobileChanged","isMobile","IsMobileChanged","setWidgetIsSettingState","isSetting","SetWidgetIsSettingState","app_reducer_1","redux_1","store","createStore","__REDUX_DEVTOOLS_EXTENSION__","ExtensionPoints","EP_SUPPORT_MULTIPLE_EXTENTIONS","ReduxStore","DataSourceFactory","DummyExtension","AjaxState","app_config_1","amd_loader_1","extension_spec_1","ExtensionManager","extensions","extensionClasses","getInstance","instance","_extensionManager","getExtensions","epName","onStoreChange","registerExtension","extInfo","getExtensionById","extension","console","log","indexOf","sort","a","b","index","registerAllWidgetExtensions","extPromises","getAllWidgets","registerWidgetExtensions","Promise","all","clean","widgetJson","manifest","extentions","ext","registerWidgetExtension","extensionProps","point","resolve","filter","loadWidgetExtensionClass","then","ExtClass","extName","uri","context","amdFolder","amdRequire","ExtensionClass","extId","GlobalLayoutActions","updateLayout","layoutInfo","newSetting","UPDATE_LAYOUT","updateSetting","UPDATE_SETTING","addLayout","ADD_LAYOUT","removeLayout","REMOVE_LAYOUT","resizeLayouts","breakpoint","RESIZE_LAYOUTS","dndLayout","parentLayoutInfo","newPosition","DRAG_DROP_LAYOUT","ACTIVATE","removeWidget","REMOVE_WIDGET","addWidget","ADD_WIDGET","addSection","sectionId","ADD_SECTION","removeSection","REMOVE_SECTION","changeOrder","orderType","CHANGE_ORDER","getWidgetContext","test","folderUrl","toUrl","isRemote","addThemeManifestProperies","panels","panel","styles","icon","RTLIcon","addWidgetManifestProperties","properties","addWidgetDefaultLabelAndIcon","label","widgets","wId","getWidgetsByName","widgetName","getCleanAppConfig","config","asMutable","deep","wid","getContainerInfoByLayoutId","ContainerType","some","cType","cId","containerType","containerId","getWidgetContainerInfo","ctn","getWidgetContainerIdByContainerType","getSectionContainerInfo","sections","getSectionContainerIdByContainerType","getUniqueId","k","substring","getUniqueLabel","getAppConfigDiff","oldConfig","newConfig","diff","removedWidgets","oldWId","createContext","DEFAULT_LAYOUT_SETTING","draggable","resizable","droppable","isDeepEqual","getCallbackNames","prevState","logShallowDiff","obj","preObj","hasDiff","group","groupEnd","pre","cur","isEqual","getWidgetCallbackNamesFromWidgetState","widgetState","prevWidgetState","getPanelCallbackNamesFromPanelState","panelState","prevPanelState","isMobileBrowser","isMobileSize","size","loadstyle","url","beforeId","containerNode","document","getElementById","getElementsByTagName","cssNode","setAttribute","onload","appendChild","applyMixins","derivedCtor","baseCtors","baseCtor","getOwnPropertyNames","getDataSourceInfosFromQueryObject","queryObject","dsInfo","split","ds","dsId","moduleObj","arcgis_rest_auth_1","arcgis_rest_request_1","app_actions_1","Cookies","store_1","SessionManager","_setSession","session","localStorageKey","_session","dispatch","localStorage","setItem","serialize","getUser","_clearSession","removeItem","getPortalUrl","getState","getSession","initFromCookie","cookie","cookieJson","JSON","parse","portal","urlKey","customBaseUrl","UserSession","clientId","tokenExpires","Date","expires","username","email","initFromLocalStorage","serializedSession","getItem","deserialize","initFromCredential","credential","fromCredential","signIn","provider","hubConfig","hub","hubCommunityPortalUrl","community","oauth2Options","redirectUri","location","origin","popup","beginOAuth2","newSession","_retry","handleAuthError","error","originalRequestOptions","options","ArcGISAuthError","authentication","_retryPromise","retry","signOut","signoutUrl","encodeURIComponent","toString","href","history_1","History","queryString","url_utils_1","Location","browserHistory","createBrowserHistory","listen","action","storeQo","search","locationQo","HistoryContext","changeQueryObject","replace","qo","merge","loc","createLocation","stringify","createHref","currentLocation","to","toLocation","parsePath","isAbsoluteUrl","pathname","charAt","substr","HistoryProvider","Provider","children","withHistory","Component","history","changePage","pageId","page","changeView","viewId","views","vId","join","react_redux_1","i18n_manager_1","extension_manager_1","base_widget_1","data_source_manager_1","session_manager_1","WidgetManager","widgetRawClasses","widgetClasses","dependencyResources","_widgetManager","getWidgetClass","deleteWidgetClass","loadWidgetClass","loadRawClass","classInfo","_WidgetClass","WidgetClass","isDojoWidget","appWidgetClassWrapperExtension","WidgetContextClass","injectWidgetProps","wrapWidgetClass","clazz","widgetClass","loadWidgetDependency","hasLocale","loadWidgetNls","WidgetClassWrapper","Error","wrap","handleNewWidgetJson","loadWidgetManifest","loadWidgetConfig","widgetConfig","fetch","res","json","code","reject","widgetNls","i18nLabels","locale","_widgetLabel","tryLoadWidgetConfig","upgradeWidgetConfig","widgetVersion","version","configVersion","hasVersionManager","VersionManager","versionManager","getVersionIndex","upgrade","err","stack","hasConfig","loadNls","dependency","DependencyDefine","resources","getDependencyKey","getResources","newResources","cssResources","jsResources","map","WrappedComponent","nlsStrings","WidgetWrapper","dsManager","dataSources","onSignIn","onSignOut","componentDidMount","useDataSources","getDataSource","createDataSource","injectProps","displayName","connect","runtimeInfo","widgetsRuntimeInfo","dataSourcesInfo","isBuilder","appState","allOwnProps","assign","mapExtraStateProps","global_reducers_1","global_layout_actions_1","GlobalLayoutReduxStoreExtension","getActions","getInitLocalState","0","getReducer","globalLayoutReducer","getStoreKey","browser_history_1","widget_manager_1","pubsub","top","_builderPubsub","publishEventToBuilder","publish","listenBuilderEvents","subscribe","evt","layoutContent","publishAppStateChangeToBuilder","publishCurrentEditWidgetChangeToBuilder","publishRemoveWidgetToBuilder","letBuilderPopupChooseWidget","publishWidgetConfigChangeToBuilder","components","viewComponents","registerLayout","itemClass","registerLayoutViewer","LayoutElement","actionContext","hoistNonReactStatic","react_rnd_1","WrapperComponent","ResizableComponent","deltaSize","deltaPos","isResizing","_enableResizing","left","right","bottom","disableInteract","topRight","bottomRight","bottomLeft","topLeft","_onResizeStop","dir","refToElement","delta","onResizeEnd","_onResize","onResizing","_onResizeStart","onResizeStart","minHeight","minWidth","maxHeight","maxWidth","resizeGrid","passThroughProps","__rest","_b","displayPos","enableResizing","_actionHandlers","isActive","mergedClass","disableDragging","onResize","onResizeStop","resizeHandleStyles","_getLayoutId","handlers","getDisplayName","DND_TYPES","layout_item_1","SectionLayout","_getCurrentLayoutId","section","viewId_1","view","mobileTheresholdSize","mobileLayoutCompact","mobileLayout","desktopThresholdSize","desktopLayoutCompact","sectionLayout","data-sectionid","defaultProps","default_common_setting_1","DEFAULT_SIDEBAR_SETTING","overlay","togglable","toggleOn","react_dnd_resizable_1","sidebar_1","utils","SidebarLayoutPrototype","resizingSide","interactComponent","onToggleChange","_onItemToggleChange","Sidebar","sideLayouts","collectSidebars","getDerivedStateFromProps","nextProps","targetLayout","layoutItem","attach","_onResizing","dw","dh","_onResizeEnd","positionMap","calculatePosition","LEFT","RIGHT","TOP","BOTTOM","results","toggle","_createSidebar","direction","horizontal","ResizableSidebar","undefined","main","header","footer","SidebarLayout","locals","DEFAULT_FIX_LAYOUT_SETTING","order","bottomY","collides","l1","l2","p1","p2","compact","compactType","cols","compareWith","getStatics","sorted","sortLayoutItems","out","Array","idx","compactItem","heightWidth","resolveCompactionCollision","item","moveToCoord","axis","sizeProp","setIn","itemIndex","otherItem","fullLayout","VERTICAL","getFirstCollision","HORIZONTAL","correctBounds","collidesWith","getAllCollisions","moveElement","isUserAction","preventCollision","oldX","oldY","reverse","collisions","collision","moved","moveElementAwayFromCollision","itemToMove","compactH","compactV","fakeItem","sortLayoutItemsByColRow","sortLayoutItemsByRowCol","sortBreakpoints","breakpoints","synchronizeLayoutWithChildren","initialLayouts","getBreakpointFromWidth","matching","breakpointName","getColsFromBreakpoint","generateResponsiveLayout","collectLayoutsAtBreakpoint","breakpointsSorted","breakpointsAbove","imLayout","toGridPosition","numOfCols","colWidth","space","rowHeight","toPixelPosition","resizingPos","draggingPos","padding","DEFAULT_GRID_LAYOUT_SETTING","lg","md","sm","xs","xxs","react_dnd_1","react_dnd_types_1","DraggableComponent","isDragging","connectDragSource","placeholderStyle","backgroundColor","outline","boxShadow","onMoveStart","onMoving","onMoveEnd","DragSource","LAYOUT","beginDrag","endDrag","monitor","offset","getDifferenceFromInitialOffset","canDrag","dragSource","MessageManager","messageActions","messageActionClasses","_messageManager","createMessageActions","actionPromises","createMessageAction","actionProp","loadMessageActionClass","ActionClass","publishMessage","message","messagesConfig","messages","matchMessageCfg","messageType","actionJson","actionName","filterMessage","onExecute","path","hash","hashIndex","searchIndex","DataSourceStatus","AbstractDataSource","isDataSourceSet","records","updateStatus","dataSourceManager","onDataSourceStatusChanged","getRecords","getCurrentRecord","getCurrentRecords","getCurrentRecordIndexes","nextRecord","warn","prevRecord","findRecord","clearData","destroy","DataSourceTypes","base_types_1","hub_annotations_1","supportDataSourceTypes","HubAnnotations","HubAnnotationDataRecord","feature","getData","attributes","HubAnnotationsDataSource","dsConfig","init","Unloaded","LoadedLoading","UnloadedLoading","searchAnnotations","response","included","find","u","author","Loaded","selectRecord","onDataSourceCurrentIndexesChanged","addRecord","record","adds","addAnnotations","objectId","addResults","OBJECTID","addAnnotation","description","target","feature_id","source","getDataSchema","DataSourceManager","_dataSourceManager","destroyDataSource","createAllDataSources","dsJson","dsObj","createHubAnnotationsDataSource","dsFactory","f","getSupportDataSourceTypes","urlDs","oldDs","newDs","added","od","oId","BaseWidget","showDiffLog","onOpen","onClose","onActive","onDeActive","componentDidUpdate","prevProps","fn","isArray","I18NManager","nlsModle","rootNls","root","segs","folder","file","localeNls","MessageType","StringSelectionChangeMessage","str","StringSelectionChange","FeatureSelectionChangeMessage","FeatureSelectionChange","MessageAction","DummyMessageAction","filterMessageType","actionConfig","default_setting_1","FixedLayoutViewer","_processLayoutItem","gridUtils","GridLayoutViewer","activeDrag","pixelLayouts","gridLayouts","layoutSetting","colNo","containerHeight","autoSize","nbRow","processGridItem","mergedClassName","ReactRedux","layout_viewer_1","layout_viewer_2","layout_1","layout_2","global_layout_redux_store_extension_1","JimuLayoutViewer","layoutPos","margin","findRootLayout","filterMainAreaFromSidebar","updatedLayouts","mergedSetting","mergedPos","findDescendantIdArray","childrenIdArray","findDescendants","rootLayout","newLayout","removeDescendants","itemId","without","newLayouts","activeLayout","updatedLayout","parentLayout","nextId_1","fromLayoutMap_1","toLayoutMap_1","idBeforeMove","changeLayoutOrder","siblings","targetIndex","temp","BRING_FORWARD","SEND_BACKWARD","BRING_TO_FRONT","SEND_TO_BACK","defaultState","default_sidebar_setting_1","occupySpace","layoutsQueryObject","param","items","visible","toggleItem","toggle-on","toggle-off","layoutArray","imLayoutItem","react_dnd_draggable_1","fixedUtils","InteractItem","FixedLayoutPrototype","domNode","ref","clientRect","getBoundingClientRect","_getFixedPosOfLayoutItem","itemSetting","_onItemResizeEnd","newPos","relativePos","layoutWidth","layoutHeight","_calLayoutSize","containerWidth","connectDropTarget","isOver","draggingItem","sortedLayouts","isDropTaget","mergedClasses","drop-target","spec","drop","component","didDrop","snapX","snapY","snapW","snapH","clientOffset","getSourceClientOffset","FixedLayout","DropTarget","dropTarget","shallow","escape","app_builder_sync_1","WidgetRendererComponent","showSettings","isClassLoaded","showSetting","Config","hideSetting","WidgetClass_1","data-widgetid","ownProps","GridLayoutPrototype","layoutSetting_1","colWidth_1","breakpointLayouts","pixelLayouts_1","gridLayouts_1","_onItemResize","pixelLayout","moveToPosition","newPixelLayouts","newGridLayouts","dPos","imPos","GridLayout","react_dnd_html5_backend_1","layout_3","layout_4","global_layout_redux_store_extension_2","JimuLayout","layoutActions","_isInDesignMode","connectedLayoutEntry","DragDropContext","SeamlessImmutable","message_manager_1","arcgis_rest_items_1","ConfigManager","loadAppConfig","loadRawAppConfig","processAppConfigAfterLoad","loadAllWidgetsManifest","addDefaultLabelAndIcon","loadAndUpgradeAllWidgetsConfig","applyAppConfigProcessorExtension","createAllWidgetMessageActions","setDocumentTitle","title","Preview","AppConfigService","loadAppConfigWithDefault","loadAppConfigFromPortal","configUrl","appId","sessionManager","getItemData","catch","AppConfigProcessor","process","promises","manifests","addWidgetContext","addDefaultValues","uriInfo","sharedArea","leftArea","rightArea","defaultAppLayout","__app_layout","2","3","4","ReactDOM","debounce","config_manager_1","layout_entry_1","layout_viewer_entry_1","utils_2","AppRootComponent","rootRef","createRef","mounted","_debouncedResize","updateDimensions","addEventListener","rect","current","componentWillUnmount","removeEventListener","windowWidth","innerWidth","documentElement","clientWidth","body","windowHeight","innerHeight","clientHeight","_prepareLayout","display","justifyContent","alignItems","pages","pageBodyLayout","sa","saLayoutId","saLayout","filterSaLayout","handleSharedArea","filterLayouts","pageLayout_1","preparePageLayout","skin","skinsFolder","createPortal","rel","head","pageJson","renderPageLayout","INIT_STATE","jimuCoreNls","initState","storeExt","storeKeySegs","getIn","handleAppConfigChange","handleQueryObjectChange","windowState","handleWidgetClassLoaded","handleOpenWidet","handleCloseWidet","handleWidgetPropChange","localState","dispatchActionToExtension","app_root_component_1","ErrorBoundary","componentDidCatch","AppRoot","seamless_immutable_1","ImmutableObject","ImmutableArray","app_root_1","LayoutInfo","appActions","appBuilderSync","extensionSpec","urlUtils","appConfigUtils","localeIsSame","locale1","locale2","isRTL","isRTLLocale","rtlLocales","__export","appPath","dirNode","setRTL","currentState","_appState","jimuNls"],"mappings":"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","file":"jimu-core/index.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t1: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([285,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import * as Immutable from 'seamless-immutable';\nimport * as invariant from 'invariant';\nimport { Position, Layout, LayoutMap, GlobalLayouts, LayoutType, FixedLayoutSetting } from './types';\nimport { IMAppConfig } from '../types/app-config';\n\nlet unique_node_id = 1;\n\nexport const emptyFunc = () => {};\n\n/**\n * Helper to convert a number to a percentage string.\n *\n * @param  {Number} num Any number\n * @return {String}     That number as a percentage.\n */\nexport function perc(num: number): string {\n  return num * 100 + \"%\";\n}\n\n/**\n * constrain n to the given range via min + max\n *\n * @param n value\n * @param min the minimum value to be returned\n * @param max the maximum value to be returned\n * @returns the clamped value\n * @private\n */\nexport function clamp(n: number, min: number, max: number): number {\n  return Math.min(max, Math.max(min, n));\n};\n\nexport function autoBindHandlers(el: Object, fns: Array<string>): void {\n  fns.forEach(key => (el[key] = el[key].bind(el)));\n}\n\nexport function setTransform(pos: Position): { [key: string]: string } {\n  // Replace unitless items with px\n  const {x, y, h, w} = pos;\n  const translate = `translate(${x}px,${y}px)`;\n  const result: { [key: string]: string } = {\n    transform: translate,\n    WebkitTransform: translate,\n    MozTransform: translate,\n    msTransform: translate,\n    OTransform: translate,\n    width: `${w}px`,\n    height: `${h}px`,\n    position: \"absolute\"\n  };\n  return result;\n}\n\nexport function isStaticLayout(layout: Layout) {\n  return layout.setting && layout.setting.static === true;\n}\n\nexport function isActiveLayout(layout: Layout) {\n  return layout.setting && layout.setting.active === true;\n}\n\n// export function cloneLayoutMap(layoutMap: LayoutMap): {[key: string]: Layout} {\n//   const result = {};\n//   Object.keys(layoutMap).forEach(key => {\n//     const node = layoutMap[key];\n//     invariant(node, `node is undefined with id ${key}`);\n//     result[key] = cloneLayoutItem(node);\n//   });\n//   return result;\n// }\n\n// // flat layout without content\n// export function cloneLayoutItem(layout: Layout): Layout {\n//   return cloneDeep(layout);\n// }\n\nexport function getSectionLayout(layoutId: string, appConfig: IMAppConfig) {\n  if (layoutId) {\n    return generateLayoutStructure(layoutId, appConfig.layouts as GlobalLayouts);\n  }\n  return {\n    info: {\n      layoutId: layoutId,\n      layoutItemId: '10000'\n    },\n    pos: {x:0,y:0,w:100,h:100},\n    setting: {\n      widthInPixel: false,\n      heightInPixel: false\n    }\n  }\n}\n\nexport function getMaximumId(layoutMap: LayoutMap): number {\n  let max = -1;\n  Object.keys(layoutMap).forEach(key => {\n    const id = parseInt(key);\n    if (id > max) {\n      max = id;\n    }\n  });\n  return max;\n}\n\n/**\n * Generate tree-like Layout from LayoutMap instance.\n * @param layoutMap\n */\nexport function generateLayoutStructure(layoutId: string, layouts: GlobalLayouts): Immutable.ImmutableObject<Layout> {\n  // let rootLayout;\n  // const map = cloneLayoutMap(layoutMap);\n  // Object.keys(map).forEach(key => {\n  //   if (isNaN(parseInt(key))) {\n  //     return;\n  //   }\n  //   const node = map[key];\n  //   if (typeof node.parentId === 'undefined') {\n  //     invariant(!rootLayout, `Only one root layout is allowed`);\n  //     rootLayout = node;\n  //   } else {\n  //     const parentNode = map[node.parentId];\n  //     invariant(parentNode, `parent node is undefined with id ${node.parentId}`);\n  //     parentNode.content = parentNode.content || [];\n  //     parentNode.content.push(node);\n  //   }\n  // });\n  // return rootLayout;\n  invariant(layouts[layoutId], `no layout in appConfig with id ${layoutId}`);\n  let layoutMap: LayoutMap = Immutable.isImmutable(layouts[layoutId]) ? layouts[layoutId] as LayoutMap : Immutable(layouts[layoutId]);\n  let rootLayoutId = null, simpleLayoutMap = {};\n  Object.keys(layoutMap).forEach(key => {\n    if (isNaN(parseInt(key))) {\n      return;\n    }\n    const node = layoutMap[key];\n    if (!simpleLayoutMap[key]) {\n      simpleLayoutMap[key] = [];\n    }\n\n    if (typeof node.parentId === 'undefined') {\n      invariant(rootLayoutId === null, `Only one root layout is allowed`);\n      rootLayoutId = key;\n      return;\n    }\n    let parentId = node.parentId;\n    if (layoutMap[parentId]) {\n      // sharedArea may ignore some layout in configuration\n      if (!simpleLayoutMap[parentId]) {\n        simpleLayoutMap[parentId] = [];\n      }\n      simpleLayoutMap[parentId].push(key);\n    }\n  });\n  invariant(rootLayoutId !== null, 'Root layout id missing');\n\n  const updatedLayoutMap = {};\n  const visit = (rootId: string) => {\n    if (simpleLayoutMap[rootId].length === 0) {\n      updatedLayoutMap[rootId] = Immutable(layoutMap[rootId]).set('layoutId', layoutId);\n      return updatedLayoutMap[rootId];\n    }\n    const content = [];\n    simpleLayoutMap[rootId].forEach(id => {\n      content.push(visit(id));\n    });\n    updatedLayoutMap[rootId] = Immutable(layoutMap[rootId])\n      .update('content', value => [].concat(value || [], content))\n      .set('layoutId', layoutId);\n    return updatedLayoutMap[rootId];\n  };\n  visit(rootLayoutId);\n\n  return updatedLayoutMap[rootLayoutId];\n}\n\n\nexport function setNextNodeId(nextId: number) {\n  unique_node_id = nextId;\n}\n\nfunction _getNextNodeId(): string {\n  return `${unique_node_id++}`;\n}\n\n// for testing\nexport function randomColor(): string {\n  const r = Math.floor(Math.random() * 255),\n    g = Math.floor(Math.random() * 255),\n    b  = Math.floor(Math.random() * 255);\n  return `rgba(${r}, ${g}, ${b}, 0.5)`;\n}\n\n/**\n * Get a layout item by ID. Used so we can override later on if necessary.\n *\n * @param  {Array}  layout Layout array.\n * @param  {String} id     ID\n * @return {LayoutItem}    Item at ID.\n */\nexport function getLayoutItem(layout: Array<Layout>, id: string): Layout {\n  layout = layout || [];\n  for (let i = 0, len = layout.length; i < len; i++) {\n    if (layout[i].id === id) {\n      return layout[i];\n    }\n  }\n}\n\nexport function validateLayoutType(type): LayoutType {\n  if (type === LayoutType.SIDEBAR_LAYOUT ||\n    type === LayoutType.FIXED_LAYOUT ||\n    type === LayoutType.GRID_LAYOUT ||\n    type === LayoutType.WIDGET ||\n    type === LayoutType.SECTION_LAYOUT) {\n    return type;\n  }\n  return LayoutType.UNKNOWN;\n}\n\nexport function useInteract() {\n  if (window && window.jimuConfig) {\n    return window.jimuConfig.isInBuilder;\n  }\n  return false;\n}\n\n/* Calculate the position of root layout (entry point of page) and fixed layout */\nfunction toRatio(value: number, total: number) {\n  return Math.round(value * 100 / total);\n}\n\nfunction fromRatio(ratio: number, total: number) {\n  return ratio * total / 100;\n}\n\n/**\n *\n * @param pos in pixel unit\n * @param width\n * @param alignCenter\n * @param hPriority\n */\nexport function adjustHorizontal(pos: Position, width: number,\n  alignCenter?: boolean, hPriority?: 'left' | 'right'): Position {\n  if (alignCenter == null && hPriority == null) {\n    return pos;\n  }\n  let {x, y, w, h} = pos;\n\n  if (alignCenter) {\n    // keep w, adjust x\n    x = (width - w) / 2;\n  } else if (hPriority === 'right') {\n    // pos.x is the distance to the right edge, convert to left\n    x = Math.max(0, width - x - w);\n  }\n  return {x, y, w, h};\n}\n\n/**\n *\n * @param pos in pixel unit\n * @param height\n * @param vPriority\n */\nexport function adjustVertical(pos: Position, height: number, vPriority?: 'top' | 'bottom') {\n  let {x, y, w, h} = pos;\n\n  if (vPriority === 'bottom') {\n    // pos.y is the distance to the bottom edge, convert to top\n    y = Math.max(0, height - y - h);\n  }\n  return {x, y, w, h};\n}\n\nexport function calPixelPosition(pos: Position, width: number, height: number, setting: FixedLayoutSetting) {\n  const { xyInPixel, alignCenter, hPriority, vPriority, widthInPixel, heightInPixel } = setting;\n  const gridSize = setting.gridSize || 1;\n  let {x, y, w, h} = pos;\n  if (!xyInPixel) { // fixed position is in pixel\n    x = Math.round(fromRatio(x, width)/gridSize) * gridSize;\n    y = Math.round(fromRatio(y, height)/gridSize) * gridSize;\n  } else {\n    x = Math.round(x / gridSize) * gridSize;\n    y = Math.round(y / gridSize) * gridSize;\n  }\n\n  if (isNaN(parseInt(`${w}`))) { // w is missing, touches the right edge\n    w = width - x;\n  } else {\n    if (!widthInPixel) {\n      w = Math.round(fromRatio(w, width)/gridSize) * gridSize;\n    } else {\n      w = Math.round(w / gridSize) * gridSize;\n    }\n  }\n  if (isNaN(parseInt(`${h}`))) { // h is missing, touches the bottom edge\n    h = height - y;\n  } else {\n    if (!heightInPixel) {\n      h = Math.round(fromRatio(h, height)/gridSize) * gridSize;\n    } else {\n      h = Math.round(h / gridSize) * gridSize;\n    }\n  }\n\n  return adjustVertical(adjustHorizontal({x, y, w, h}, width, alignCenter, hPriority),\n    height, vPriority);\n}\n\nexport function calLayoutPosition(pos: Position, width: number, height: number, setting: FixedLayoutSetting) {\n  let {x, y, w, h} = pos;\n  const { xyInPixel, widthInPixel, heightInPixel, restrict } = setting;\n\n  if (restrict) {\n    x = Math.max(0, x), y = Math.max(0, y);\n    if (x + w >= width) {\n      x = width - w;\n      w = Infinity;\n    }\n    if (y + h >= height) {\n      y = height - h;\n      h = Infinity;\n    }\n  }\n\n  if (!xyInPixel) {\n    x = toRatio(x, width);\n    y = toRatio(y, height);\n  }\n  if (!widthInPixel && w !== Infinity) {\n    w = toRatio(w, width);\n  }\n  if (!heightInPixel && h !== Infinity) {\n    h = toRatio(h, height);\n  }\n\n  return { x, y, w, h};\n}","import * as Immutable from 'seamless-immutable';\nimport { AppMode } from '../types/constants';\nexport interface Position {\n  x: number;\n  y: number;\n  w: number;\n  h: number;\n}\n\nexport interface DragResizeEvent {\n  e: Event,\n  node: HTMLElement,\n  posInPixel: Position,\n  posInRatio: Position\n}\n\nexport type DragResizeCallback = (\n  id: string,\n  data: DragResizeEvent\n) => void;\n\nexport const enum LayoutType {\n  UNKNOWN = 'unknown',\n  FIXED_LAYOUT = 'fixed',\n  GRID_LAYOUT = 'grid',\n  WIDGET = 'widget',\n  SIDEBAR_LAYOUT = 'sidebar',\n  SECTION_LAYOUT = 'section',\n  VERTICAL_LAYOUT = 'vertical'\n}\n\nexport interface CommonLayoutSetting {\n  active?: boolean,\n  restrict?: boolean,\n  static?: boolean,\n  draggable?: boolean,\n  resizable?: boolean,\n  droppable?: boolean,\n  xyInPixel?: boolean, // fixed position\n  widthInPixel?: boolean,\n  heightInPixel?: boolean,\n  className?: string,\n  style?: Object\n}\n\nexport interface GridLayoutSetting extends CommonLayoutSetting {\n  compactType?: CompactType,\n  breakpoints?: {[key: string]: number},\n  cols?: {[key: string]: number},\n  padding?: [number, number],\n  space?: number,\n  rowHeight?: number\n}\n\nexport interface FixedLayoutSetting extends CommonLayoutSetting {\n  gridSize?: number,\n  alignCenter?: boolean,\n  order?: number,\n  hPriority?: 'left' | 'right',\n  vPriority?: 'top' | 'bottom'\n}\n\nexport const enum AttachType {\n  TOP = 'top',\n  LEFT = 'left',\n  BOTTOM = 'bottom',\n  RIGHT = 'right'\n}\n\nexport const enum OrderAdjustType {\n  BRING_FORWARD = 0,\n  SEND_BACKWARD = 1,\n  BRING_TO_FRONT = 2,\n  SEND_TO_BACK = 3\n}\n\nexport interface SidebarItemSetting extends CommonLayoutSetting {\n  min?: number;\n  max?: number;\n  overlay?: boolean;\n  togglable?: boolean;\n  toggleOn?: boolean;\n  attach?: AttachType;\n}\n\nexport interface Layout {\n  id: string;\n  parentId?: string;\n  layoutId?: string; // generated dynamically\n  pos: Position;\n  type?: LayoutType;\n  widgetId?: string;\n  sectionId?: string;\n  setting?: GridLayoutSetting | FixedLayoutSetting | SidebarItemSetting;\n  moved?: boolean // flag for grid layout\n  content?: Array<Layout>;\n}\n\nexport interface LayoutProps {\n  pos?: Position;\n  layout?: Layout;\n  displayPosition?: Position;\n  className?: string;\n  style?: Object;\n  appMode?: AppMode;\n}\n\nexport type LayoutMap = Immutable.ImmutableObject<{\n  [key: string]: Layout\n}>; // layout without content\n\nexport type GlobalLayouts = Immutable.ImmutableObject<{[key: string]: {[key: string]: Layout}}>;\n\nexport type ReactDraggableCallbackData = {\n  node: HTMLElement,\n  x: number,\n  y: number,\n  deltaX: number,\n  deltaY: number,\n  lastX: number,\n  lastY: number\n};\n\nexport type EventCallback = (\n  Layout,\n  oldItem?: Layout,\n  newItem?: Layout,\n  placeholder?: Layout,\n  Event?,\n  HTMLElement?\n) => void;\n\nexport const enum CompactType {\n  HORIZONTAL = 'horizontal',\n  VERTICAL = 'vertical',\n  NONE = 'none'\n};\n\nexport interface LayoutActionContext {\n  updateSetting?: (layoutInfo: LayoutInfo, newSetting: Object) => void;\n  addLayout?: (layoutId: string, parentItemId: string, layout: Layout) => void;\n  removeLayout?: (layoutInfo: LayoutInfo) => void;\n  resizeLayouts?: (layouts: Array<Layout>, breakpoint?: string) => void;\n  dndLayout?: (layoutInfo: LayoutInfo, parentInfo: LayoutInfo, newPosition: Position) => void;\n  activate?: (layoutInfo: LayoutInfo) => void;\n  removeWidget?: (widgetId: string) => void;\n  removeSection?: (sectionId: string) => void;\n}\n\nexport interface LayoutInfo{\n  layoutId: string;\n  layoutItemId?: string;\n}","import * as React from 'react';\nimport classNames = require(\"classnames\");\nimport { Layout, LayoutType, Position} from './types';\nimport { LayoutFactory, isRegistered, isViewerRegistered } from './layout-factory';\nimport { useInteract, setTransform, isActiveLayout } from './utils';\nimport WidgetRenderer from './widget-renderer';\nimport { ActionContext } from './action-context';\nimport './style/layout-item.scss';\nimport { AppMode } from '../types/constants';\n\ninterface Props {\n  layout: Layout;\n  appMode: AppMode;\n  pos: Position;\n  className?: string;\n  style?: Object;\n}\n\ninterface State {\n  hasFocus: boolean;\n}\n\nexport class LayoutItem extends React.PureComponent<Props, State> {\n  state = {\n    hasFocus: false\n  }\n\n  _onMouseEnter() {\n    this.setState({\n      hasFocus: true\n    });\n  }\n\n  _onMouseLeave() {\n    this.setState({\n      hasFocus: false\n    });\n  }\n\n  render() {\n    const { pos, layout, style, className, appMode } = this.props;\n    let { x, y, w, h } = pos;\n    let layoutNode;\n    if (layout.type === LayoutType.WIDGET) {\n      layoutNode = <WidgetRenderer layout={layout} widgetId={layout.widgetId}/>;\n    } else {\n      if (useInteract() && isRegistered(layout.type)) {\n        layoutNode = LayoutFactory.createLayout(layout.type, layout, {\n          width: pos.w,\n          height: pos.h,\n          appMode: appMode\n        });\n      } else if (!useInteract() && isViewerRegistered(layout.type)) {\n        layoutNode = LayoutFactory.createLayoutViewer(layout, {\n          width: pos.w,\n          height: pos.h,\n          appMode: appMode\n        });\n      }\n    }\n    const focused = appMode !== AppMode.Run && this.state.hasFocus && layout.type === LayoutType.WIDGET;\n    const mergedStyle = {\n      ...setTransform({x, y, w, h}),\n      ...style,\n      ...(layout.setting && layout.setting.style) || {}\n    };\n    const mergedClassNames = classNames('layout-item',\n      className,\n      layout.setting && layout.setting.className,\n      {'has-focus': focused},\n      {active: isActiveLayout(layout)}\n    );\n    return (\n      <ActionContext.Consumer>\n        {actions => <div data-layoutitemid={layout.id} data-layoutid={layout.layoutId}\n          className={mergedClassNames} style={mergedStyle as any} onClick={(e) => {\n            if (appMode === AppMode.Design) {\n              e.preventDefault();\n              e.stopPropagation();\n              actions.activate({\n                layoutId: layout.layoutId,\n                layoutItemId: layout.id\n              });\n            }\n          }} onMouseEnter={() => {\n            this._onMouseEnter();\n          }} onMouseLeave={() => {\n            this._onMouseLeave();\n          }}\n          >\n            <div className=\"layout-item__content\">\n              {layoutNode}\n            </div>\n          </div>}\n      </ActionContext.Consumer>\n    );\n  }\n}\n","\nimport {AppConfig, WidgetJson, IMAppConfig, AppConfigDiff} from './types/app-config';\nimport {IMState, AppContext} from './types/state';\nimport {AppMode} from './types/constants';\nimport {UrlParameters} from './types/url-parameters';\nimport {DataSourceStatus} from './data-source/base-types';\nimport { IUser } from '@esri/arcgis-rest-common-types';\n\nexport enum ActionKeys{\n  InitStoreExtensionState = 'INIT_STORE_EXTENSION_STATE',\n\n  AppConfigLoaded = 'APPCONFIG_LOADED',\n  AppConfigChanged = 'APPCONFIG_CHANGED',\n\n  InitPortalUrl = 'INIT_PORTAL_URL',\n  \n  WidgetClassLoaded = 'WIDGET_CLASS_LOADED',\n  OpenWidget = 'OPEN_WIDGET',\n  CloseWidget = 'CLOSE_WIDGET',\n  SetWidgetIsSettingState = 'SET_WIDGET_IS_SETTING_STATE',\n\n  SetAppInBuilder = 'SET_APP_IN_BUILDER',\n\n  LayoutClassLoaded = 'LAYOUT_CLASS_LOADED',\n\n  AppContextInit = 'APP_CONTEXT_INIT',\n  JimuCoreNlsLoaded = 'JIMU_CORE_NLS_LOADED',\n\n  //the query string has been changed in history object, so we don't update history on this action\n  QueryObjectChanged = 'QUERY_OBJECT_CHANGED',\n\n  AppModeChanged = 'APP_MODE_CHANGED',\n\n  DataSourceStatusChanged = 'DATA_SOURCE_STATUS_CHANGE',\n  DataSourceCurrentIndexesChanged = 'DATA_SOURCE_CURRENT_INDEXES_CHANGE',\n\n  ToggleWidgetHighLight = 'TOGGLE_WIDGET_HIGH_LIGHT',\n\n  //this event is for widget, widget can use this event to store something in app store\n  WidgetStatePropChange = 'WIDGET_STATE_PROP_CHANGE',\n\n  // events for when a user signs in/out\n  SessionStart = 'SESSION_START',\n  UserSignIn = 'USER_SIGN_IN',\n  UserSignOut = 'USER_SIGN_OUT',\n\n  IsMobileChanged = 'IS_MOBILE_CHANGED',\n}\n\n///////////actions type\n\nexport type ActionTypes = AppConfigLoadedAction | AppConfigChangedAction |\n  WidgetClassLoadedAction | OpenWidgetAction | CloseWidgetAction | ToggleWidgetHighlightAction |\n  AppContextInitAction | JimuCoreNlsLoadedAction | QueryObjectChangedAction | SetAppInBuilderAction |\n  AppModeChangedAction | InitAction | LayoutClassLoadedAction | DataSourceStatusChangeAction |\n  InitStoreExtensionState | WidgetStatePropChangeAction | InitPortalUrlAction | DataSourceCurrentIndexChangeAction |\n  SessionStartAction | UserSignInAction | UserSignOutAction | IsMobileChangedAction | SetWidgetIsSettingStateAction;\n\ninterface InitAction{\n  type: '@@INIT';\n}\ninterface InitStoreExtensionState{\n  type: ActionKeys.InitStoreExtensionState;\n}\nexport interface AppConfigLoadedAction{\n  type: ActionKeys.AppConfigLoaded;\n  appConfig: AppConfig\n}\nexport interface AppConfigChangedAction{\n  type: ActionKeys.AppConfigChanged;\n  appConfig: AppConfig;\n  appConfigDiff: AppConfigDiff;\n}\n\nexport interface WidgetClassLoadedAction{\n  type: ActionKeys.WidgetClassLoaded;\n  widgetId: string\n}\nexport interface OpenWidgetAction{\n  type: ActionKeys.OpenWidget;\n  widgetId: string\n}\nexport interface CloseWidgetAction{\n  type: ActionKeys.CloseWidget;\n  widgetId: string\n}\nexport interface AppContextInitAction{\n  type: ActionKeys.AppContextInit;\n  appContext: AppContext\n}\nexport interface JimuCoreNlsLoadedAction{\n  type: ActionKeys.JimuCoreNlsLoaded;\n  nls: any\n}\nexport interface QueryObjectChangedAction{\n  type: ActionKeys.QueryObjectChanged;\n  query: UrlParameters;\n}\nexport interface SetAppInBuilderAction{\n  type: ActionKeys.SetAppInBuilder;\n}\nexport interface AppModeChangedAction{\n  type: ActionKeys.AppModeChanged;\n  mode: AppMode;\n}\nexport interface ToggleWidgetHighlightAction{\n  type: ActionKeys.ToggleWidgetHighLight;\n  widgetId: string;\n  isHighlight: boolean;\n}\nexport interface LayoutClassLoadedAction{\n  type: ActionKeys.LayoutClassLoaded;\n  layoutName: string;\n}\nexport interface DataSourceStatusChangeAction{\n  type: ActionKeys.DataSourceStatusChanged;\n  dataSourceId: string;\n  status: DataSourceStatus;\n}\nexport interface DataSourceCurrentIndexChangeAction{\n  type: ActionKeys.DataSourceCurrentIndexesChanged;\n  dataSourceId: string;\n  currentIndexes: number[];\n}\nexport interface WidgetStatePropChangeAction{\n  type: ActionKeys.WidgetStatePropChange,\n  widgetId: string;\n  propKey: string; //support this format: a.b.c\n  value: any;\n}\nexport interface InitPortalUrlAction{\n  type: ActionKeys.InitPortalUrl,\n  portalUrl: string;\n}\nexport interface DataSourceCurrentIndexesChangeAction{\n  type: ActionKeys.DataSourceCurrentIndexesChanged;\n  dataSourceId: string;\n  currentIndexes: number[];\n}\nexport interface SessionStartAction {\n  type: ActionKeys.SessionStart,\n  token: string\n}\nexport interface UserSignInAction {\n  type: ActionKeys.UserSignIn;\n  user: IUser;\n}\nexport interface UserSignOutAction {\n  type: ActionKeys.UserSignOut;\n}\nexport interface IsMobileChangedAction {\n  type: ActionKeys.IsMobileChanged;\n  isMobile: boolean;\n}\nexport interface SetWidgetIsSettingStateAction {\n  type: ActionKeys.SetWidgetIsSettingState;\n  widgetId: string;\n  isSetting: boolean;\n}\n\n////////////action creators\nexport function appConfigLoaded(appConfig): AppConfigLoadedAction{\n  return {\n    type: ActionKeys.AppConfigLoaded, \n    appConfig: appConfig\n  };\n}\n\nexport function appConfigChanged(appConfig: IMAppConfig, appConfigDiff: AppConfigDiff): AppConfigChangedAction{\n  return {\n    type: ActionKeys.AppConfigChanged, \n    appConfig: appConfig,\n    appConfigDiff: appConfigDiff\n  };\n}\n\nexport function widgetClassLoaded(widgetId): WidgetClassLoadedAction{\n  return {\n    type: ActionKeys.WidgetClassLoaded,\n    widgetId: widgetId\n  };\n}\n\nexport function openWidget(widgetId): OpenWidgetAction{\n  return {\n    type: ActionKeys.OpenWidget,\n    widgetId: widgetId\n  };\n}\n\nexport function closeWidget(widgetId): CloseWidgetAction{\n  return {\n    type: ActionKeys.CloseWidget,\n    widgetId: widgetId\n  };\n}\n\nexport function initAppContext(appContext: AppContext): AppContextInitAction{\n  return {\n    type: ActionKeys.AppContextInit,\n    appContext: appContext\n  }\n}\n\nexport function jimuCoreNlsLoaded(nls: any): JimuCoreNlsLoadedAction{\n  return {\n    type: ActionKeys.JimuCoreNlsLoaded,\n    nls: nls\n  }\n}\n\nexport function queryObjectChanged(query: UrlParameters): QueryObjectChangedAction{\n  return {\n    type: ActionKeys.QueryObjectChanged,\n    query: query\n  }\n}\n\nexport function setAppInBuilder(): SetAppInBuilderAction{\n  return {\n    type: ActionKeys.SetAppInBuilder,\n  }\n}  \n\nexport function appModeChanged(mode: AppMode): AppModeChangedAction{\n  return {\n    type: ActionKeys.AppModeChanged,\n    mode: mode\n  }\n}\n\nexport function toggleWidgetHighlight(widgetId: string, isHighlight: boolean): ToggleWidgetHighlightAction{\n  return {\n    type: ActionKeys.ToggleWidgetHighLight,\n    widgetId: widgetId,\n    isHighlight: isHighlight\n  }\n}\n\nexport function layoutClassLoaded(layoutName): LayoutClassLoadedAction{\n  return {\n    type: ActionKeys.LayoutClassLoaded,\n    layoutName: layoutName\n  };\n}\n\nexport function dataSourceStatusChanged(dataSourceId: string, status: DataSourceStatus): DataSourceStatusChangeAction{\n  return {\n    type: ActionKeys.DataSourceStatusChanged,\n    dataSourceId: dataSourceId,\n    status: status\n  };\n}\n\nexport function initStoreExtensionState(): InitStoreExtensionState{\n  return {\n    type: ActionKeys.InitStoreExtensionState\n  };\n}\n\nexport function widgetStatePropChange(widgetId: string, propKey: string, value: any): WidgetStatePropChangeAction{\n  return {\n    type: ActionKeys.WidgetStatePropChange,\n    widgetId: widgetId,\n    propKey: propKey,\n    value: value\n  };\n}\nexport function initPortalUrl(portalUrl: string): InitPortalUrlAction{\n  return {\n    type: ActionKeys.InitPortalUrl,\n    portalUrl: portalUrl\n  };\n}\n\nexport function dataSourceCurrentIndexesChanged(dataSourceId: string, indexes: number[]): DataSourceCurrentIndexesChangeAction{\n  return {\n    type: ActionKeys.DataSourceCurrentIndexesChanged,\n    dataSourceId: dataSourceId,\n    currentIndexes: indexes\n  };\n}\n\nexport function sessionStart(token: string): SessionStartAction{\n  return {\n    type: ActionKeys.SessionStart,\n    token\n  };\n}\n\nexport function userSignIn(user: IUser): UserSignInAction{\n  return {\n    type: ActionKeys.UserSignIn,\n    user\n  };\n}\n\nexport function userSignOut(): UserSignOutAction{\n  return {\n    type: ActionKeys.UserSignOut\n  };\n}\n\nexport function isMobileChanged(isMobile: boolean): IsMobileChangedAction{\n  return {\n    type: ActionKeys.IsMobileChanged,\n    isMobile: isMobile\n  };\n}\n\nexport function setWidgetIsSettingState(widgetId: string, isSetting: boolean): SetWidgetIsSettingStateAction{\n  return {\n    type: ActionKeys.SetWidgetIsSettingState,\n    widgetId: widgetId,\n    isSetting: isSetting\n  };\n}","import rootReducer from './app-reducer';\nimport { createStore, Store, applyMiddleware } from 'redux';\nimport {IMState} from './types/state';\n\nexport const store: Store<IMState> = createStore(\n  rootReducer, \n  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__(),\n  // applyMiddleware(logger)\n);\n","import {AppConfig} from '../types/app-config';\nimport {WidgetProps} from '../types/props';\nimport {IMWidgetJson, IMDataSourceJson} from '../types/app-config';\nimport {IMState} from '../types/state';\nimport {DataSource} from '../data-source/base-types';\n\nexport enum ExtensionPoints{\n  /**\n   * The extension for this EP will be invoked after app config is loaded.\n   * Pass in the loaded app config into this extension and this extension should return the processed app config\n   * \n   * Extension for this EP should implement IAppConfigProcessorExtension interface.\n   */\n  AppConfigProcessor = 'APP_CONFIG_PROCESSOR',\n\n  /**\n   * The extension for this EP will be invoked after widget class is loaded and core props have been injected.\n   * \n   * Extension for this EP should implement IWidgetClassWrapperExtension interface.\n   */\n  WidgetClassWrapper = 'WIDGET_CLASS_WRAPPER',\n\n  /**\n   * The extension for this EP is used to get the config service, which is used to save/load app config.\n   * \n   * Extension for this EP should implement IAppConfigServiceExtension interface.\n   */\n  AppConfigService = 'APP_CONFIG_SERVICE',\n\n  /**\n   * The extension for this EP is used to extent the redux store.\n   * \n   * Extension for this EP should implement IReduxStoreExtension interface.\n   */\n  ReduxStore = 'REDUX_STORE',\n\n  /**\n   * The extension for this EP is used to define dependency.\n   * \n   * Extension for this EP should implement IDependencyDefine interface.\n   */\n  DependencyDefine = 'DEPENDENCY_DEFINE',\n\n\n  DataSourceFactory = 'DATA_SOURCE_FACTORY',\n}\n\nexport const EP_SUPPORT_MULTIPLE_EXTENTIONS = [ExtensionPoints.ReduxStore, ExtensionPoints.DataSourceFactory];\n\nexport interface BaseExtension{\n  //if extension point supports multiple extension, the index is used to determine\n  //the extension order.\n  index?: number;\n\n  //unique\n  id: string;\n\n  name?: string;\n\n  widgetId?: string;\n}\n\n//for type\nexport class DummyExtension implements BaseExtension{\n  index?: number;\n  id: string;\n  name?: string;\n  widgetId?: string;\n}\n\nexport interface AppConfigProcessorExtension extends BaseExtension{\n  process: (appConfig: AppConfig) => Promise<AppConfig>;\n}\n\n\nexport interface WidgetClassWrapperExtension extends BaseExtension{\n  wrap: (WidgetClass: React.ComponentClass<WidgetProps>, widgetJson: IMWidgetJson, nls: any) => React.ComponentClass<WidgetProps>;\n}\n\nexport interface AppConfigServiceExtension extends BaseExtension{\n  loadAppConfig: () => Promise<AppConfig>;\n}\n\nexport interface ReduxStoreExtension extends BaseExtension{\n\n  getActions: () => string[];\n\n  //the key supports this format: a.b.c\n  getStoreKey: () => string;\n\n  getInitLocalState: () => any;\n\n  getReducer: () => (localState, action, state: IMState) => any;\n}\n\nexport interface DependencyDefine extends BaseExtension{\n  getDependencyKey: () => string;\n\n  getResources: () => string[];\n}\n\nexport interface DataSourceFactory extends BaseExtension{\n  getSupportDataSourceTypes: () => string[];\n\n  createDataSource: (dsConfig: IMDataSourceJson) => DataSource;\n}","export enum AjaxState{\n  Fetching = 'FETCHING',\n  Success = 'SUCCESS',\n  Error = 'ERROR',\n}\n\nexport enum AppMode{\n  //these 3 are modes in builder\n  Config = 'CONFIG',\n  Design = 'DESIGN',\n  Preview = 'PREVIEW',\n\n  //this is normal run mode\n  Run = 'RUN'\n}","import * as React from 'react';\nimport {connect} from 'react-redux';\nimport isDeepEqual = require('fast-deep-equal');\n\nimport {logShallowDiff} from './utils/utils';\nimport {getAllWidgets} from './utils/app-config';\nimport {AppConfig, IMWidgetJson, IMAppConfig} from './types/app-config';\nimport {ExtensionProperties} from './types/manifest';\nimport {IMState} from './types/state';\n// import {store} from './store';\nimport * as actions from './app-actions';\nimport {amdRequire} from './amd-loader';\nimport {BaseExtension, EP_SUPPORT_MULTIPLE_EXTENTIONS, ExtensionPoints, DummyExtension} from './extension-spec/extension-spec'\nimport { extname } from 'path';\n\ninterface ExtensionInfo{\n  epName: ExtensionPoints;\n  extension: BaseExtension;\n}\n\nexport default class ExtensionManager{\n\n  static instance: ExtensionManager;\n\n  static getInstance(){\n    if(!ExtensionManager.instance){\n      ExtensionManager.instance = new ExtensionManager();\n      window._extensionManager = ExtensionManager.instance;\n    }\n    \n    return ExtensionManager.instance;\n  }\n\n  constructor(){\n    // store.subscribe(this.onStoreChange.bind(this));\n  }\n\n  private appConfig: AppConfig;\n  \n  private extensions: {\n    [epName: string]: BaseExtension[]\n  } = {};\n  private extensionClasses: {[extName: string]: typeof DummyExtension} = {};\n\n  getExtensions(epName: string): BaseExtension[]{\n    return this.extensions[epName] || [];\n  }\n\n  onStoreChange(){\n    // if(this.appConfig === store.getState().appConfig){\n    //   return;\n    // }\n\n    // this.appConfig = store.getState().appConfig;\n    // this.clean();\n    // this.loadExtensions(this.appConfig);\n  }\n\n  registerExtension(extInfo: ExtensionInfo){\n    if(this.getExtensionById(extInfo.extension.id)){\n      console.log(`Extension ${extInfo.extension.id} has been registered.`);\n      return;\n    }\n    if(this.extensions[extInfo.epName]){\n      if(EP_SUPPORT_MULTIPLE_EXTENTIONS.indexOf(extInfo.epName) > -1){\n        this.extensions[extInfo.epName].push(extInfo.extension);\n\n        this.extensions[extInfo.epName] = this.extensions[extInfo.epName].sort((a, b) => {\n          return a.index - b.index;\n        });\n      }\n      return;\n    }\n\n    this.extensions[extInfo.epName] = [extInfo.extension];\n  }\n\n  registerAllWidgetExtensions(appConfig: AppConfig): Promise<void[]>{\n    let extPromises = [];\n    getAllWidgets(appConfig as IMAppConfig).forEach(w => {\n      extPromises.push(this.registerWidgetExtensions(w));\n    });\n\n    return Promise.all(extPromises);\n  }\n\n  clean(){\n    this.extensions = {};\n  }\n\n  registerWidgetExtensions(widgetJson: IMWidgetJson): Promise<void[]>{\n    let extPromises = [];\n    if(widgetJson.manifest.extentions){\n      widgetJson.manifest.extentions.forEach(ext => {\n        extPromises.push(this.registerWidgetExtension(widgetJson, ext));\n      });\n    }\n    return Promise.all(extPromises);\n  }\n\n  registerWidgetExtension(widgetJson: IMWidgetJson, extensionProps: ExtensionProperties): Promise<void>{\n    if(this.extensions[extensionProps.point]){\n      if(EP_SUPPORT_MULTIPLE_EXTENTIONS[extensionProps.point]){\n        if(this.extensions[extensionProps.point].filter(ext => ext.name === extensionProps.name && ext.widgetId === widgetJson.id).length > 0){\n          return Promise.resolve();\n        }\n      }else{\n        return Promise.resolve();\n      }\n    }\n    \n    return this.loadWidgetExtensionClass(widgetJson, extensionProps).then((ExtClass: typeof DummyExtension) => {\n      let ext: BaseExtension = new ExtClass();\n\n      this.registerExtension({\n        epName: extensionProps.point as ExtensionPoints,\n        extension: ext\n      });\n\n      return;\n    });    \n  }\n\n  loadWidgetExtensionClass(widgetJson: IMWidgetJson, extensionProps: ExtensionProperties): Promise<typeof DummyExtension>{\n    //to avoid ext name conflict in widget\n    let extName = `${widgetJson.manifest.name}-${extensionProps.name}`;\n    if(this.extensionClasses[extName]){\n      return Promise.resolve(this.extensionClasses[extName])\n    }\n    var uri = widgetJson.context.amdFolder + 'dist/' + extensionProps.uri;\n    return amdRequire(uri).then(ExtensionClass => {\n      return ExtensionClass.default;\n    });\n  }\n\n  getExtensionById(extId: string): BaseExtension{\n    for(let i in this.extensions){\n      let ext = this.extensions[i].filter(ext => ext.id === extId)[0];\n      return ext;\n    }\n  }\n}\n\n","import { LayoutInfo, OrderAdjustType } from \"../types\";\n\nexport enum GlobalLayoutActions {\n  ADD_LAYOUT = 'GLOBAL_ADD_LAYOUT',\n  REMOVE_LAYOUT = 'GLOBAL_REMOVE_LAYOUT',\n  UPDATE_LAYOUT = 'GLOBAL_UPDATE_LAYOUT',\n  RESIZE_LAYOUTS = 'GLOBAL_RESIZE_LAYOUTS',\n  DRAG_DROP_LAYOUT = 'GLOBAL_DRAG_DROP_LAYOUT',\n  ADD_WIDGET = 'GLOBAL_ADD_WIDGET',\n  REMOVE_WIDGET = 'GLOBAL_REMOVE_WIDGET',\n  ACTIVATE = 'GLOBAL_ACTIVATE',\n  UPDATE_SETTING = 'GLOBAL_UPDATE_SETTING',\n  ADD_SECTION = 'GLOBAL_ADD_SECTION',\n  REMOVE_SECTION = 'GLOBAL_REMOVE_SECTION',\n  CHANGE_ORDER = 'GLOBAL_CHANGE_ORDER'\n};\n\nexport function updateLayout(layoutInfo, pos?, newSetting?) {\n  return {\n    type: GlobalLayoutActions.UPDATE_LAYOUT,\n    layoutInfo,\n    pos,\n    newSetting\n  }\n}\n\nexport function updateSetting(layoutInfo, newSetting) {\n  return {\n    type: GlobalLayoutActions.UPDATE_SETTING,\n    layoutInfo,\n    newSetting\n  }\n}\n\nexport function addLayout(layoutId, parentId, layout) {\n  return {\n    type: GlobalLayoutActions.ADD_LAYOUT,\n    layoutId,\n    parentId,\n    layout\n  };\n}\n\nexport function removeLayout(layoutInfo) {\n  return {\n    type: GlobalLayoutActions.REMOVE_LAYOUT,\n    layoutInfo\n  };\n}\n\nexport function resizeLayouts(layouts, breakpoint?) {\n  return {\n    type: GlobalLayoutActions.RESIZE_LAYOUTS,\n    layouts,\n    breakpoint\n  };\n}\n\nexport function dndLayout(layoutInfo, parentLayoutInfo, newPosition) {\n  return {\n    type: GlobalLayoutActions.DRAG_DROP_LAYOUT,\n    layoutInfo,\n    parentLayoutInfo,\n    newPosition\n  };\n}\n\nexport function activate(layoutInfo) {\n  return {\n    type: GlobalLayoutActions.ACTIVATE,\n    layoutInfo\n  };\n}\n\nexport function removeWidget(widgetId: string) {\n  return {\n    type: GlobalLayoutActions.REMOVE_WIDGET,\n    widgetId\n  };\n}\n\nexport function addWidget(widgetId, layoutInfo?: LayoutInfo) {\n  return {\n    type: GlobalLayoutActions.ADD_WIDGET,\n    widgetId,\n    layoutInfo\n  };\n}\n\nexport function addSection(sectionId, layoutInfo?: LayoutInfo) {\n  return {\n    type: GlobalLayoutActions.ADD_SECTION,\n    sectionId,\n    layoutInfo\n  };\n}\n\nexport function removeSection(sectionId: string) {\n  return {\n    type: GlobalLayoutActions.REMOVE_SECTION,\n    sectionId\n  };\n}\n\nexport function changeOrder(layoutInfo: LayoutInfo, orderType: OrderAdjustType) {\n  return {\n    type: GlobalLayoutActions.CHANGE_ORDER,\n    layoutInfo,\n    orderType\n  };\n}\n","import {WidgetContext, IMAppConfig, IMPageJson, IMWidgetJson, IMViewJson, IMSectionJson, ContainerType, AppConfigDiff, WidgetJson} from '../types/app-config';\nimport { LOADIPHLPAPI } from 'dns';\n\nexport function getWidgetContext(uri: string): WidgetContext {\n  let info = {} as WidgetContext;\n  info.amdFolder = uri;\n  if(!/\\/$/.test(info.amdFolder)){\n    info.amdFolder += '/';\n  }\n  info.folderUrl = window.amdRequire.toUrl(info.amdFolder);\n\n  if(/^http(s)?:\\/\\//.test(uri) || /^\\/\\//.test(uri)){\n    info.isRemote = true;\n  }else{\n    info.isRemote = false;\n  }\n\n  return info;\n}\n\n\nexport function addThemeManifestProperies(manifest) {\n  manifest.panels.forEach(function(panel) {\n    panel.uri = 'panels/' + panel.name + '/Panel.js';\n  });\n\n  manifest.styles.forEach(function(style) {\n    style.uri = 'styles/' + style.name + '/style.css';\n  });\n\n  manifest.layouts.forEach(function(layout) {\n    layout.uri = 'layouts/' + layout.name + '/config.json';\n    layout.icon = 'layouts/' + layout.name + '/icon.png';\n    layout.RTLIcon = 'layouts/' + layout.name + '/icon_rtl.png';\n  });\n}\n\nexport function addWidgetManifestProperties(manifest) {\n  if (typeof manifest.properties === 'undefined') {\n    manifest.properties = {};\n  }\n\n  var defaultFalseProperties = ['isController', 'hasVersionManager', 'isDojoWidget'];\n  defaultFalseProperties.forEach(function(p) {\n    if (typeof manifest.properties[p] === 'undefined') {\n      manifest.properties[p] = false;\n    }\n  });\n\n  var defaultTrueProperties = ['inPanel', 'hasMainClass', 'hasLocale', 'hasConfig', 'hasSettingPage',\n  'hasSettingLocale', 'keepConfigAfterMapSwitched', 'isController', 'hasVersionManager',\n  'supportMultiInstance'];\n\n  defaultTrueProperties.forEach(function(p) {\n    if (typeof manifest.properties[p] === 'undefined') {\n      manifest.properties[p] = true;\n    }\n  });\n}\n\nexport function addWidgetDefaultLabelAndIcon(widgetJson: WidgetJson){\n  widgetJson.icon = widgetJson.icon? widgetJson.icon:\n    widgetJson.context.folderUrl + 'dist/runtime/assets/icon.svg';\n        \n  widgetJson.label = widgetJson.label? widgetJson.label: widgetJson.manifest.name;\n}\n\nexport function getAllWidgets(appConfig: IMAppConfig): IMWidgetJson[]{\n  let widgets = [];\n\n  Object.keys(appConfig.widgets).forEach(wId => {\n    widgets.push(appConfig.widgets[wId]);\n  });\n\n  return widgets;\n}\n\nexport function getWidgetsByName(appConfig: IMAppConfig, widgetName: string): IMWidgetJson[]{\n  let widgets = [];\n\n  Object.keys(appConfig.widgets).forEach(wId => {\n    if(appConfig.widgets[wId].manifest.name === widgetName){\n      widgets.push(appConfig.widgets[wId]);\n    }\n  });\n\n  return widgets;\n}\n\nexport function getCleanAppConfig(appConfig: IMAppConfig): any{\n  let config = appConfig.asMutable({deep: true});\n  Object.keys(config.widgets).forEach(wid => {\n    let w = config.widgets[wid];\n    delete w.context;\n    delete w.manifest;\n  });\n  return config;\n}\n\ninterface ContainerInfo{\n  containerType: ContainerType,\n  containerId: string;\n}\n\nexport function getContainerInfoByLayoutId(appConfig: IMAppConfig, layoutId: string): ContainerInfo{\n  let info: ContainerInfo;\n  Object.keys(ContainerType).some(cType => {\n    Object.keys(appConfig[ContainerType[cType]]).some(cId => {\n      if(appConfig[ContainerType[cType]][cId].layout === layoutId){\n        info = {\n          containerType: ContainerType[cType],\n          containerId: cId\n        };\n        return true;\n      }\n    })\n    if(info) return true;\n  });\n\n  return info;\n}\n\nexport function getWidgetContainerInfo(appConfig: IMAppConfig, widgetId: string): ContainerInfo{\n  if(!appConfig.widgets || !appConfig.widgets[widgetId]){\n    return;\n  }\n\n  let info: ContainerInfo;\n  Object.keys(ContainerType).some(cType => {\n    let containerId = getWidgetContainerIdByContainerType(appConfig, widgetId, ContainerType[cType]);\n    if(containerId){\n      info = {\n        containerType: ContainerType[cType],\n        containerId: containerId\n      };\n      return true;\n    }\n  });\n\n  return info;\n}\n\nfunction getWidgetContainerIdByContainerType(appConfig: IMAppConfig, widgetId: string, containerType: ContainerType): string{\n  let containerId;\n  if(!appConfig[containerType]){\n    return;\n  }\n  Object.keys(appConfig[containerType]).some(cId => {\n    let ctn = appConfig[containerType][cId];\n    if(ctn.widgets && ctn.widgets.indexOf(widgetId) > -1){\n      containerId = cId;\n      return containerId;\n    }\n  });\n  if(containerId){\n    return containerId;\n  }\n}\n\nexport function getSectionContainerInfo(appConfig: IMAppConfig, sectionId: string): ContainerInfo{\n  if(!appConfig.sections || !appConfig.sections[sectionId]){\n    return;\n  }\n\n  let info: ContainerInfo;\n  Object.keys(ContainerType).some(cType => {\n    let containerId = getSectionContainerIdByContainerType(appConfig, sectionId, ContainerType[cType]);\n    if(containerId){\n      info = {\n        containerType: ContainerType[cType],\n        containerId: containerId\n      };\n      return true;\n    }\n  });\n\n  return info;\n}\n\nfunction getSectionContainerIdByContainerType(appConfig: IMAppConfig, sectionId: string, containerType: ContainerType): string{\n  let containerId;\n  if(!appConfig[containerType]){\n    return;\n  }\n  Object.keys(appConfig[containerType]).some(cId => {\n    let ctn = appConfig[containerType][cId];\n    if(ctn.sections && ctn.sections.indexOf(sectionId) > -1){\n      containerId = cId;\n      return containerId;\n    }\n  });\n  if(containerId){\n    return containerId;\n  }\n}\n\n/**\n * we use <type_number> format to generate key.\n * @param type: \n */\nexport function getUniqueId(appConfig: IMAppConfig, type: 'page' | 'view' | 'section' | 'widget' | 'layout'): string{\n  let max = 0;\n  if(!appConfig[`${type}s`]){\n    return `${type}_${max + 1}`;\n  }\n  Object.keys(appConfig[`${type}s`]).forEach(k => {\n    let i = k.substring(`${type}_`.length, k.length);\n    if(/^\\d+$/.test(i)){\n      max = Math.max(max, parseInt(i));\n    }\n  });\n\n  let newId = `${type}_${max + 1}`;\n  \n  return newId;\n}\n\n/**\n * we use <type number> format to generate key.\n * @param type: \n */\nexport function getUniqueLabel(appConfig: IMAppConfig, type: 'page' | 'view' | 'section' | 'widget'): string{\n  let max = 0;\n  if(!appConfig[`${type}s`]){\n    return `${type} ${max + 1}`;\n  }\n  Object.keys(appConfig[`${type}s`]).forEach(k => {\n    let label = appConfig[`${type}s`][k].label;\n    let i = label.substring(`${type} `.length, label.length);\n    if(/^\\d+$/.test(i)){\n      max = Math.max(max, parseInt(i));\n    }\n  });\n\n  let newLabel = `${type} ${max + 1}`;\n  \n  return newLabel;\n}\n\n\n\n/**\n * App config is updated in builder, jimu will render the app depends on app config.\n * However, there are some caches need to be cleaned if something(widget, data source) is removed/updated, so we need to diff \n * the app config to get what are removed/updated. I think we don't need care the new add thing.\n * \n * Why we don't pass the app config change action into app? Because to support undo/redo, it's hard to to this, so we use diff, but we'll diff the changes we care only.\n * \n * @param oldConfig \n * @param newConfig \n */\nexport function getAppConfigDiff(oldConfig: IMAppConfig, newConfig: IMAppConfig): AppConfigDiff{\n  let diff: AppConfigDiff = {\n    removedWidgets: []\n  };\n\n  if(oldConfig.widgets === newConfig.widgets){\n    return diff;\n  }\n\n  Object.keys(oldConfig.widgets).forEach(oldWId => {\n    if(!newConfig.widgets[oldWId]){\n      diff.removedWidgets.push(oldWId);\n    }\n  });\n\n  return diff;\n}\n","import * as React from 'react';\nimport {LayoutActionContext} from './types';\n\nconst emptyFunc = () => {};\n\nexport const ActionContext: React.Context<LayoutActionContext> = React.createContext({\n  updateSetting: emptyFunc,\n  addLayout: emptyFunc,\n  removeLayout: emptyFunc,\n  resizeLayouts: emptyFunc,\n  dndLayout: emptyFunc,\n  activate: emptyFunc,\n  removeWidget: emptyFunc\n});","import { CommonLayoutSetting } from './types';\n\nexport const DEFAULT_LAYOUT_SETTING: CommonLayoutSetting = {\n  active: false,\n  static: false,\n  restrict: false,\n  draggable: true,\n  resizable: true,\n  droppable: true,\n  xyInPixel: true, // fixed position\n  widthInPixel: true,\n  heightInPixel: true,\n  className: ''\n};","import isDeepEqual = require('fast-deep-equal');\nimport { UrlParameters } from '../types/url-parameters';\nimport { DataSourceInfo } from '../types/state';\nimport { Size } from '../types/common';\n\nexport function logShallowDiff(name, obj, preObj){\n  let hasDiff = false;\n  for(let p in obj){\n    if(obj[p] !== preObj[p]){\n      hasDiff = true;\n    }\n  }\n\n  if(!hasDiff){\n    console.group(name, 'no diff.');\n    console.groupEnd();\n    return;\n  }\n  console.group(name);\n  for(let p in obj){\n    if(obj[p] !== preObj[p]){\n      console.log(p, {\n        pre: preObj[p],\n        cur: obj[p],\n        isEqual: isDeepEqual(obj[p], preObj[p])\n      });\n    }\n  }\n  console.groupEnd();\n}\n\n\ntype WidgetPanelCallBack = 'onOpen' | 'onClose' | 'onActive' | 'onDeActive';\n\nexport function getWidgetCallbackNamesFromWidgetState(widgetState, prevWidgetState): WidgetPanelCallBack[] | WidgetPanelCallBack {\n  return getCallbackNames(widgetState, prevWidgetState);\n}\n\nexport function getPanelCallbackNamesFromPanelState(panelState, prevPanelState): WidgetPanelCallBack[] | WidgetPanelCallBack {\n  return getCallbackNames(panelState, prevPanelState);\n}\n\nexport function isMobileBrowser(){\n  return false;\n}\n\nexport function isMobileSize(size: Size){\n  if(size.width < 600){\n    return true;\n  }\n\n  return false;\n}\n\nfunction getCallbackNames(state, prevState): WidgetPanelCallBack[] | WidgetPanelCallBack {\n  switch(state){\n    case 'opened':\n      switch(prevState){\n        case 'opened':\n          return null;\n        case 'closed':\n          return 'onOpen';\n        case 'active':\n          return 'onDeActive';\n      }\n    case 'closed':\n      switch(prevState){\n        case 'opened':\n          return 'onClose';\n        case 'closed':\n          return null;\n        case 'active':\n          return ['onDeActive', 'onClose'];\n      }\n    case 'active':\n      switch(prevState){\n        case 'opened':\n          return 'onDeActive';\n        case 'closed':\n          return ['onOpen', 'onActive'];\n        case 'active':\n          return null;\n      }\n  }\n}\n\nexport function loadstyle(url: string, beforeId?: string) {\n  return new Promise(resolve => {\n    let containerNode: HTMLElement;\n    if (beforeId) {\n      containerNode = document.getElementById(beforeId);\n    } else {\n      containerNode = document.getElementsByTagName(\"head\")[0];\n    }\n\n    let onLoad = () => {\n      resolve()\n    };\n\n    var cssNode: HTMLStyleElement = document.createElement(\"link\");\n    cssNode.setAttribute(\"rel\", \"stylesheet\");\n    cssNode.setAttribute(\"type\", \"text/css\");\n    cssNode.setAttribute(\"href\", url);\n    cssNode.onload = onLoad;\n\n    containerNode.appendChild(cssNode);\n  });\n  \n}\n\nexport function applyMixins(derivedCtor: any, baseCtors: any[]) {\n  baseCtors.forEach(baseCtor => {\n      Object.getOwnPropertyNames(baseCtor.prototype).forEach(name => {\n          derivedCtor.prototype[name] = baseCtor.prototype[name];\n      });\n  });\n}\n\nexport function getDataSourceInfosFromQueryObject(queryObject: UrlParameters): {[dsId: string]: number}{\n  let dsInfo = {};\n  if(queryObject.data){\n    let dss = queryObject.data.split(',');\n    dss.forEach(ds => {\n      let dsId = ds.split(':')[0];\n      let i = parseInt(ds.split(':')[1]);\n      dsInfo[dsId] = i;\n    });\n  }\n  return dsInfo;\n}","\nexport function amdRequire(moduleId: string|string[]): Promise<any>{\n  return new Promise(resolve => {\n    window.amdRequire(typeof moduleId === 'string'? [moduleId]: moduleId, moduleObj => {\n      resolve(moduleObj);\n    });\n  });\n}","import { UserSession, ICredential, IOauth2Options, AuthenticationProvider } from '@esri/arcgis-rest-auth';\nimport { ArcGISAuthError } from '@esri/arcgis-rest-request';\nimport { sessionStart, userSignIn, userSignOut } from './app-actions';\nimport * as Cookies from 'js-cookie';\nimport { store } from './store';\n\n// TODO: how to these values from something like an environment config\n// NOTE: this was the clientId that was hard coded in config-manager\nconst CLIENT_ID = 'QQ6D3PZqPSV6y4SM';\nconst AUTH_COOKIE_NAME = 'esri_auth';\nconst AUTH_LOCAL_STORAGE_KEY = 'exb_session';\n\nexport default class SessionManager{\n\n  static instance: SessionManager;\n\n  private _session: UserSession;\n\n  private _retryPromise: Promise<{}>;\n\n  private _setSession(session: UserSession, localStorageKey = AUTH_LOCAL_STORAGE_KEY){\n    // persist a reference to the fully hydrated session in this singleton\n    this._session = session;\n    // notify the rest of the app via the store that we are authenticated\n    store.dispatch(sessionStart(session.token));\n    // share the session w/ the builder through a local storage item\n    localStorage.setItem(localStorageKey, session.serialize());\n    // query the user's info\n    return this._session.getUser()\n    .then(user => {\n      // notify the rest of the app via the store that the user has signed in\n      store.dispatch(userSignIn(user));\n      return user;\n    });\n  }\n\n  private _clearSession(localStorageKey = AUTH_LOCAL_STORAGE_KEY) {\n    // clear the reference to the fully hydrated session in this singleton\n    delete this._session;\n    // notify the rest of the app via the store that the user has signed out\n    store.dispatch(userSignOut());\n    // remove local storage item\n    localStorage.removeItem(localStorageKey);\n  }\n\n  // singleton\n  static getInstance(){\n    if(!SessionManager.instance){\n      SessionManager.instance = new SessionManager();\n    }\n    \n    return SessionManager.instance;\n  }\n\n  constructor(){\n  }\n\n  // convenience function to expose the app's portal URL\n  getPortalUrl() {\n    return store.getState().portalUrl;\n  }\n\n  // get the currently logged in user's session - if any\n  getSession() {\n    // TODO: get this from redux store instead?\n    return this._session;\n  }\n\n  initFromCookie(name = AUTH_COOKIE_NAME) {\n    const cookie = Cookies.get(name);\n    if (cookie) {\n      const cookieJson = JSON.parse(cookie);\n      const portal = `https://${cookieJson.urlKey}.${cookieJson.customBaseUrl}/sharing/rest/`;\n      this._setSession(new UserSession({\n        clientId: CLIENT_ID,\n        token: cookieJson.token,\n        tokenExpires: new Date(cookieJson.expires),\n        // TODO: are these always  right?\n        portal,\n        username: cookieJson.email\n      }));\n    }\n  }\n\n  // rehydrate session from a serialized session saved in local storage\n  initFromLocalStorage(key = AUTH_LOCAL_STORAGE_KEY){\n    const serializedSession = localStorage.getItem(key);\n    if(serializedSession){\n      // NOTE: fire and forget for now\n      this._setSession(UserSession.deserialize(serializedSession));\n    }\n  }\n\n  // rehydrate session from a cached credential\n  initFromCredential(credential: ICredential) {\n    // NOTE: fire and forget for now\n    this._setSession(UserSession.fromCredential(credential));\n  }\n\n  // start OAuth sign in flow and return the user session\n  signIn (provider?: AuthenticationProvider) {\n    // we want social media linked accounts to be associated w/ the Hub's community org\n    const appConfig = store.getState().appConfig;\n    const hubConfig = appConfig && appConfig.hub;\n    const hubCommunityPortalUrl = hubConfig && hubConfig.community && hubConfig.community.portalUrl;\n    const portal = provider && hubCommunityPortalUrl ? hubCommunityPortalUrl : this.getPortalUrl();\n\n    const oauth2Options: IOauth2Options = {\n      portal,\n      clientId: CLIENT_ID,\n      redirectUri: window.location.origin + window.amdRequire.toUrl('jimu-core') + '/oauth-callback.html',\n      popup: true\n    };\n    if (provider) {\n      oauth2Options.provider = provider\n    }\n    return UserSession.beginOAuth2(oauth2Options)\n    .then(newSession => {\n      // hold on to the session for future requests and fetch user info\n      return this._setSession(newSession);\n    });\n  }\n\n  _retry(/*url, originalRequestOptions */)  {\n    // NOTE: we could use url and/or originalRequestOptions to set the portal, clientId, etc.\n    // TODO: how can/should this show Hub auth (i.e. use facebook/google directly)\n    return this.signIn()\n    .then(() => {\n      return this.getSession();\n    });\n  }\n\n  handleAuthError(error) {\n    const originalRequestOptions = error.options;\n    // if we got an auth error for an unauthenticated request, \n    // retry after getting a new session for this user\n    if(error instanceof ArcGISAuthError && originalRequestOptions && !originalRequestOptions.authentication) {\n      if (!this._retryPromise) {\n        this._retryPromise = error.retry(this._retry.bind(this));\n      }\n      return this._retryPromise;\n    }\n    // otherwise re-throw the error\n    throw error;\n  }\n\n  signOut() {\n    // get session info before destroying it\n    const {\n      portal,\n      clientId\n    } = this.getSession();\n\n    // clear the cached session info from the store and local storage\n    this._clearSession();\n\n    // if we have the auth cookie we also need to clear it\n    const location = window && window.location;\n    if (location && Cookies.get(AUTH_COOKIE_NAME)) {\n      // we want to reload the app at this state w/ the current state\n      const redirectUri = encodeURIComponent(location.toString());\n      const signoutUrl = `${portal}/oauth2/signout?client_id=${clientId}&redirect_uri=${redirectUri}`;\n      location.href = signoutUrl;\n    }\n  }\n}\n","import * as React from 'react';\nimport {createBrowserHistory, History, Action} from 'history';\nimport {queryObjectChanged} from './app-actions';\nimport {store} from './store';\nimport * as queryString from 'query-string';\nimport isEqual = require('lodash.isequal');\nimport {Location, parsePath, isAbsoluteUrl} from './utils/url-utils';\n\nexport const browserHistory = createBrowserHistory();\n\nconst unlisten = browserHistory.listen((location: Location, action: Action) => {\n  let storeQo = store.getState().queryObject.asMutable();\n  if(location.search){\n    let locationQo = queryString.parse(location.search);\n    if(!isEqual(storeQo, locationQo)){\n      store.dispatch(queryObjectChanged(locationQo));\n    }\n  }\n});\n\nconst HistoryContext = React.createContext(browserHistory);\nexport const HistoryProvider = (props) => {\n  return <HistoryContext.Provider value={browserHistory}>{props.children}</HistoryContext.Provider>\n};\n\nexport function withHistory<T extends React.ComponentClass>(Component: T): T {\n  return function HistoryComponent(props) {\n    return (\n      <HistoryContext.Consumer>\n        {history => <Component {...props} history={history} />}\n      </HistoryContext.Consumer>\n    );\n  } as any;\n}\n\n/**\n * \n * @param queryObject can be partial of query object\n */\nexport function changeQueryObject(queryObject, replace: boolean = false){\n  let qo = store.getState().queryObject.merge(queryObject);\n  let loc = createLocation(browserHistory.location, '?' + queryString.stringify(qo));\n  let href = browserHistory.createHref(loc);\n  if(replace){\n    browserHistory.replace(href);\n  }else{\n    browserHistory.push(href)\n  }\n}\n\nexport function changePage(pageId: string){\n  if(store.getState().queryObject.page === pageId){\n    return;\n  }\n  return changeQueryObject({\n    page: pageId\n  });\n}\n\nexport function changeView(sectionId: string, viewId: string){\n  let views = store.getState().queryObject.views? store.getState().queryObject.views.split(','): [];\n  if(views.indexOf(viewId) > -1){\n    return;\n  }else{\n    //remove all views in the section\n    views = views.filter(vId => store.getState().appConfig.sections[sectionId].views.indexOf(vId) < 0);\n    views.push(viewId);\n  }\n  return changeQueryObject({\n    views: views.join(',')\n  });\n}\n\nexport function createLocation (currentLocation: Location, to: string): Location{\n  let toLocation = parsePath(to);\n  if(isAbsoluteUrl(toLocation.pathname) || toLocation.pathname.charAt(0) === '/'){\n    return toLocation;\n  }\n\n  if(toLocation.pathname === ''){\n    toLocation.pathname = currentLocation.pathname;\n    return toLocation;\n  }\n\n  if(toLocation.pathname.charAt(0) === '.'){// means \"./\"\n    toLocation.pathname = currentLocation.pathname + '/' + toLocation.pathname.substr(2);\n    return toLocation;\n  }\n\n  toLocation.pathname = currentLocation.pathname + '/' + toLocation.pathname;\n  return toLocation;\n}\n\n\nexport {History, Location};","import * as React from 'react';\nimport {connect} from 'react-redux';\nimport isDeepEqual = require('fast-deep-equal');\n\nimport {addWidgetManifestProperties, getWidgetsByName, addWidgetDefaultLabelAndIcon, getWidgetContext} from './utils/app-config';\nimport {getWidgetCallbackNamesFromWidgetState} from './utils/utils';\nimport {logShallowDiff, loadstyle} from './utils/utils';\nimport {IMWidgetJson, WidgetJson, IMWidgetContext} from './types/app-config';\nimport {WidgetManifest} from './types/manifest';\nimport {IMState} from './types/state';\nimport {WidgetProps, WidgetInjectedProps, AllWidgetProps} from './types/props';\nimport {store} from './store';\nimport * as actions from './app-actions';\nimport I18NManager from './i18n-manager';\nimport ExtensionManager from './extension-manager';\nimport {amdRequire} from './amd-loader';\nimport {WidgetClassWrapperExtension, ExtensionPoints, DependencyDefine} from './extension-spec/extension-spec';\nimport {loadResources} from './resource-loader';\nimport BaseWidget from './base-widget';\nimport DataSourceManager from './data-source-manager';\nimport { DataSource } from '..';\nimport SessionManager from './session-manager';\nimport { AuthenticationProvider } from '@esri/arcgis-rest-auth';\n\ninterface WidgetRawClassInfo{\n  clazz: any;\n  nls: any\n}\nexport default class WidgetManager{\n\n  static instance: WidgetManager;\n  static getInstance(){\n    if(!WidgetManager.instance){\n      WidgetManager.instance = new WidgetManager();\n      window._widgetManager = WidgetManager.instance;\n    }\n    return WidgetManager.instance;\n  }\n\n  widgetRawClasses: {\n    [widgetName: string]: Promise<WidgetRawClassInfo>\n  } = {};\n\n  //Class here has been wrapped\n  widgetClasses: {\n    [widgetId: string]: React.ComponentClass<WidgetProps>\n  } = {};\n  \n  private dependencyResources:{[resourceUrl: string]: 'loading' | 'loaded'} = {};\n\n  getWidgetClass(widgetId: string): React.ComponentClass<WidgetProps>{\n    return this.widgetClasses[widgetId];\n  }\n\n  deleteWidgetClass(widgetId: string){\n    delete this.widgetClasses[widgetId];\n  }\n\n  loadWidgetClass(widgetId: string): Promise<React.ComponentClass<WidgetProps>>;\n  loadWidgetClass(widgetJson: IMWidgetJson): Promise<React.ComponentClass<WidgetProps>>;\n  loadWidgetClass(w): any{\n    let widgetJson: IMWidgetJson;\n    if(typeof w === 'string'){\n      widgetJson = store.getState().appConfig.widgets[w];\n    }else{\n      widgetJson = w;\n    }\n\n    let wrapWidgetClass = (_WidgetClass, nls) => {\n      var WidgetClass = _WidgetClass.default? _WidgetClass.default: _WidgetClass;\n\n      if(widgetJson.manifest.properties.isDojoWidget){\n        return this.appWidgetClassWrapperExtension(WidgetClass, widgetJson, nls);\n      }else{\n        let WidgetContextClass = this.injectWidgetProps(WidgetClass, nls, widgetJson);\n        return this.appWidgetClassWrapperExtension(WidgetContextClass, widgetJson, nls);\n      }\n    };\n    \n    return this.loadRawClass(widgetJson).then( classInfo => {\n      return wrapWidgetClass(classInfo.clazz, classInfo.nls);\n    }).then((widgetClass: React.ComponentClass<WidgetProps>) => {\n      this.widgetClasses[widgetJson.id] = widgetClass;\n      store.dispatch(actions.widgetClassLoaded(widgetJson.id));    \n      return widgetClass;\n    });\n  }\n\n  loadRawClass(widgetJson: IMWidgetJson): Promise<WidgetRawClassInfo>{\n    let widgetName = widgetJson.manifest.name;\n    if(this.widgetRawClasses[widgetName]){\n      return this.widgetRawClasses[widgetName];\n    }\n\n    this.widgetRawClasses[widgetName] = this.loadWidgetDependency(widgetJson).then(() => {\n      let uri = `${widgetJson.uri}/dist/runtime/widget`;\n      return amdRequire(uri);\n    }).then( WidgetClass => {\n      if(widgetJson.manifest.properties.hasLocale){\n        return this.loadWidgetNls(widgetJson).then(nls => {\n          return {\n            clazz: WidgetClass,\n            nls: nls\n          }\n        });\n      }else{\n        return {\n          clazz: WidgetClass,\n          nls: {}\n        };\n      }\n    })\n\n    return this.widgetRawClasses[widgetName];\n  }\n\n  appWidgetClassWrapperExtension(WidgetClass: React.ComponentClass<WidgetProps>, widgetJson: IMWidgetJson, nls: any): React.ComponentClass<WidgetProps>{\n    let extension = ExtensionManager.getInstance().getExtensions(ExtensionPoints.WidgetClassWrapper)[0];\n    if(!extension){\n      if(widgetJson.manifest.properties.isDojoWidget){\n        throw Error('Please write a WidgetClassWrapperExtension to support Dojo widget.');\n      }\n      return WidgetClass;\n    }\n\n    return (extension as WidgetClassWrapperExtension).wrap(WidgetClass, widgetJson, nls);;\n  }\n\n  handleNewWidgetJson(widgetJson: WidgetJson): Promise<WidgetJson>{\n    widgetJson.context = getWidgetContext(widgetJson.uri) as IMWidgetContext;\n\n    return WidgetManager.getInstance().loadWidgetManifest(widgetJson).then(manifest => {\n      widgetJson.manifest = manifest;\n\n      addWidgetDefaultLabelAndIcon(widgetJson);\n      return this.loadWidgetConfig(widgetJson);\n    }).then(widgetConfig => {\n      widgetJson.config = widgetConfig;\n\n      //TODO handle extension, action\n      return widgetJson;\n    });\n  }\n\n  loadWidgetManifest(widgetJson: WidgetJson): Promise<WidgetManifest>{\n    var url;\n    if(widgetJson.context.isRemote){\n      url = widgetJson.context.folderUrl + 'manifest.json?f=json';\n    }else{\n      url = widgetJson.context.folderUrl + 'manifest.json';\n    }\n\n    //json.manifest is added in configmanager if manifest is merged.\n    if(widgetJson.manifest){\n      return Promise.resolve(widgetJson.manifest);\n    }\n\n    return fetch(url).then(res => res.json()).then((res: any) => {\n      if(res.error && res.error.code){\n        //request manifest from AGOL item, and there is an error\n        //error code may be: 400, 403\n        return Promise.reject(res.error);\n      }\n\n      let manifest: WidgetManifest = res;\n\n      addWidgetManifestProperties(manifest);\n\n      if(!widgetJson.label){\n        if(manifest.properties.hasLocale){\n          return this.loadWidgetNls(widgetJson).then(widgetNls => {\n            manifest.i18nLabels = {[store.getState().appContext.locale]: widgetNls._widgetLabel};\n            return manifest;\n          });\n        }else{\n          return manifest;\n        }        \n      }else{\n        return manifest;\n      }\n    });\n  }\n\n  loadWidgetConfig(widgetJson: WidgetJson): Promise<any> {\n    return this.tryLoadWidgetConfig(widgetJson).then(widgetConfig => {\n      return this.upgradeWidgetConfig(widgetJson, widgetConfig).then(function(widgetConfig){\n        widgetJson.config = widgetConfig;\n        return widgetConfig;\n      });\n    });\n  }\n\n  upgradeWidgetConfig(widgetJson: WidgetJson, oldConfig): Promise<any>{\n      var widgetVersion = widgetJson.manifest.version;\n      var configVersion = widgetJson.version;\n      var newConfig;\n\n      if(widgetVersion === configVersion){\n        return Promise.resolve(oldConfig);\n      }\n\n      if(widgetJson.manifest.properties.hasVersionManager === false){\n        //if widget doesn't have version manager, we assume the widget\n        //is old version compatible\n\n        //widget config loaded from builder needs update version\n        widgetJson.version = widgetVersion;\n        return Promise.resolve(oldConfig);\n      }\n\n      return new Promise((resolve, reject) => {\n        window.amdRequire([widgetJson.context.amdFolder + 'VersionManager'], (VersionManager) => {\n          var versionManager = new VersionManager();\n\n          var configVersionIndex = versionManager.getVersionIndex(configVersion);\n          var widgetVersionIndex = versionManager.getVersionIndex(widgetVersion);\n          if(configVersionIndex > widgetVersionIndex){\n            reject('Bad widget version number, ' + widgetJson.manifest.name + ',' + configVersion);\n          }else{\n            try{\n              newConfig = versionManager.upgrade(oldConfig, configVersion, widgetVersion);\n              widgetJson.version = widgetVersion;\n              resolve(newConfig);\n            }catch(err){\n              console.log('Read widget [' + widgetJson.manifest.name + '] old config error,' + err.stack);\n              resolve(oldConfig);\n            }\n          }\n        });\n      });\n    }\n\n  tryLoadWidgetConfig(widgetJson: WidgetJson): Promise<any>{\n    if (widgetJson.config){\n      if(typeof widgetJson.config === 'object'){\n        return Promise.resolve(widgetJson.config);\n      }else {\n        return fetch(widgetJson.config).then(res => res.json()).then(widgetConfig => {\n          widgetJson.config = widgetConfig;\n          return widgetConfig;\n        });\n      };\n    } else {\n      if(widgetJson.manifest.properties.hasConfig){\n        return fetch(`${widgetJson.context.folderUrl}config.json`).then(res => res.json())\n        .then(widgetConfig => {\n          widgetJson.config = widgetConfig;\n          return widgetConfig;\n        });\n      }else{\n        widgetJson.config = {};\n        return Promise.resolve({});\n      }\n    }\n  }\n\n  loadWidgetNls(widgetJson: WidgetJson): Promise<any>{\n    return I18NManager.getInstance().loadNls(`${widgetJson.context.amdFolder}dist/runtime/nls/strings`);\n  }\n\n  private loadWidgetDependency(widgetJson: IMWidgetJson): Promise<void>{\n    if(!widgetJson.manifest.dependency){\n      return Promise.resolve();\n    }\n\n    let extensions = ExtensionManager.getInstance().getExtensions(ExtensionPoints.DependencyDefine);\n    let widgetDependencies = typeof widgetJson.manifest.dependency === 'string'? [widgetJson.manifest.dependency]: widgetJson.manifest.dependency;\n\n    let resources = [];\n    widgetDependencies.forEach(dependency => {\n      let ext = extensions.filter(ext => (ext as DependencyDefine).getDependencyKey() === dependency)[0] as DependencyDefine;\n      if(ext){\n        resources = resources.concat(ext.getResources());\n      }else{\n        if(/^http/.test(dependency)){\n          resources.push(dependency);\n        }else{\n          console.error('Unknown dependency in widget.', widgetJson.manifest.name);\n        }\n      }\n    });\n\n    //TODO handle failure.\n    let newResources = resources.filter(r => !this.dependencyResources[r]);\n    newResources.forEach(r => {\n      this.dependencyResources[r] = 'loading';\n    });\n    if(newResources.length === 0){\n      return Promise.resolve();\n    }\n\n    let cssResources = newResources.filter(r => /\\.css$/.test(r));\n    let jsResources = newResources.filter(r => /\\.js$/.test(r));\n    return Promise.all([\n      Promise.all(cssResources.map(r => loadstyle(r))).then(() => {\n        cssResources.forEach(r => {\n          this.dependencyResources[r] = 'loaded';\n        });\n      }),\n      amdRequire(jsResources).then(() => {\n        jsResources.forEach(r => {\n          this.dependencyResources[r] = 'loaded';\n        });\n      })\n    ]).then(() => {\n      \n    });\n  }\n\n  injectWidgetProps(WrappedComponent, nlsStrings: any, widgetJson: IMWidgetJson): React.ComponentClass<WidgetProps> {\n    interface WidgetState{\n      dataSources: {[dsId: string]: DataSource}\n    }\n    class WidgetWrapper extends BaseWidget<AllWidgetProps<{}>, WidgetState> {\n      static displayName = `WidgetWrapper(${widgetJson.manifest.name})`;\n      private dsManager: DataSourceManager;\n\n      constructor(props) {\n        super(props);\n        this.dsManager = DataSourceManager.getInstance();\n        this.state = {\n          dataSources: {}\n        };\n      }\n\n      onSignIn(provider?: AuthenticationProvider) {\n        return SessionManager.getInstance().signIn(provider);\n      }\n\n      onSignOut() {\n        return SessionManager.getInstance().signOut();\n      }\n\n      componentDidMount(){\n        let dataSources = {};\n\n        this.props.useDataSources && this.props.useDataSources.forEach(dsId => {\n          let ds = this.dsManager.getDataSource(dsId);\n          if(!ds){\n            ds = this.dsManager.createDataSource(dsId);\n          }\n\n          dataSources[dsId] = ds;\n        });\n\n        this.setState({dataSources: dataSources});\n      }\n\n      render() {\n        let injectProps:any = {\n          nls: nlsStrings,\n          onSignIn: this.onSignIn,\n          onSignOut: this.onSignOut\n        };\n        \n        injectProps.dataSources = this.state.dataSources;\n\n        return (<WrappedComponent {...this.props} {...injectProps}/>);\n      }\n    }\n  \n    //copy static properites\n    for(let p in WrappedComponent){\n      if(!WidgetWrapper[p]){\n        WidgetWrapper[p] = WrappedComponent[p];\n      }\n    }\n\n    const mapStateToProps = (state: IMState) => {\n      let runtimeInfo = state.widgetsRuntimeInfo[widgetJson.id];\n  \n      let props: any = {\n        queryObject: state.queryObject,\n        portalUrl: state.portalUrl,\n        dataSourcesInfo: {},\n        user: state.user,\n        token: state.token\n      };\n\n      widgetJson.useDataSources && widgetJson.useDataSources.forEach(dsId => {\n        if(state.dataSourcesInfo && state.dataSourcesInfo[dsId]){\n          props.dataSourcesInfo[dsId] = {\n            status: state.dataSourcesInfo[dsId].status,\n            currentIndexes: state.dataSourcesInfo[dsId].currentIndexes\n          }\n        }        \n      });\n\n      if(store.getState().appContext.isBuilder){\n        props.appState = state.appState;\n      }\n      \n      // console.log(getWidgetById(state.appConfig, widgetJson.id));\n      let allOwnProps = Object.assign(props, state.appConfig.widgets[widgetJson.id], runtimeInfo)\n      return Object.assign(\n        allOwnProps,\n        WrappedComponent.mapExtraStateProps? WrappedComponent.mapExtraStateProps(state, allOwnProps): {});\n    };\n    return connect(mapStateToProps)(WidgetWrapper) as React.ComponentClass<WidgetProps>;\n  }\n}\n","import { ReduxStoreExtension } from '../extension-spec/extension-spec';\nimport { LayoutMap } from './types';\nimport { globalLayoutReducer } from './reducers/global-reducers';\nimport { GlobalLayoutActions } from './actions/global-layout-actions';\n\ndeclare module 'jimu-core/lib/types/state'{\n  interface State{\n    layouts?: {[key: string]: LayoutMap}\n  }\n}\n\ndeclare module 'jimu-core'{\n  interface State{\n    layouts?: {[key: string]: LayoutMap}\n  }\n}\n\nexport default class GlobalLayoutReduxStoreExtension implements ReduxStoreExtension{\n  id = 'global-layout-redux-store-extension';\n\n  getActions(){\n    return [\n      GlobalLayoutActions.ADD_WIDGET,\n      GlobalLayoutActions.ADD_SECTION,\n      GlobalLayoutActions.REMOVE_LAYOUT,\n      GlobalLayoutActions.RESIZE_LAYOUTS,\n      GlobalLayoutActions.UPDATE_SETTING,\n      GlobalLayoutActions.REMOVE_WIDGET,\n      GlobalLayoutActions.ADD_LAYOUT,\n      GlobalLayoutActions.DRAG_DROP_LAYOUT,\n      GlobalLayoutActions.ACTIVATE,\n      GlobalLayoutActions.REMOVE_SECTION,\n      GlobalLayoutActions.UPDATE_LAYOUT,\n      GlobalLayoutActions.CHANGE_ORDER\n    ];\n  }\n\n  getInitLocalState(){\n    return {\n      \"default\": {\n        \"0\": {\n          \"id\": \"0\",\n          \"pos\": {\n            \"x\": 0,\n            \"y\": 0,\n            \"w\": 100,\n            \"h\": 100\n          },\n          \"type\": 0\n        }\n      }\n    };\n  }\n\n  getReducer(){\n    return globalLayoutReducer;\n  }\n\n  getStoreKey(){\n    return `appConfig.layouts`;\n  }\n}","import * as actions from './app-actions';\nimport {store} from './store';\nimport {IMAppConfig} from './types/app-config';\nimport {changePage, changeView} from './browser-history';\nimport WidgetManager from './widget-manager';\nimport {addWidget, addSection, removeSection, removeWidget, updateLayout} from './layouts/actions/global-layout-actions';\nimport {getAppConfigDiff} from './utils/app-config';\n\nvar pubsub = window.top._builderPubsub;\nexport function listenBuilderEvents(){\n  if(!pubsub){\n    return;\n  }\n\n  pubsub.subscribe('to_app', function(evt, data){\n    console.log(evt, data);\n  });\n  pubsub.subscribe('to_app.app_config_changed', function(evt, appConfig: IMAppConfig){\n    //do other things (in addition to app reducer) when app config change\n    let appConfigDiff = getAppConfigDiff(store.getState().appConfig, appConfig);\n    appConfigDiff.removedWidgets.forEach(wId => {\n      WidgetManager.getInstance().deleteWidgetClass(wId);\n    });\n\n    store.dispatch(actions.appConfigChanged(appConfig, appConfigDiff));\n  });\n\n  pubsub.subscribe('to_app.app_mode_changed', function(action, mode){\n    store.dispatch(actions.appModeChanged(mode));\n  });\n\n  pubsub.subscribe('to_app.high_light', function(action, widgetId){\n    store.dispatch(actions.toggleWidgetHighlight(widgetId, true));\n  });\n\n  pubsub.subscribe('to_app.remove_high_light', function(action, widgetId){\n    store.dispatch(actions.toggleWidgetHighlight(widgetId, false));\n  });\n\n  pubsub.subscribe('to_app.set_app_in_builder', function(action){\n    store.dispatch(actions.setAppInBuilder());\n  });\n\n  pubsub.subscribe('to_app.change_page', function(action, pageId){\n    changePage(pageId);\n  });\n\n  pubsub.subscribe('to_app.change_view', function(action, {sectionId, viewId}){\n    changeView(sectionId, viewId);\n  });\n\n  pubsub.subscribe('to_app.change_current_setting_widget', function(action, widgetId){\n    store.dispatch(actions.setWidgetIsSettingState(widgetId, true));\n  });\n\n  pubsub.subscribe('to_app.toggle_widget_highlight', function(action, {widgetId, isHighlight}){\n    store.dispatch(actions.toggleWidgetHighlight(widgetId, isHighlight));\n  });\n\n  pubsub.subscribe('to_app.add_widget', function(action, info){\n    store.dispatch(addWidget(info.widgetId, info.layoutInfo));\n    \n  });\n\n  pubsub.subscribe('to_app.add_section', function(action, info){\n    store.dispatch(addSection(info.sectionId, info.layoutInfo));\n  });\n\n  pubsub.subscribe('to_app.remove_widget', function(action, info){\n    store.dispatch(removeWidget(info.widgetId));\n  });\n\n  pubsub.subscribe('to_app.remove_section', function(action, info){\n    store.dispatch(removeSection(info.sectionId));\n  });\n\n  pubsub.subscribe('to_app.update_layout_item', function(action, info){\n    store.dispatch(updateLayout(info.layoutInfo, info.layoutContent.pos, info.layoutContent.setting));\n  });\n}\n\nexport function publishAppStateChangeToBuilder(){\n  publishEventToBuilder('to_builder.app_state_changed', store.getState());\n}\n\nexport function publishCurrentEditWidgetChangeToBuilder(widgetId: string){\n  store.dispatch(actions.setWidgetIsSettingState(widgetId, true));\n  publishEventToBuilder('to_builder.current_widget_changed', widgetId);\n}\n\nexport function publishRemoveWidgetToBuilder(widgetId: string){\n  publishEventToBuilder('to_builder.widget_removed', widgetId);\n}\n\nexport function letBuilderPopupChooseWidget(layoutId: string, layoutItemId: string){\n  publishEventToBuilder('to_builder.popup_choose_widget', {\n    layoutId: layoutId,\n    layoutItemId: layoutItemId\n  });\n}\n\nexport function publishWidgetConfigChangeToBuilder(widgetId: string, widgetConfig){\n  publishEventToBuilder('to_builder.widget_config_changed', {\n    widgetId: widgetId,\n    widgetConfig: widgetConfig\n  });\n}\n\nfunction publishEventToBuilder(action, data?){\n  if(!pubsub){\n    return;\n  }\n\n  pubsub.publish(action, data);\n}","import * as React from 'react';\nimport * as invariant from 'invariant';\nimport { Layout, LayoutType } from './types';\nimport { ActionContext } from './action-context';\n\nconst components = {};\nconst viewComponents = {};\n\nexport function registerLayout(name: string, itemClass: React.ComponentClass) {\n  components[name] = itemClass;\n}\n\nexport function registerLayoutViewer(name: string, itemClass: React.ComponentClass) {\n  viewComponents[name] = itemClass;\n}\n\nexport function isRegistered(name: any) {\n  return typeof components[name] !== 'undefined';\n}\n\nexport function isViewerRegistered(name: any) {\n  return typeof viewComponents[name] !== 'undefined';\n}\n\nexport class LayoutFactory {\n  static createLayout(type: LayoutType, layout: Layout, props?: any) {\n    invariant(components[type], `${type} not registered`);\n    const LayoutElement = components[type];\n    return (\n      <ActionContext.Consumer>\n        {actions => <LayoutElement layout={layout} {...props}\n          actionContext={actions}\n          >\n        </LayoutElement>}\n      </ActionContext.Consumer>\n    );\n  }\n\n  static createLayoutViewer(layout: Layout, props?: any) {\n    const type = layout.type;\n    invariant(viewComponents[type], `${type} not registered`);\n    const LayoutElement = viewComponents[type];\n    if (type === LayoutType.SIDEBAR_LAYOUT) {\n      return (\n        <ActionContext.Consumer>\n          {actions => <LayoutElement layout={layout} {...props}\n            actionContext={actions}>\n          </LayoutElement>}\n        </ActionContext.Consumer>\n      );\n    } else {\n      return <LayoutElement layout={layout} {...props}></LayoutElement>;\n    }\n  }\n}","import * as React from 'react';\nimport classNames = require(\"classnames\");\nimport hoistNonReactStatic = require('hoist-non-react-statics');\nimport Resizable, {ResizeEnable, ResizableDelta, Position} from 'react-rnd';\nimport { isActiveLayout } from './utils';\nimport { LayoutProps } from './types';\nimport './style/handle.scss';\n\nexport interface ResizeHandlers {\n  onResizeStart?: (id: string) => void;\n  onResizing?: (id: string, dx: number, dy: number, width: number, height: number) => void;\n  onResizeEnd?: (id: string, dx: number, dy: number, width: number, height: number) => void;\n  top?: boolean;\n  left?: boolean;\n  right?: boolean;\n  bottom?: boolean;\n  disableInteract?: boolean;\n  minWidth?: number;\n  maxWidth?: number;\n  minHeight?: number;\n  maxHeight?: number;\n  resizeGrid?: [number, number];\n  restrict?: boolean;\n}\n\ninterface ResizableState {\n  deltaSize: ResizableDelta,\n  deltaPos: Position,\n  isResizing: boolean\n}\n\nexport type ResizableProps = LayoutProps & ResizeHandlers;\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n}\n\nexport default function resizable(injectProps?) {\n  return (WrapperComponent: React.ComponentType<LayoutProps>) => {\n    class ResizableComponent extends React.PureComponent<ResizableProps, ResizableState> {\n      static displayName = `resizable(${getDisplayName(WrapperComponent)})`;\n\n      state = {\n        deltaSize: {width: 0, height: 0},\n        deltaPos: {x: 0, y: 0},\n        isResizing: false\n      }\n\n      _enableResizing(): ResizeEnable {\n        const {left, right, top, bottom, disableInteract} = this.props;\n        return {\n          top: disableInteract !== true && top !== false,\n          right: disableInteract !== true && right !== false,\n          bottom: disableInteract !== true && bottom !== false,\n          left: disableInteract !== true && left !== false,\n          topRight: disableInteract !== true && top !== false && right !== false,\n          bottomRight: disableInteract !== true && bottom !== false && right !== false,\n          bottomLeft: disableInteract !== true && bottom !== false && left !== false,\n          topLeft: disableInteract !== true && top !== false && left !== false\n        };\n      }\n\n      _onResizeStop(e: MouseEvent | TouchEvent,\n      dir,\n      refToElement,\n      delta: ResizableDelta,\n      position: Position) {\n        e.preventDefault();\n        e.stopPropagation();\n        const { layout, onResizeEnd } = this.props;\n        if (onResizeEnd) {\n          onResizeEnd(layout.id, position.x,\n          position.y, delta.width, delta.height);\n        }\n        this.setState({\n          deltaSize: {width: 0, height: 0},\n          deltaPos: {x: 0, y: 0},\n          isResizing: false\n        });\n      }\n\n      _onResize(e: MouseEvent | TouchEvent,\n        dir,\n        refToElement,\n        delta: ResizableDelta,\n        position: Position) {\n        e.preventDefault();\n        e.stopPropagation();\n        const { layout, onResizing } = this.props;\n        if (onResizing) {\n          onResizing(layout.id, position.x,\n            position.y, delta.width, delta.height);\n        }\n        this.setState({\n          isResizing: true,\n          deltaSize: delta,\n          deltaPos: position\n        });\n      }\n\n      _onResizeStart(e: React.SyntheticEvent<HTMLDivElement>) {\n        e.preventDefault();\n        e.stopPropagation();\n        const { layout, onResizeStart } = this.props;\n        if (onResizeStart) {\n          onResizeStart(layout.id);\n        }\n      }\n\n      render() {\n        const { pos, className, minHeight, minWidth, maxHeight, maxWidth, resizeGrid, appMode, restrict,\n          disableInteract, ...passThroughProps } = this.props;\n        const { deltaSize, deltaPos, isResizing } = this.state;\n\n        const displayPos = {\n          x: 0,\n          y: 0,\n          w: pos.w + deltaSize.width,\n          h: pos.h + deltaSize.height\n        };\n\n        const enableResizing = this._enableResizing();\n        const actions = this._actionHandlers(enableResizing);\n        const isActive = isActiveLayout(this.props.layout) && disableInteract !== true;\n        const mergedClass = classNames('exb-resizable', className, {\n          active: isActive\n        });\n\n        const resizeHandleStyles = {\n          bottom: {\n            bottom: 0,\n            left: 0\n          },\n          bottomLeft: {\n            left: 0,\n            bottom: 0\n          },\n          bottomRight: {\n            right: 0,\n            bottom: 0\n          },\n          left: {\n            left: 0,\n            top: 0\n          },\n          right: {\n            right: 0,\n            top: 0\n          },\n          top: {\n            left: 0,\n            top: 0\n          },\n          topLeft: {\n            left: 0,\n            top: 0\n          },\n          topRight: {\n            top: 0,\n            right: 0\n          }\n        }\n\n        return (\n          <Resizable disableDragging={true}\n          className={mergedClass}\n          enableResizing={enableResizing}\n          minHeight={minHeight}\n          minWidth={minWidth}\n          maxHeight={maxHeight}\n          maxWidth={maxWidth}\n          resizeGrid={resizeGrid || [1, 1]}\n          position={{x: isResizing ? deltaPos.x : pos.x, y: isResizing ? deltaPos.y : pos.y}}\n          size={{width: displayPos.w, height: displayPos.h}}\n          onResizeStart={this._onResizeStart.bind(this)}\n          onResize={this._onResize.bind(this)}\n          onResizeStop={this._onResizeStop.bind(this)}\n          resizeHandleStyles={resizeHandleStyles}>\n            <WrapperComponent pos={displayPos} appMode={appMode} disableInteract={disableInteract}\n              restrict={restrict} {...injectProps} {...passThroughProps}/>\n            { isActive && actions}\n          </Resizable>\n        );\n      }\n\n      _getLayoutId() {\n        return this.props.layout ? this.props.layout.id : '';\n      }\n\n      _actionHandlers(enableResizing: ResizeEnable) {\n        let handlers = [];\n\n        if (enableResizing.top) {\n          handlers.push(\n            <span key=\"2\" className=\"handle handle-resize top-resize-cursor handle-resize-side top\"></span>\n          );\n        }\n        if (enableResizing.right) {\n          handlers.push(\n            <span key=\"4\" className=\"handle handle-resize right-resize-cursor handle-resize-side right\"></span>\n          );\n        }\n        if (enableResizing.bottom) {\n          handlers.push(\n            <span key=\"6\" className=\"handle handle-resize bottom-resize-cursor handle-resize-side bottom\"></span>\n          );\n        }\n        if (enableResizing.left) {\n          handlers.push(\n            <span key=\"8\" className=\"handle handle-resize left-resize-cursor handle-resize-side left\"></span>\n          );\n        }\n        if (enableResizing.topLeft) {\n          handlers.push(\n            <span key=\"1\" className=\"handle handle-resize top-left-resize-cursor handle-resize-corner top left\"></span>\n          );\n        }\n        if (enableResizing.topRight) {\n          handlers.push(\n            <span key=\"3\" className=\"handle handle-resize top-right-resize-cursor handle-resize-corner top right\"></span>\n          );\n        }\n        if (enableResizing.bottomRight) {\n          handlers.push(\n            <span key=\"5\" className=\"handle handle-resize bottom-right-resize-cursor handle-resize-corner bottom right\"></span>\n          );\n        }\n        if (enableResizing.bottomLeft) {\n          handlers.push(\n            <span key=\"7\" className=\"handle handle-resize bottom-left-resize-cursor handle-resize-corner bottom left\"></span>\n          );\n        }\n        return handlers;\n      }\n    }\n\n    hoistNonReactStatic(ResizableComponent, WrapperComponent);\n    return ResizableComponent;\n  };\n}","export enum DND_TYPES {\n  LAYOUT = 'layout'\n}","import * as React from 'react';\nimport { connect } from 'react-redux';\nimport * as invariant from 'invariant';\nimport { Layout, LayoutProps, LayoutActionContext } from '../types';\nimport { getSectionLayout, emptyFunc } from '../utils';\nimport { LayoutItem } from '../layout-item';\nimport { IMAppConfig } from '../../types/app-config';\nimport { UrlParameters } from '../../types/url-parameters';\nimport { IMState } from '../../types/state';\nimport { AppMode } from '../../types/constants';\n\ninterface Props {\n  layout: Layout;\n  width: number;\n  height: number;\n  actionContext?: LayoutActionContext;\n}\n\ninterface StateProps{\n  appConfig: IMAppConfig;\n  queryObject: UrlParameters,\n  appMode: AppMode,\n  isMobile: boolean,\n  dispatch?: any\n}\n\nexport class SectionLayout extends React.Component<Props & StateProps> {\n  static defaultProps: Partial<Props> = {\n    actionContext: {\n      updateSetting: emptyFunc,\n      addLayout: emptyFunc,\n      removeLayout: emptyFunc,\n      resizeLayouts: emptyFunc,\n      dndLayout: emptyFunc,\n      activate: emptyFunc,\n      removeWidget: emptyFunc\n    }\n  };\n\n  constructor(props) {\n    super(props);\n  }\n\n  _getCurrentLayoutId() {\n    const { appConfig, queryObject, layout, isMobile, width, height } = this.props;\n    const section = appConfig.sections[layout.sectionId];\n    invariant(section, `no section in appConfig with id ${layout.sectionId}`);\n    if (section.views && section.views.length > 0) {\n      let viewId = section.views[0];\n      if(queryObject.views){\n        let viewsId: string[] = queryObject.views.split(',');\n        viewsId.forEach(vId => {\n          if(section.views.indexOf(vId) > -1){//the view id in URL parameter is in this section\n            viewId = vId;\n          }\n        });\n      }\n      const view = appConfig.views[viewId];\n      invariant(view, `no view in appConfig with id ${viewId}`);\n      let layout;\n      if (isMobile) {\n        if (view.mobileTheresholdSize &&\n          (view.mobileTheresholdSize.width > width || view.mobileTheresholdSize.height > height)) {\n          layout = view.mobileLayoutCompact || view.mobileLayout || view.layout;\n        } else {\n          layout = view.mobileLayout || view.layout;\n        }\n      } else {\n        if (view.desktopThresholdSize &&\n          (view.desktopThresholdSize.width > width || view.desktopThresholdSize.height > height)) {\n          layout = view.desktopLayoutCompact || view.layout;\n        } else {\n          layout = view.layout;\n        }\n      }\n      return layout;\n    }\n    return null;\n  }\n\n  render() {\n    const { appConfig, layout, width, height, appMode } = this.props;\n    const layoutId = this._getCurrentLayoutId();\n    const sectionLayout = getSectionLayout(layoutId, appConfig);\n    if (!sectionLayout) {\n      return null;\n    }\n    const pos = {\n      x: 0,\n      y: 0,\n      w: width,\n      h: height\n    };\n\n    return (\n      <div className='section-layout'\n      data-sectionid={layout.sectionId}\n      data-layoutitemid={layout.id}\n      data-layoutid={layout.layoutId}>\n        <LayoutItem layout={sectionLayout as any} appMode={appMode} pos={pos} style={{position: 'relative'}}>\n        </LayoutItem>\n      </div>\n    )\n  }\n}\n\nconst mapStateToProps = (state: IMState) => {\n  return {\n    appConfig: state.appConfig,\n    queryObject: state.queryObject,\n    appMode: state.appMode,\n    isMobile: state.appContext.isMobile\n  }\n};\n\nexport default connect<StateProps, {}, Props>(mapStateToProps)(SectionLayout);","import assign = require(\"lodash.assign\");\nimport { AttachType, SidebarItemSetting } from '../types';\nimport { DEFAULT_LAYOUT_SETTING } from '../default-common-setting';\n\nexport const DEFAULT_SIDEBAR_SETTING: SidebarItemSetting = assign({}, DEFAULT_LAYOUT_SETTING, {\n  draggable: false,\n  overlay: false,\n  togglable: true,\n  toggleOn: true\n});","import * as React from 'react';\nimport * as Immutable from 'seamless-immutable';\nimport { connect } from 'react-redux';\nimport resizable, {ResizableProps} from '../react-dnd-resizable';\nimport { Layout, Position, AttachType, SidebarItemSetting, LayoutActionContext, LayoutInfo } from '../types';\nimport { autoBindHandlers, getLayoutItem, emptyFunc } from '../utils';\nimport { Sidebar } from './sidebar';\nimport { LayoutItem } from '../layout-item';\n// import { LayoutFactory } from '../layout-factory'\nimport './style/sidebar-layout.scss';\nimport { AppMode } from '../../types/constants';\nimport { IMState } from '../../types/state';\nimport { UrlParameters } from '../../types/url-parameters';\nimport * as utils from './sidebar-layout-util';\n\ninterface SidebarLayoutProps {\n  appMode: AppMode;\n  width: number;\n  height: number;\n  layout: Layout;\n  actionContext?: LayoutActionContext;\n}\n\ninterface StateProps{\n  queryObject: UrlParameters\n}\n\ninterface SidebarLayoutState {\n  layout: Layout;\n  layoutMap: {[key: string]: Layout},\n  // pixelLayouts: {[key: string]: Immutable.ImmutableObject<Position>};\n  resizingSide: AttachType;\n  delta: {w: number, h: number};\n}\n\nclass SidebarLayoutPrototype extends React.Component<SidebarLayoutProps & StateProps, SidebarLayoutState> {\n  static defaultProps: Partial<SidebarLayoutProps> = {\n    layout: null,\n    width: 0,\n    height: 0,\n    actionContext: {\n      updateSetting: emptyFunc,\n      addLayout: emptyFunc,\n      removeLayout: emptyFunc,\n      resizeLayouts: emptyFunc,\n      dndLayout: emptyFunc,\n      activate: emptyFunc,\n      removeWidget: emptyFunc\n    }\n  };\n\n  state: SidebarLayoutState = {\n    layout: null,\n    layoutMap: null,\n    // pixelLayouts: {},\n    resizingSide: null,\n    delta: null\n  }\n\n  interactComponent: React.ComponentType<ResizableProps>;\n\n  constructor(props) {\n    super(props);\n    autoBindHandlers(this, [\n      '_onResizeStart',\n      '_onResizeEnd',\n      '_onResizing',\n      '_onItemToggleChange'\n    ]);\n    this.interactComponent = resizable({\n      onToggleChange: this._onItemToggleChange\n    })(Sidebar);\n    const {layout, queryObject} = this.props;\n    const sideLayouts = utils.collectSidebars(layout.content || [], queryObject && queryObject.layouts);\n\n    this.state = {\n      layout: layout,\n      layoutMap: sideLayouts as {[key: string]: Layout},\n      resizingSide: null,\n      delta: null\n    };\n  }\n\n  static getDerivedStateFromProps(nextProps: SidebarLayoutProps & StateProps, prevState: SidebarLayoutState) {\n    if (nextProps.layout !== prevState.layout) {\n      const {layout} = nextProps;\n      const sideLayouts = utils.collectSidebars(layout.content || []);\n\n      return {\n        layout: nextProps.layout,\n        layoutMap: sideLayouts\n      };\n    }\n    return null;\n  }\n\n  _onResizeStart(id: string) {\n    const {layout} = this.props;\n    let targetLayout: Layout;\n    layout.content.some(layoutItem => {\n      if(layoutItem.id === id) {\n        targetLayout = layoutItem;\n        return true;\n      }\n    });\n    this.setState({\n      resizingSide: (targetLayout.setting as SidebarItemSetting).attach\n    });\n  }\n\n  _onResizing(id: string, x: number, y: number, dw: number, dh: number) {\n    this.setState({\n      delta: {w: dw, h: dh}\n    });\n  }\n\n  _onResizeEnd(id: string, x: number, y: number, dw: number, dh: number) {\n    const { layoutMap, resizingSide, delta } = this.state;\n    const { width, height, actionContext, layout } = this.props;\n    const positionMap = utils.calculatePosition(layoutMap, width, height, resizingSide, delta);\n\n    if (resizingSide && delta) {\n      switch(resizingSide) {\n        case AttachType.LEFT:\n          positionMap['left'].w += delta.w;\n          break;\n        case AttachType.RIGHT:\n          positionMap['right'].x -= delta.w;\n          positionMap['right'].w += delta.w;\n          break;\n        case AttachType.TOP:\n          positionMap['header'].h += delta.h;\n          break;\n        case AttachType.BOTTOM:\n          positionMap['footer'].y -= delta.h;\n          positionMap['footer'].h += delta.h;\n          break;\n      }\n    }\n\n    let results = [];\n    Object.keys(positionMap).forEach(key => {\n      if (key !== 'main') {\n        results.push({\n          id: layoutMap[key].id,\n          layoutId: layout.layoutId,\n          pos: positionMap[key]\n        });\n      }\n    });\n\n    this.setState({\n      resizingSide: null,\n      delta: null\n    });\n    actionContext.resizeLayouts(results);\n  }\n\n  _onItemToggleChange(id: string, toggle: boolean) {\n    const { layout, actionContext } = this.props;\n    const targetLayout = getLayoutItem(layout.content, id);\n    if (targetLayout) {\n      const setting = Immutable(targetLayout.setting || {}).set('toggleOn', toggle);\n      actionContext.updateSetting({\n        layoutId: layout.layoutId,\n        layoutItemId: id\n      }, setting);\n    }\n  }\n\n  _createSidebar(direction: string, position: Position) {\n    const { layoutMap } = this.state;\n    const setting = layoutMap[direction].setting as SidebarItemSetting;\n    const { attach, min, max, resizable, togglable, toggleOn } = setting;\n    const horizontal = attach === AttachType.LEFT || attach === AttachType.RIGHT;\n    const ResizableSidebar = this.interactComponent;\n\n    return <ResizableSidebar\n      pos={position}\n      layout={layoutMap[direction]}\n      appMode={this.props.appMode}\n      disableInteract={!resizable || (togglable && !toggleOn)}\n      onResizeStart={this._onResizeStart}\n      onResizing={this._onResizing}\n      onResizeEnd={this._onResizeEnd}\n      minWidth={horizontal ? min : 0}\n      maxWidth={horizontal ? max : undefined}\n      minHeight={horizontal ? 0 : min}\n      maxHeight={horizontal ? undefined : max}\n      left={attach === AttachType.RIGHT}\n      right={attach === AttachType.LEFT}\n      top={attach === AttachType.BOTTOM}\n      bottom={attach === AttachType.TOP}\n      className={direction}\n    ></ResizableSidebar>;\n  }\n\n  render() {\n    const {  layoutMap, resizingSide, delta } = this.state;\n    const { width, height, layout, appMode } = this.props;\n    const positionMap = utils.calculatePosition(layoutMap, width, height, resizingSide, delta);\n\n    return (<div className=\"sidebar-layout\" data-layoutid={layout.layoutId} data-layoutitemid={layout.id}>\n      {positionMap.main && <LayoutItem layout={layoutMap.main} pos={positionMap['main']} appMode={appMode}></LayoutItem>}\n      {positionMap.header && this._createSidebar('header', positionMap['header'])}\n      {positionMap.left && this._createSidebar('left', positionMap['left'])}\n      {positionMap.right && this._createSidebar('right', positionMap['right'])}\n      {positionMap.footer && this._createSidebar('footer', positionMap['footer'])}\n    </div>)\n  }\n}\n\nconst mapStateToProps = (state: IMState) => {\n  return {\n    queryObject: state.queryObject\n  }\n};\n\nexport const SidebarLayout = connect<StateProps, {}, SidebarLayoutProps>(mapStateToProps)(SidebarLayoutPrototype);\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./layout.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./layout.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./layout.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","import { FixedLayoutSetting } from '../types';\nimport assign = require(\"lodash.assign\");\nimport { DEFAULT_LAYOUT_SETTING } from '../default-common-setting';\n\nexport const DEFAULT_FIX_LAYOUT_SETTING: FixedLayoutSetting = assign({}, DEFAULT_LAYOUT_SETTING, {\n  static: false,\n  order: 0,\n  gridSize: 16,\n  restrict: false,\n  alignCenter: false,\n  hPriority: 'left',\n  vPriority: 'top'\n});","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./grid.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./grid.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./grid.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","import * as invariant from 'invariant';\nimport * as Immutable from 'seamless-immutable';\nimport { Layout, Position, CompactType, GridLayoutSetting } from '../types';\nimport { isStaticLayout, getLayoutItem } from '../utils';\n\nconst isProduction = process.env.NODE_ENV === \"production\";\nconst DEBUG = false;\n\n/**\n * Return the bottom coordinate of the layout.\n *\n * @param  {Array} layouts Layout array.\n * @return {Number}       Bottom coordinate.\n */\nexport function bottom(layouts: Array<Layout>): number {\n  let max = 0, bottomY;\n  layouts.forEach(layout => {\n    bottomY = layout.pos.y + layout.pos.h;\n    if (bottomY > max) {\n      max = bottomY;\n    }\n  });\n  return max;\n}\n\n// /**\n//  * Comparing React `children` is a bit difficult. This is a good way to compare them.\n//  * This will catch differences in keys, order, and length.\n//  */\n// export function childrenEqual(a: ReactChildren, b: ReactChildren): boolean {\n//   return isEqual(\n//     React.Children.map(a, c => c.key),\n//     React.Children.map(b, c => c.key)\n//   );\n// }\n\n// /**\n//  * Given two layoutitems, check if they collide.\n//  */\nexport function collides(l1: Layout, l2: Layout): boolean {\n  if (l1 === l2) {// same element\n    return false;\n  }\n  const p1 = l1.pos, p2 = l2.pos\n  if (p1.x + p1.w <= p2.x) return false; // l1 is left of l2\n  if (p1.x >= p2.x + p2.w) return false; // l1 is right of l2\n  if (p1.y + p1.h <= p2.y) return false; // l1 is above l2\n  if (p1.y >= p2.y + p2.h) return false; // l1 is below l2\n  return true; // boxes overlap\n}\n\n/**\n * Given a layout, compact it. This involves going down each y coordinate and removing gaps\n * between items.\n *\n * @param  {Array} layouts Layout.\n * @param  {CompactType} compactType Whether or not to compact the layout vertically.\n * @return {Array}       Compacted Layout.\n */\nexport function compact(\n  layouts: Array<Layout>,\n  compactType: CompactType,\n  cols: number\n): Array<Layout> {\n  // Statics go in the compareWith array right away so items flow around them.\n  const compareWith = getStatics(layouts);\n  // We go through the items by row and column.\n  const sorted = sortLayoutItems(layouts, compactType);\n  // Holding for new items.\n  const out = Array(layouts.length);\n\n  for (let i = 0, len = sorted.length; i < len; i++) {\n    let index = -1;\n    layouts.some((layout, idx) => {\n      if (layout.id === sorted[i].id) {\n        index = idx;\n        return true;\n      }\n    })\n    invariant(index >= 0, 'sorted item is not in the original array');\n    let l;\n    if (Immutable.isImmutable(sorted[i])) {\n      l = sorted[i];\n    } else {\n      l = Immutable(sorted[i]);\n    }\n\n    // Don't move static elements\n    if (!isStaticLayout(l)) {\n      l = compactItem(compareWith, l, compactType, cols, sorted);\n\n      // Add to comparison array. We only collide with items before this one.\n      // Statics are already in this array.\n      compareWith.push(l);\n    }\n    // Clear moved flag, if it exists.\n    l = l.set('moved', false);\n    // Add to output array to make sure they still come out in the right order.\n    out[index] = l;\n  }\n\n  return out;\n}\n\nconst heightWidth = { x: \"w\", y: \"h\" };\n// /**\n//  * Before moving item down, it will check if the movement will cause collisions and move those items down before.\n//  */\nfunction resolveCompactionCollision(\n  layouts: Array<Layout>,\n  item: Immutable.ImmutableObject<Layout>,\n  moveToCoord: number,\n  axis: \"x\" | \"y\"\n) : Immutable.ImmutableObject<Layout> {\n  const sizeProp = heightWidth[axis];\n  item = item.setIn(['pos', axis], item.pos[axis] + 1);\n  let itemIndex = 0;\n  layouts.some((layout, index) => {\n    if (layout.id === item.id) {\n      itemIndex = index;\n      return true;\n    }\n  });\n\n  // Go through each item we collide with.\n  for (let i = itemIndex + 1; i < layouts.length; i++) {\n    const otherItem = Immutable(layouts[i]);\n    // Ignore static items\n    if (isStaticLayout(otherItem)) {\n      continue;\n    }\n\n    // Optimization: we can break early if we know we're past this el\n    // We can do this b/c it's a sorted layout\n    if (otherItem.pos.y > (item.pos.y + item.pos.h)) {\n      break;\n    }\n\n    if (collides(item, otherItem)) {\n      layouts[i] = resolveCompactionCollision(\n        layouts,\n        otherItem,\n        moveToCoord + item.pos[sizeProp],\n        axis\n      );\n    }\n  }\n\n  return item.setIn(['pos', axis], moveToCoord);\n}\n\n/**\n * Compact an item in the layout.\n */\nexport function compactItem(\n  compareWith: Array<Layout>,\n  l: Immutable.ImmutableObject<Layout>,\n  compactType: CompactType,\n  cols: number,\n  fullLayout: Array<Layout>\n): Immutable.ImmutableObject<Layout> {\n  if (compactType === CompactType.VERTICAL) {\n    // Bottom 'y' possible is the bottom of the layout.\n    // This allows you to do nice stuff like specify {y: Infinity}\n    // This is here because the layout must be sorted in order to get the correct bottom `y`.\n    l = l.setIn(['pos', 'y'], Math.min(bottom(compareWith), l.pos.y));\n    // Move the element up as far as it can go without colliding.\n    while (l.pos.y > 0 && !getFirstCollision(compareWith, l)) {\n      l = l.setIn(['pos', 'y'], l.pos.y - 1);\n    }\n  } else if (compactType === CompactType.HORIZONTAL) {\n    l = l.setIn(['pos', 'y'], Math.min(bottom(compareWith), l.pos.y));\n    // Move the element left as far as it can go without colliding.\n    while (l.pos.x > 0 && !getFirstCollision(compareWith, l)) {\n      l = l.setIn(['pos', 'x'], l.pos.x - 1);\n    }\n  }\n\n  // Move it down, and keep moving it down if it's colliding.\n  let collides = getFirstCollision(compareWith, l);\n  while (collides) {\n    if (compactType === CompactType.HORIZONTAL) {\n      l = resolveCompactionCollision(fullLayout, l, collides.pos.x + collides.pos.w, \"x\");\n    } else {\n      l = resolveCompactionCollision(fullLayout, l, collides.pos.y + collides.pos.h, \"y\");\n    }\n    // Since we can't grow without bounds horizontally, if we've overflown, let's move it down and try again.\n    if (compactType === CompactType.HORIZONTAL && l.pos.x + l.pos.w > cols) {\n      l = l.setIn(['pos', 'x'], cols - l.pos.w);\n      l = l.setIn(['pos', 'y'], l.pos.y + 1);\n    }\n    collides = getFirstCollision(compareWith, l);\n  }\n  return l;\n}\n\n/**\n * Given a layout, make sure all elements fit within its bounds.\n *\n * @param  {Array} layout Layout array.\n * @param  {Number} bounds Number of columns.\n */\nexport function correctBounds(\n  layouts: Array<Layout>,\n  cols: number\n): Array<Layout> {\n  const out = Array(layouts.length);\n  const collidesWith = getStatics(layouts);\n  for (let i = 0, len = layouts.length; i < len; i++) {\n    let l = Immutable(layouts[i]);\n    // Overflows right\n    if (l.pos.x + l.pos.w > cols) {\n      l = l.setIn(['pos', 'x'], cols - l.pos.w);\n    }\n    // Overflows left\n    if (l.pos.x < 0) {\n      l = l.setIn(['pos', 'x'], 0);\n      l = l.setIn(['pos', 'w'], cols);\n    }\n    if (!isStaticLayout(l)) {\n      collidesWith.push(l);\n    } else {\n      // If this is static and collides with other statics, we must move it down.\n      // We have to do something nicer than just letting them overlap.\n      while (getFirstCollision(collidesWith, l)) {\n        l = l.setIn(['pos', 'y'], l.pos.y + 1);\n      }\n    }\n    out[i] = l;\n  }\n  return out;\n}\n\n/**\n * Returns the first item this layout collides with.\n * It doesn't appear to matter which order we approach this from, although\n * perhaps that is the wrong thing to do.\n *\n * @param  {Object} layoutItem Layout item.\n * @return {Object|undefined}  A colliding layout item, or undefined.\n */\nexport function getFirstCollision(\n  layout: Array<Layout>,\n  layoutItem: Layout\n): Layout {\n  for (let i = 0, len = layout.length; i < len; i++) {\n    if (collides(layout[i], layoutItem)) {\n      return layout[i];\n    }\n  }\n}\n\nexport function getAllCollisions(\n  layouts: Array<Layout>,\n  layoutItem: Layout\n): Array<Layout> {\n  return layouts.filter(l => collides(l, layoutItem));\n}\n\n/**\n * Get all static elements.\n * @param  {Array} layout Array of layout objects.\n * @return {Array}        Array of static layout items..\n */\nexport function getStatics(layout: Array<Layout>): Array<Layout> {\n  const result = layout.filter(l => isStaticLayout(l));\n  if (Immutable.isImmutable(result)) {\n    return (result as Immutable.ImmutableObject<Array<Layout>>).asMutable();\n  }\n  return result;\n}\n\n/**\n * Move an element. Responsible for doing cascading movements of other elements.\n *\n * @param  {Array}      layouts            Full layout to modify.\n * @param  {String}     layoutId          element id to move.\n * @param  {Number}     [x]               X position in grid units.\n * @param  {Number}     [y]               Y position in grid units.\n */\nexport function moveElement(\n  layouts: Array<Layout>,\n  layoutId: string,\n  compactType: CompactType,\n  cols: number,\n  x?: number,\n  y?: number,\n  isUserAction?: boolean,\n  preventCollision?: boolean,\n): Array<Layout> {\n  let out: Array<Layout>;\n  if (!Immutable.isImmutable(layouts[0])) {\n    out = layouts.map(layout => Immutable(layout));\n  } else {\n    out = layouts as Array<Immutable.ImmutableObject<Layout>>;\n  }\n\n  let l = getLayoutItem(out, layoutId) as Immutable.ImmutableObject<Layout>;\n  const index = out.indexOf(l);\n  invariant(index >= 0, 'layoutId should in the layouts array');\n\n  if (isStaticLayout(l)) {\n    return out;\n  }\n\n  // Short-circuit if nothing to do.\n  if (l.pos.y === y && l.pos.x === x) {\n    return out;\n  }\n\n  const oldX = l.pos.x;\n  const oldY = l.pos.y;\n\n  // This is quite a bit faster than extending the object\n  if (typeof x === 'number') {\n    l = l.setIn(['pos', 'x'], x);\n  }\n  if (typeof y === 'number') {\n    l = l.setIn(['pos', 'y'], y);\n  }\n  l = l.set('moved', true);\n\n  // If this collides with anything, move it.\n  // When doing this comparison, we have to sort the items we compare with\n  // to ensure, in the case of multiple collisions, that we're getting the\n  // nearest collision.\n  out[index] = l;\n  let sorted = sortLayoutItems(out, compactType);\n  const movingUp =\n    compactType === CompactType.VERTICAL && typeof y === 'number' ? oldY >= y\n    : compactType === CompactType.HORIZONTAL && typeof x === 'number' ? oldX >= x\n    : false;\n  if (movingUp) {\n    sorted = sorted.reverse();\n  }\n  const collisions = getAllCollisions(sorted, l);\n\n  // There was a collision; abort\n  if (preventCollision && collisions.length) {\n    l = l.setIn(['pos', 'x'], oldX);\n    l = l.setIn(['pos', 'y'], oldY);\n    l = l.set('moved', false);\n    out[index] = l;\n    return out;\n  }\n\n  // Move each item that collides away from this element.\n  for (let i = 0, len = collisions.length; i < len; i++) {\n    const collision = collisions[i] as Immutable.ImmutableObject<Layout>;\n\n    // Short circuit so we can't infinite loop\n    if (collision.moved) {\n      continue;\n    };\n\n    // Don't move static items - we have to move *this* element away\n    if (isStaticLayout(collision)) {\n      out = moveElementAwayFromCollision(\n        out,\n        collision,\n        l,\n        compactType,\n        cols,\n        isUserAction\n      );\n    } else {\n      out = moveElementAwayFromCollision(\n        out,\n        l,\n        collision,\n        compactType,\n        cols,\n        isUserAction\n      );\n    }\n  }\n  return out;\n}\n\n/**\n * This is where the magic needs to happen - given a collision, move an element away from the collision.\n * We attempt to move it up if there's room, otherwise it goes below.\n *\n * @param  {Array} layouts            Full layout to modify.\n * @param  {LayoutItem} collidesWith Layout item we're colliding with.\n * @param  {LayoutItem} itemToMove   Layout item we're moving.\n */\nexport function moveElementAwayFromCollision(\n  layouts: Array<Layout>,\n  collidesWith: Immutable.ImmutableObject<Layout>,\n  itemToMove: Immutable.ImmutableObject<Layout>,\n  compactType: CompactType,\n  cols: number,\n  isUserAction: boolean,\n): Array<Layout> {\n  const compactH = compactType === CompactType.HORIZONTAL;\n  const compactV = compactType === CompactType.VERTICAL;\n  const preventCollision = false; // we're already colliding\n\n  // If there is enough space above the collision to put this element, move it there.\n  // We only do this on the main collision as this can get funky in cascades and cause\n  // unwanted swapping behavior.\n  if (isUserAction) {\n    // Reset isUserAction flag because we're not in the main collision anymore.\n    isUserAction = false;\n\n    // Make a mock item so we don't modify the item here, only modify in moveElement.\n    const fakeItem: Layout = {\n      pos: {\n        x: compactH ? Math.max(collidesWith.pos.x - itemToMove.pos.w, 0) : itemToMove.pos.x,\n        y: compactV ? Math.max(collidesWith.pos.y - itemToMove.pos.h, 0) : itemToMove.pos.y,\n        w: itemToMove.pos.w,\n        h: itemToMove.pos.h\n      },\n      id: \"-1\"\n    };\n\n    // No collision? If so, we can go up there; otherwise, we'll end up moving down as normal\n    if (!getFirstCollision(layouts, fakeItem)) {\n      return moveElement(\n        layouts,\n        itemToMove.id,\n        compactType,\n        cols,\n        compactH ? fakeItem.pos.x : undefined,\n        compactV ? fakeItem.pos.y : undefined,\n        isUserAction,\n        preventCollision,\n      );\n    }\n  }\n\n  return moveElement(\n    layouts,\n    itemToMove.id,\n    compactType,\n    cols,\n    compactH ? itemToMove.pos.x + 1 : undefined,\n    compactV ? itemToMove.pos.y + 1 : undefined,\n    isUserAction,\n    preventCollision,\n  );\n}\n\n/**\n * Get layout items sorted from top left to right and down.\n *\n * @return {Array} Array of layout objects.\n * @return {Array}        Layout, sorted static items first.\n */\nexport function sortLayoutItems(\n  layouts: Array<Layout>,\n  compactType: CompactType\n): Array<Layout> {\n  if (compactType === CompactType.HORIZONTAL) {\n    return sortLayoutItemsByColRow(layouts);\n  } else if (compactType === CompactType.VERTICAL) {\n    return sortLayoutItemsByRowCol(layouts);\n  } else {\n    return layouts;\n  }\n}\n\nexport function sortLayoutItemsByRowCol(layouts: Array<Layout>): Array<Layout> {\n  return [].concat(layouts).sort((a, b) => {\n    if (a.pos.y > b.pos.y || (a.pos.y === b.pos.y && a.pos.x > b.pos.x)) {\n      return 1;\n    } else if (a.pos.y === b.pos.y && a.pos.x === b.pos.x) {\n      // Without this, we can get different sort results in IE vs. Chrome/FF\n      return 0;\n    }\n    return -1;\n  });\n}\n\nexport function sortLayoutItemsByColRow(layout: Array<Layout>): Array<Layout> {\n  return [].concat(layout).sort((a, b) => {\n    if (a.pos.x > b.pos.x || (a.pos.x === b.pos.x && a.pos.y > b.pos.y)) {\n      return 1;\n    } else if (a.pos.y === b.pos.y && a.pos.x === b.pos.x) {\n      return 0;\n    }\n    return -1;\n  });\n}\n\n/**\n * Generate a layout using the initialLayout and children as a template.\n * Missing entries will be added, extraneous ones will be truncated.\n *\n * @param  {Array}  initialLayouts Layout passed in through props.\n * @param  {String} breakpoint    Current responsive breakpoint.\n * @param  {?String} compact      Compaction option.\n * @return {Array}                Working layout.\n */\nexport function synchronizeLayoutWithChildren(\n  initialLayouts: Array<Layout>,\n  cols: number,\n  compactType: CompactType\n): Array<Layout> {\n  initialLayouts = initialLayouts || [];\n\n  // Generate one layout item per child.\n  let layout: Array<Layout> = [];\n  // Correct the layout.\n  layout = correctBounds(initialLayouts, cols);\n  layout = compact(layout, compactType, cols);\n\n  return layout;\n}\n\n/**\n * Given breakpoints, return an array of breakpoints sorted by width. This is usually\n * e.g. ['xxs', 'xs', 'sm', ...]\n *\n * @param  {Object} breakpoints Key/value pair of breakpoint names to widths.\n * @return {Array}              Sorted breakpoints.\n */\nexport function sortBreakpoints(breakpoints: { [key: string]: number }): Array<string> {\n  const keys: Array<string> = Object.keys(breakpoints);\n  return keys.sort(function(a, b) {\n    return breakpoints[a] - breakpoints[b];\n  });\n}\n\n/**\n * Given a width, find the highest breakpoint that matches is valid for it (width > breakpoint).\n *\n * @param  {Object} breakpoints Breakpoints object (e.g. {lg: 1200, md: 960, ...})\n * @param  {Number} width Screen width.\n * @return {String}       Highest breakpoint that is less than width.\n */\nexport function getBreakpointFromWidth(\n  breakpoints: { [key: string]: number },\n  width: number\n): string {\n  const sorted = sortBreakpoints(breakpoints);\n  let matching = sorted[0];\n  for (let i = 1, len = sorted.length; i < len; i++) {\n    const breakpointName = sorted[i];\n    if (width > breakpoints[breakpointName]) {\n      matching = breakpointName;\n    }\n  }\n  return matching;\n}\n\n/**\n * Given a breakpoint, get the # of cols set for it.\n * @param  {String} breakpoint Breakpoint name.\n * @param  {Object} cols       Map of breakpoints to cols.\n * @return {Number}            Number of cols.\n */\nexport function getColsFromBreakpoint(\n  breakpoint: string,\n  cols: { [key: string]: number }\n): number {\n  invariant(cols[breakpoint], \"ResponsiveReactGridLayout: `cols` entry for breakpoint \" +\n  breakpoint +\n  \" is missing!\");\n  return cols[breakpoint];\n}\n\n/**\n * Given existing layouts and a new breakpoint, find or generate a new layout.\n *\n * This finds the layout above the new one and generates from it, if it exists.\n *\n * @param  {Object} layouts     Existing layouts.\n * @param  {Array} breakpoints All breakpoints.\n * @param  {String} breakpoint New breakpoint.\n * @param  {String} breakpoint Last breakpoint (for fallback).\n * @param  {Number} cols       Column count at new breakpoint.\n * @param  {Boolean} verticalCompact Whether or not to compact the layout\n *   vertically.\n * @return {Array}             New layout.\n */\nexport function generateResponsiveLayout(\n  layouts: Array<Layout>,\n  cols: number,\n  compactType: CompactType\n): Layout[] {\n  layouts = layouts || [];\n  return compact(correctBounds(layouts, cols), compactType, cols);\n}\n\nexport function collectLayoutsAtBreakpoint(content: Array<Layout>, breakpoint: string, setting: GridLayoutSetting): Array<Layout> {\n  if (!content) {\n    return [];\n  }\n  const breakpointsSorted = sortBreakpoints(setting.breakpoints);\n  const index = breakpointsSorted.indexOf(breakpoint);\n  const breakpointsAbove = breakpointsSorted.slice(index);\n\n  return content.map(layout => {\n    let imLayout: Immutable.ImmutableObject<Layout>;\n    if (!Immutable.isImmutable(layout)) {\n      imLayout = Immutable(layout);\n    } else {\n      imLayout = layout as Immutable.ImmutableObject<Layout>;\n    }\n    let pos = layout.pos[breakpoint];\n    if (!pos) {\n      breakpointsAbove.some(item => {\n        if (layout.pos[item]) {\n          pos = layout.pos[item];\n          return true;\n        }\n      });\n      if (!pos && index !== 0) {\n        for (let i = index - 1; i >= 0; i--){\n          if (layout.pos[breakpointsSorted[i]]) {\n            pos = layout.pos[breakpointsSorted[i]];\n            break;\n          }\n        }\n      }\n    }\n    return imLayout.set('pos', pos || {\n        x: layout.pos.x,\n        y: layout.pos.y,\n        w: layout.pos.w,\n        h: layout.pos.h\n      }\n    );\n  });\n}\n\n/**\n * Translate coordinates from pixels to grid units.\n */\nexport function toGridPosition(pos: Position, setting: GridLayoutSetting,\n  numOfCols: number, colWidth: number): Position {\n  const { space, rowHeight } = setting;\n\n  let x = Math.round((pos.x - space) / (colWidth + space));\n  let y = Math.round((pos.y - space) / (rowHeight + space));\n  let w = Math.round((pos.w + space) / (colWidth + space));\n  let h = Math.round((pos.h + space) / (rowHeight + space));\n\n  // Capping\n  x = Math.max(Math.min(x, numOfCols - w), 0);\n  y = Math.max(y, 0);\n\n  // Capping\n  w = Math.max(Math.min(w, numOfCols - x), 1);\n  h = Math.max(h, 1);\n\n  return { x, y, w, h };\n}\n\n/**\n * Return position on the page given an x, y, w, h.\n * left, top, width, height are all in pixels.\n * @param  {Number}  x             X coordinate in grid units.\n * @param  {Number}  y             Y coordinate in grid units.\n * @param  {Number}  w             W coordinate in grid units.\n * @param  {Number}  h             H coordinate in grid units.\n * @return {Object}                Object containing coords.\n */\nexport function toPixelPosition(\n  pos: Position,\n  setting: GridLayoutSetting,\n  colWidth: number,\n  resizingPos?: Position,\n  draggingPos?: Position\n): Position {\n  const { space, padding, rowHeight } = setting;\n\n  const out = {\n    x: Math.round((colWidth + space) * pos.x + padding[0]),\n    y: Math.round((rowHeight + space) * pos.y + padding[1]),\n    // 0 * Infinity === NaN, which causes problems with resize constraints;\n    // Fix this if it occurs.\n    // Note we do it here rather than later because Math.round(Infinity) causes deopt\n    w:\n      pos.w === Infinity\n        ? pos.w\n        : Math.round(colWidth * pos.w + Math.max(0, pos.w - 1) * space),\n    h:\n      pos.h === Infinity\n        ? pos.h\n        : Math.round(rowHeight * pos.h + Math.max(0, pos.h - 1) * space)\n  };\n\n  if (resizingPos) {\n    out.w = Math.round(resizingPos.w);\n    out.h = Math.round(resizingPos.h);\n  }\n\n  if (draggingPos) {\n    out.y = Math.round(draggingPos.y);\n    out.x = Math.round(draggingPos.x);\n  }\n\n  return out;\n}","import { CompactType, GridLayoutSetting } from '../types';\nimport assign = require(\"lodash.assign\");\nimport { DEFAULT_LAYOUT_SETTING } from '../default-common-setting';\n\nexport const DEFAULT_GRID_LAYOUT_SETTING: GridLayoutSetting = assign({}, DEFAULT_LAYOUT_SETTING, {\n  padding: [10, 10],\n  rowHeight: 32,\n  breakpoints: { lg: 1200, md: 992, sm: 768, xs: 576, xxs: 0 },\n  cols: { lg: 12, md: 10, sm: 6, xs: 4, xxs: 2 },\n  space: 10,\n  compactType: CompactType.VERTICAL,\n  restrict: true\n});","import * as React from 'react';\nimport classNames = require(\"classnames\");\nimport { DragSource, DragSourceConnector, DragSourceMonitor, ConnectDragSource } from 'react-dnd';\nimport { DND_TYPES } from './react-dnd-types';\nimport { setTransform } from './utils';\n\nimport { LayoutProps } from './types';\n\nexport interface DragProps {\n  connectDragSource?: ConnectDragSource,\n  isDragging?: boolean,\n  offset?: {x: number, y: number}\n}\n\nexport interface DragHandlers {\n  restrict?: boolean;\n  disableInteract?: boolean;\n  onMoveStart: (id: string) => void;\n  onMoving: (id: string, dx: number, dy: number) => void;\n  onMoveEnd: (id: string, dx: number, dy: number) => void;\n}\n\nexport type DraggableProps = DragProps & LayoutProps & DragHandlers;\n\nfunction getDisplayName(WrappedComponent) {\n  return WrappedComponent.displayName || WrappedComponent.name || 'Component';\n}\n\nexport default function draggable(injectProps?) {\n  return (WrapperComponent: React.ComponentClass<LayoutProps>) => {\n    const spec = {\n      beginDrag: (props) => {\n        if (typeof props.onMoveStart === 'function') {\n          props.onMoveStart(props.layout.id);\n        }\n        return {\n          layout: props.layout,\n          width: props.pos.w,\n          height: props.pos.h,\n          restrict: props.restrict\n        };\n      },\n      endDrag: (props, monitor) => {\n        if (typeof props.onMoveEnd === 'function') {\n          const { layout } = props;\n          const offset = monitor.getDifferenceFromInitialOffset();\n          props.onMoveEnd(layout.id, offset.x, offset.y);\n        }\n      },\n      canDrag: (props) => {\n        if (props.disableInteract) {\n          return false;\n        }\n        if(props.layout && props.layout.setting) {\n          return props.layout.setting.draggable !== false;\n        }\n        return true;\n      }\n    }\n\n    const collect = (connect: DragSourceConnector, monitor: DragSourceMonitor) => {\n      return {\n        connectDragSource: connect.dragSource(),\n        isDragging: monitor.isDragging()\n      }\n    }\n\n    class DraggableComponent extends React.PureComponent<DraggableProps, {}> {\n      static displayName = `react-dnd-draggable(${getDisplayName(WrapperComponent)})`;\n\n      static defaultProps: Partial<DraggableProps> = {\n        restrict: false,\n        disableInteract: false,\n        onMoveStart: () => {},\n        onMoving: () => {},\n        onMoveEnd: () => {}\n      };\n\n      render() {\n        const { pos, isDragging, className, style, connectDragSource, appMode, ...passThroughProps } = this.props;\n\n        const displayPos = {\n          x: 0,\n          y: 0,\n          w: pos.w,\n          h: pos.h\n        };\n        const placeholderStyle = {\n          position: 'absolute',\n          left: 0,\n          top: 0,\n          width: pos.w,\n          height: pos.h,\n          backgroundColor: '#F1F1F1',\n          outline: '1px solid #55BCFF',\n          boxShadow: 'inset 0 0 8px 0 rgba(0,0,0,0.15)'\n        }\n        const mergedClass = classNames('exb-draggable', className);\n\n        return (\n          connectDragSource &&\n          connectDragSource(\n            <div className={mergedClass} style={setTransform(pos)}>\n              <WrapperComponent pos={displayPos} appMode={appMode} style={{\n                position: 'relative'\n              }} {...injectProps} {...passThroughProps}/>\n              {isDragging && <div style={placeholderStyle as any}></div>}\n            </div>\n          )\n        );\n      }\n    }\n\n    return DragSource(DND_TYPES.LAYOUT, spec, collect)(DraggableComponent);\n  };\n}","import * as React from 'react';\n\nimport {store} from './store';\nimport {IMAppConfig, IMWidgetJson} from './types/app-config';\nimport {MessageActionProperty} from './types/manifest';\nimport {getAllWidgets} from './utils/app-config';\nimport {Message, DummyMessageAction, MessageAction} from './message/base-types';\nimport {amdRequire} from './amd-loader';\n\nexport default class MessageManager{\n\n  static instance: MessageManager;\n  static getInstance(){\n    if(!MessageManager.instance){\n      MessageManager.instance = new MessageManager();\n      window._messageManager = MessageManager.instance;\n    }\n    return MessageManager.instance;\n  }\n\n  private messageActions: DummyMessageAction[] = [];\n  private messageActionClasses: {[actionName: string]: typeof DummyMessageAction} = {};\n\n  createMessageActions(appConfig: IMAppConfig): Promise<any>{\n    let actionPromises = [];\n    getAllWidgets(appConfig).forEach(w => {\n      if(w.manifest.messageActions){\n        w.manifest.messageActions.forEach(action => {\n          actionPromises.push(this.createMessageAction(w, action));\n        });\n      }\n    });\n\n    return Promise.all(actionPromises);\n  }\n\n  createMessageAction(widgetJson: IMWidgetJson, actionProp: MessageActionProperty): Promise<MessageAction>{\n    let action: MessageAction = this.messageActions.filter(action => action.widgetId === widgetJson.id && action.name === actionProp.name)[0];\n    if(action){\n      return Promise.resolve(action);\n    }else{\n      return this.loadMessageActionClass(widgetJson, actionProp).then(ActionClass => {\n        action = new ActionClass(widgetJson.id, actionProp.name);\n        this.messageActions.push(action);\n        return Promise.resolve(action);\n      });\n    }\n  }\n\n  loadMessageActionClass(widgetJson: IMWidgetJson, actionProp: MessageActionProperty): Promise<typeof DummyMessageAction>{\n    if(this.messageActionClasses[actionProp.name]){\n      return Promise.resolve(this.messageActionClasses[actionProp.name]);\n    }\n    var uri = widgetJson.context.amdFolder + 'dist/' + actionProp.uri;\n    return amdRequire(uri).then(ActionClass => {\n      this.messageActionClasses[actionProp.name] = ActionClass.default;\n      return ActionClass.default;\n    });\n  }\n\n  publishMessage(message: Message){\n    let messagesConfig = store.getState().appConfig.messages;\n    let matchMessageCfg = messagesConfig && messagesConfig.filter(m => m.messageType === message.type && m.widgetId === message.widgetId)[0];\n    if(!matchMessageCfg){\n      return;\n    }\n\n    matchMessageCfg.actions.forEach(actionJson => {\n      let action = this.messageActions.filter(action => action.widgetId === actionJson.widgetId && action.name === actionJson.actionName)[0];\n      if(!action){\n        console.error(`Not find action: ${action.name}`);\n        return;\n      }\n\n      if(!action.filterMessage(message)){\n        return;\n      }\n\n      action.onExecute(message, actionJson.config);\n    });\n  }\n}\n","export interface Location {\n  pathname: string;\n  search: string;\n  hash: string;\n}\n\nexport function parsePath(path: string): Location {\n  var pathname = path || '/';\n  var search = '';\n  var hash = '';\n\n  var hashIndex = pathname.indexOf('#');\n  if (hashIndex !== -1) {\n    hash = pathname.substr(hashIndex);\n    pathname = pathname.substr(0, hashIndex);\n  }\n\n  var searchIndex = pathname.indexOf('?');\n  if (searchIndex !== -1) {\n    search = pathname.substr(searchIndex);\n    pathname = pathname.substr(0, searchIndex);\n  }\n\n  return {\n    pathname: pathname,\n    search: search === '?' ? '' : search,\n    hash: hash === '#' ? '' : hash,\n  };\n};\n\nexport function isAbsoluteUrl(url: string){\n  return /(^http:)|(^https:)|(^\\/\\/)/.test(url);\n}","import DataSourceManager from '../data-source-manager';\nimport { stat } from 'fs';\nimport { addThemeManifestProperies } from '../utils/app-config';\n\nexport enum DataSourceStatus{\n  //for remote query\n  Unloaded = 'UNLOADED',\n  UnloadedLoading = 'UNLOADED_LOADING',\n  LoadedLoading = 'LOADED_LOADING',\n  Loaded = 'LOADED',\n\n  //for remote push\n  Closed = 'CLOSED',\n  Connecting = 'CONNECTING',\n  Connected = 'CONNECTED',\n  Closing = 'CLOSING',\n\n  //for client DS, we don't define status\n}\n\nexport interface DataRecord{\n  getData: () => any;\n}\n\nexport interface DataSource{\n  id: string\n  label: string\n  type: string\n  status?: DataSourceStatus;\n  dataSourceManager?: DataSourceManager;\n  isDataSourceSet: boolean;\n  \n  //for data source\n  getRecords?: () => DataRecord[];\n  getCurrentRecord?: () => DataRecord;\n  getCurrentRecords?: () => DataRecord[];\n  getCurrentRecordIndexes?: () => number[];\n  nextRecord?: () => DataRecord;\n  prevRecord?: () => DataRecord;\n  selectRecord?: (index: number, layerId?: string) => void;\n  selectRecords?: (indexes: number[], layerId?: string) => void; // TODO\n  findRecord?: (index: number) => DataRecord;\n  clearData?: () => void;\n  getDataSchema?: () => any;\n  init: () => void;\n  updateStatus?: (statue: DataSourceStatus) => void;\n\n  //for data source set\n  getDataSources?: () => DataSource[];\n\n  // for feature layer based date source\n  highlightRecord?: (objectId: number, layerId?: string) => void;\n\n  destroy: () => void;\n}\n\nexport interface EditableDataSource extends DataSource {\n  addRecord?: (record: DataRecord) => Promise<DataRecord>;\n  updateRecord?: (record: DataRecord) => Promise<DataRecord>;\n  deleteRecord?: (index: number) => Promise<number>;\n  // TODO add/update/delete multiple records\n}\n\nexport abstract class AbstractDataSource implements DataSource{\n  id: string\n  label: string\n  type: string\n  status?: DataSourceStatus;\n  dataSourceManager: DataSourceManager;\n  isDataSourceSet: boolean = false;\n\n  protected records: DataRecord[] = [];\n  protected currentIndexes: number[] = [];\n\n  abstract getDataSchema();\n  abstract init();\n\n  updateStatus(status: DataSourceStatus){\n    this.status = status;\n    if(this.dataSourceManager) this.dataSourceManager.onDataSourceStatusChanged(this.id, status);\n  }\n\n  getRecords(): DataRecord[]{\n    return this.records;\n  }\n\n  getCurrentRecord(): DataRecord {\n    return this.records[this.currentIndexes[0]];\n  }\n\n  getCurrentRecords(): DataRecord[] {\n    return this.currentIndexes.map( index => this.records[index] );\n  }\n\n  getCurrentRecordIndexes(): number[] {\n    return this.currentIndexes;\n  }\n\n  nextRecord(): DataRecord {\n    if(this.currentIndexes.length > 1) {\n      console.warn('method \"nextRecord\" only works when single record is selected');\n      return null;\n    }\n\n    if(this.currentIndexes.indexOf(this.records.length - 1)){\n      throw Error('Reach the end of data.');\n    }\n\n    this.currentIndexes[0] ++;\n    return this.getCurrentRecord();\n  }\n\n  prevRecord(): DataRecord{\n    if(this.currentIndexes.length > 1) {\n      console.warn('method \"prevRecord\" only works when single record is selected');\n      return null;\n    }\n\n    if(this.currentIndexes.indexOf(0)){\n      throw Error('Reach the start of data.');\n    }\n\n    this.currentIndexes[0] --;\n    return this.getCurrentRecord();\n  }\n\n  findRecord(index: number): DataRecord {\n    return this.records[index];\n  }\n\n  clearData(): void{\n    this.records = [];\n    this.currentIndexes =[];\n  }\n\n  destroy(){}\n}\n\nexport interface RemoteQueryDataSource extends DataSource{\n  url: string;\n\n  query(query): Promise<DataRecord[]>;\n}\n\nexport interface ClientDataSource extends DataSource{\n\n}\n","import * as React from 'react';\n\nimport {store} from './store';\nimport {DataSource, DataSourceStatus, AbstractDataSource, RemoteQueryDataSource, DataRecord, EditableDataSource} from './data-source/base-types';\nimport {IMDataSourceJson} from './types/app-config';\nimport ExtensionManager from './extension-manager';\nimport {DataSourceFactory, ExtensionPoints} from './extension-spec/extension-spec';\nimport {dataSourceStatusChanged, dataSourceCurrentIndexesChanged} from './app-actions';\nimport {changeQueryObject} from './browser-history';\n\n// TODO: move this to the hub extension once we create one\nimport { IFeature, IUser } from '@esri/arcgis-rest-common-types';\nimport { IQueryFeaturesRequestOptions } from '@esri/arcgis-rest-feature-service';\nimport { addAnnotations, searchAnnotations, IAnnoFeature, IAddAnnotationsRequestOptions } from '@esri/hub-annotations';\nimport SessionManager from './session-manager';\n\n// TODO: move this to the hub extension once we create one\nexport enum DataSourceTypes{\n  HubAnnotations = 'HUB_ANNOTATIONS'\n}\n\n//the supported ds in jimu-core\nconst supportDataSourceTypes = [\n  // TODO: remove this once we have a hub extension\n  DataSourceTypes.HubAnnotations\n] as string[];\n\n// TODO: move this to the hub extension once we create one\nexport class HubAnnotationDataRecord implements DataRecord{\n  feature: IFeature\n  user: IUser\n\n  constructor(feature: IFeature, user?: IUser){\n    this.feature = feature;\n    this.user = user;\n  }\n\n  getData(){\n    return this.user ? { user: this.user, ... this.feature.attributes } : this.feature.attributes;\n  }\n}\n\n// TODO: move this to the hub extension once we create one\nexport class HubAnnotationsDataSource extends AbstractDataSource implements RemoteQueryDataSource, EditableDataSource {\n  url: string;\n\n  constructor(dsConfig: IMDataSourceJson){\n    super();\n    this.url = dsConfig.url;\n    this.type = DataSourceTypes.HubAnnotations;\n    this.id = dsConfig.id;\n  }\n\n  init(){\n    this.updateStatus(DataSourceStatus.Unloaded);\n  }\n\n  query(query: IQueryFeaturesRequestOptions): Promise<HubAnnotationDataRecord[]>{\n    const sessionManager = SessionManager.getInstance();\n    // merge in default url and authentication into query options\n    const options: IQueryFeaturesRequestOptions = {\n      // TODO: once https://github.com/Esri/arcgis-rest-js/issues/242 is resolved\n      // we can/should uncomment this and send a token w/ this request\n      // for now though, we know that that the service is public\n      // authentication: sessionManager.getSession()\n      url: this.url,\n      ...query\n    }\n    if(!this.status || this.status === DataSourceStatus.Unloaded){\n      this.updateStatus(DataSourceStatus.UnloadedLoading);\n    }else{\n      this.updateStatus(DataSourceStatus.LoadedLoading);\n    }\n    return searchAnnotations(options).then(response => {\n      let records = response.data.map(feature => {\n        // get user from related records in response\n        let user = response.included.find(u => u.id === feature.attributes.author);\n        return new HubAnnotationDataRecord(feature, user && user.attributes);\n      });\n      this.records = records;\n      this.updateStatus(DataSourceStatus.Loaded);\n      return records;\n    })\n    // TODO: retry if request was unauthenticated \n    // once we are sending tokens above\n    // .catch(sessionManager.handleAuthError.bind(sessionManager));\n  }\n\n  selectRecord(index: number): void {\n    this.currentIndexes = [index];\n    this.dataSourceManager.onDataSourceCurrentIndexesChanged(this.id, [index]);\n  }\n\n  addRecord(record: HubAnnotationDataRecord) {\n    const sessionManager = SessionManager.getInstance();\n    const attributes = record.getData();\n    const feature = ({\n      attributes\n    } as IAnnoFeature);\n    // const options: IAddFeaturesRequestOptions = {\n    const options: IAddAnnotationsRequestOptions = {\n      // TODO: once https://github.com/Esri/arcgis-rest-js/issues/242 is resolved\n      // we can/should uncomment this and send a token w/ this request\n      // for now though, we know that that the service is public\n      // authentication: sessionManager.getSession()\n      url: this.url,\n      adds: [feature],\n    };\n    return addAnnotations(options)\n    .then(response => {\n      // return a new record with the OBJECTID and current user\n      const objectId = response.addResults[0].objectId;\n      attributes.OBJECTID = objectId;\n      return new HubAnnotationDataRecord({\n        attributes\n      }, store.getState().user);\n    })\n    // TODO: retry if request was unauthenticated \n    // once we are sending tokens above\n    // .catch(sessionManager.handleAuthError.bind(sessionManager));\n  }\n\n  addAnnotation(description: string, target: string, feature_id?: number) {\n    // use the current user as the author\n    const user = store.getState().user;\n    // TODO: what if user is not logged in? throw error?\n    const author = user && user.username;\n    // use this application as the source of the comment\n    const source = window && window.location.toString();\n    const record = new HubAnnotationDataRecord({\n      attributes: {\n        author,\n        source,\n        target,\n        feature_id,\n        description\n      }\n    });\n    return this.addRecord(record);\n  }\n\n  getDataSchema(){}\n\n}\n\nexport default class DataSourceManager{\n\n  static instance: DataSourceManager;\n  static getInstance(){\n    if(!DataSourceManager.instance){\n      DataSourceManager.instance = new DataSourceManager();\n      window._dataSourceManager = DataSourceManager.instance;\n    }\n    return DataSourceManager.instance;\n  }\n\n  private dataSources: {[dsId: string]: DataSource} = {};\n\n  getDataSource(dsId: string): DataSource{\n    return this.dataSources[dsId];\n  }\n\n  destroyDataSource(dsId: string){\n    if(this.dataSources[dsId]){\n      this.dataSources[dsId].destroy();\n      delete this.dataSources[dsId];\n    }\n  }\n  \n  createAllDataSources(): DataSource[]{\n    Object.keys(store.getState().appConfig.dataSources).forEach(dsId => {\n      if(!this.dataSources[dsId]){\n        this.createDataSource(dsId);\n      }\n    });\n\n    return Object.keys(this.dataSources).map(dsId => this.dataSources[dsId]);\n  }\n\n  /**\n   * \n   * @param ds if the ds is JSON, the ds may not be in app config, this is the case that widget can use internal data source. \n   */\n  createDataSource(dsId: string): DataSource;\n  createDataSource(dsJson: IMDataSourceJson): DataSource;\n  createDataSource(ds: string | IMDataSourceJson): DataSource{\n    let dsJson:IMDataSourceJson;\n\n    if(typeof ds === 'string'){\n      dsJson = store.getState().appConfig.dataSources[ds];\n    }else{\n      dsJson = ds;\n    }\n\n    if(!dsJson){\n      throw Error('Unknown data source id:' + dsJson.id);\n    }\n\n    let dsObj: DataSource;\n    if(supportDataSourceTypes.indexOf(dsJson.type) > -1){\n      // TODO: remove this once we have a hub extension\n      if (dsJson.type === DataSourceTypes.HubAnnotations) {\n        dsObj = this.createHubAnnotationsDataSource(dsJson);\n      }\n    }else{\n      let dsFactories: DataSourceFactory[] = ExtensionManager.getInstance().getExtensions(ExtensionPoints.DataSourceFactory) as DataSourceFactory[];\n      let dsFactory: DataSourceFactory = dsFactories.filter(f => f.getSupportDataSourceTypes().indexOf(dsJson.type) > -1)[0];\n      if(!dsFactory){\n        throw Error('Unknown data source type:' + dsJson.type);\n      }\n      dsObj = dsFactory.createDataSource(dsJson);\n    }\n    if (dsObj) {\n      dsObj.dataSourceManager = this;\n      dsObj.init();\n\n      this.dataSources[dsJson.id] = dsObj;\n    }\n    return dsObj;\n  }\n\n  onDataSourceStatusChanged(dsId: string, status: DataSourceStatus){\n    store.dispatch(dataSourceStatusChanged(dsId, status));\n  }\n\n  onDataSourceCurrentIndexesChanged(dsId: string, indexes: number[]){\n    if(store.getState().dataSourcesInfo[dsId] && store.getState().dataSourcesInfo[dsId].currentIndexes && \n      store.getState().dataSourcesInfo[dsId].currentIndexes[0] === indexes[0]){\n      return;\n    }\n\n    let urlDs = store.getState().queryObject.data;\n    let oldDs: string[] = [];\n    if(urlDs){\n      oldDs = urlDs.split(',');\n    }\n    let newDs = [];\n    let added = false;\n    oldDs.forEach(od => {\n      let oId = od.split(':')[0];\n      let oi = od.split(':')[1];\n      if(oId === dsId){\n        newDs.push(`${dsId}:${indexes[0]}`); //TODO put 1 now\n        added = true;\n      }else{\n        newDs.push(od);\n      }\n    });\n    if(!added){\n      newDs.push(`${dsId}:${indexes[0]}`)\n    }\n    changeQueryObject({data: newDs.join(',')}, true);\n\n    store.dispatch(dataSourceCurrentIndexesChanged(dsId, indexes));\n  }\n\n  // TODO: remove this once we have a hub extension\n  private createHubAnnotationsDataSource(dsConfig: IMDataSourceJson): HubAnnotationsDataSource {\n    return new HubAnnotationsDataSource(dsConfig);\n  }\n}\n","import * as React from 'react';\n\nimport {AllWidgetProps} from './types/props';\nimport {IMState} from './types/state';\nimport {getWidgetCallbackNamesFromWidgetState, logShallowDiff} from './utils/utils';\nimport {DataSource} from './data-source/base-types';\n\n\nexport default class BaseWidget<P extends AllWidgetProps<{}> = AllWidgetProps<{}>, S = {}> extends React.PureComponent<P, S>{\n  /**\n   * By default, the props in \"WidgetInjectedProps\" will be injected into widget props. To map more props, please use this function.\n   */\n  static mapExtraStateProps: (state: IMState, ownProps?: AllWidgetProps<{}>) => any;\n\n  showDiffLog: boolean = false;\n\n  onOpen(){\n    console.log('base widget onOpen');\n  }\n\n  onClose(){\n  }\n\n  onActive(){\n  }\n\n  onDeActive(){\n  }\n\n  componentDidUpdate(prevProps: P, prevState: S){\n    let widgetState = this.props.state;\n    let prevWidgetState = prevProps.state;\n\n    if(this.showDiffLog){\n      logShallowDiff(`Widget ${this.props.manifest.name} Props diff:`, this.props, prevProps);\n      logShallowDiff(`Widget ${this.props.manifest.name} State diff:`, this.state, prevState);\n    }\n\n    let fn = getWidgetCallbackNamesFromWidgetState(widgetState, prevWidgetState);\n    if(!fn){\n      return;\n    }\n    \n    if(typeof fn === 'string'){\n      this[fn]();\n    }else if(Array.isArray(fn)){\n      fn.forEach(f => this[f]());\n    }else{\n      console.error('Bad widget callback name.');\n    }\n  }\n}\n","import {ImmutableObject, Immutable, ImmutableArray, ImmutableArrayMixin, ImmutableObjectMixin} from 'seamless-immutable';\nimport * as SeamlessImmutable from 'seamless-immutable';\nimport {WidgetManifest} from './manifest';\n\nexport enum ContainerType{\n  //use lower case here to match the keys in appconfig.json\n  Page = 'pages',\n  View = 'views',\n  SharedArea = 'sharedArea',\n}\n\nexport interface WidgetContext{\n  folderUrl: string;\n  amdFolder: string;\n  isRemote: boolean;\n}\nexport interface LayoutElementJson{\n  id: string;\n  parentId?: string;\n  pos: ImmutableObject<{\n    x?: number;\n    y?: number;\n    w?: number;\n    h?: number;\n  }>,\n  type: string;\n  setting?: any;\n}\nexport type IMLayoutElementJson = ImmutableObject<LayoutElementJson>;\n\nexport interface LayoutJson{\n  [layoutElementId: string]: string & IMLayoutElementJson;\n}\nexport type IMLayoutJson = ImmutableObject<LayoutJson>;\n\nexport type IMWidgetContext = ImmutableObject<WidgetContext>;\n\nexport interface WidgetJsonWithoutConfig{\n  id: string;\n  icon: string;\n  label: string;\n  visible: boolean;\n  index?: number;\n  uri: string; //do not end with \"/\"\n  itemId?: string;\n  context: IMWidgetContext;\n  manifest: WidgetManifest;\n  version: string;\n  useDataSources: string[];\n  outputDataSources: string[];\n}\n\nexport interface WidgetJson extends WidgetJsonWithoutConfig{\n  config: any;\n}\nexport type IMWidgetJson = ImmutableObject<WidgetJson>;\n\nexport interface AbstractContainerJson{\n  layout: string;\n  mobileLayout?: string;\n  widgets: ImmutableArray<string>;\n  visible?: boolean;\n}\nexport type IMAbstractContainerJson = ImmutableObject<AbstractContainerJson>;\n\nexport interface SectionJson{\n  id: string;\n  visible?: boolean;\n  views: ImmutableArray<string>; //show \"default\" view by default\n}\nexport type IMSectionJson = ImmutableObject<SectionJson>;\n\nexport interface ViewJson extends AbstractContainerJson{\n  id: string;\n  label: string;\n\n  mobileTheresholdSize?: {width?: number, height?: number};\n  desktopThresholdSize?: {width?: number, height?: number};\n  mobileLayoutCompact?: string;\n  desktopLayoutCompact?: string;\n\n  sections?: ImmutableArray<string>;\n}\nexport type IMViewJson = ImmutableObject<ViewJson>;\n\nexport interface PageJson extends AbstractContainerJson{\n  id: string;\n  label: string;\n  sharedArea: ImmutableObject<Partial<{\n    header: boolean;\n    footer: boolean;\n    leftArea: boolean;\n    rightArea: boolean;\n  }>>;\n\n  sections?: ImmutableArray<string>;\n}\nexport type IMPageJson = ImmutableObject<PageJson>;\n\nexport interface DataSourceJson{\n  id: string\n  label: string\n  type: string;\n\n  url?: string;\n\n  //for item\n  portalUrl?: string; //if no portalUrl, default to app config's portalUrl\n  itemId?: string;\n\n  //for map\n  layers?: ImmutableArray<IMDataSourceLayerJson>;\n\n  // for layer view\n  layerId?: string\n}\nexport type IMDataSourceJson = ImmutableObject<DataSourceJson>;\n\nexport interface DataSourceLayerJson{\n  id: string;\n  title: string;\n  url: string;\n}\nexport type IMDataSourceLayerJson = ImmutableObject<DataSourceLayerJson>;\n\nexport interface ActionJson{\n  description: string;\n  widgetId: string;\n  actionName: string;\n  config: any;\n}\nexport type IMActionJson = ImmutableObject<ActionJson>;\n\nexport interface MessageJson{\n  widgetId: string;\n  messageType: String;\n  actions: ImmutableArray<IMActionJson>\n}\nexport type IMMessageJson = ImmutableObject<MessageJson>;\n\nexport interface AttributesJson{\n  logo: string;\n  title: string;\n  subTitle?: string;\n\n  /**\n   * These attributes are for arcgis only, so they should be defined in jimu-arcgis.\n   * The reason that We put them here is: we can see a full app config in one place.\n   */\n  portalUrl?: string;\n  geometryService?: string;\n}\nexport type IMAttributesJson = ImmutableObject<AttributesJson>;\n\nexport interface HubJson{\n  community: {\n    portalUrl: string;\n    orgId?: string;\n  }\n  initiative?: string;\n}\nexport type IMHubJson = ImmutableObject<HubJson>;\n\nexport interface AppConfig{\n  pages: ImmutableObject<{[pageId: string]: IMPageJson}>; //show \"default\" page by default\n\n  layouts: ImmutableObject<{[layoutId: string]: IMLayoutJson}>;\n\n  sections?: ImmutableObject<{[sectionId: string]: IMSectionJson}>;\n\n  views?: ImmutableObject<{[viewId: string]: IMViewJson}>;\n\n  widgets: ImmutableObject<{[widgetId: string]: IMWidgetJson}>;\n\n  sharedArea: ImmutableObject<{\n    header?: ImmutableObject<{\n      widgets: ImmutableArray<string>\n    }>;\n    footer?: ImmutableObject<{\n      widgets: ImmutableArray<string>\n    }>;\n    leftArea?: ImmutableObject<{\n      widgets: ImmutableArray<string>\n    }>;\n    rightArea?: ImmutableObject<{\n      widgets: ImmutableArray<string>\n    }>;\n    layout: string; //the layout for control these elements\n    mobileLayout?: string;\n  }>;\n\n  skin: string;\n  dataSources?: ImmutableObject<{[dsId: string]: IMDataSourceJson}>;\n\n  messages?: ImmutableArray<IMMessageJson>;\n\n  hub?: IMHubJson;\n\n  attributes: IMAttributesJson;\n}\n\nexport type IMAppConfig = ImmutableObject<AppConfig>;\n\nexport interface AppConfigDiff{\n  removedWidgets: string[]\n}","import {amdRequire} from './amd-loader';\n\nexport default class I18NManager{\n\n  static instance: I18NManager;\n\n  static getInstance(){\n    if(!I18NManager.instance){\n      I18NManager.instance = new I18NManager();\n    }\n    return I18NManager.instance;\n  }\n\n  loadNls(nlsModle: string): Promise<any>{\n    return amdRequire(`${nlsModle}`).then(rootNls => {\n      let locale = window.jimuConfig.locale;\n      if(locale === 'en'){\n        return rootNls.root;\n      }\n\n      if(!rootNls[locale]){\n        return rootNls.root;\n      }\n\n      let segs = nlsModle.split('/');\n      let folder = segs.slice(0, segs.length - 2).join('/');\n      let file = segs[segs.length - 1];\n      //TODO get correct locale.\n      return amdRequire(`${folder}/${locale}/${file}`).then(localeNls => {\n        //TODO correct strings merge.\n        return Object.assign(rootNls.root, localeNls);\n      });\n    });\n  }\n}","import Graphic = require('esri/Graphic');\n\nexport enum MessageType {\n  FeatureSelectionChange = 'FEATURE_SELECTION_CHANGE',\n  StringSelectionChange = 'STRING_SELECTION_CHANGE',\n};\n\nexport interface Message{\n  type: MessageType;\n  widgetId: string;\n}\n\nexport class StringSelectionChangeMessage implements Message{\n  type: MessageType = MessageType.StringSelectionChange;\n  widgetId: string;\n\n  str: string;\n\n  constructor(widgetId: string, str: string){\n    this.widgetId = widgetId;\n    this.str = str;\n  }\n}\n\nexport class FeatureSelectionChangeMessage implements Message{\n  type: MessageType = MessageType.FeatureSelectionChange;\n  widgetId: string;\n  feature: Graphic;\n\n  constructor(widgetId: string, feature: Graphic) {\n    this.widgetId = widgetId;\n    this.feature = feature;\n  }\n}\n\n///////////////////////////////\n\nexport abstract class MessageAction{\n  name: string;\n  widgetId: string;\n\n  constructor(widgetId: string, name: string){\n    this.name = name;\n    this.widgetId = widgetId;\n  }\n\n  /**\n   * Whether the tyep of message can trigger this action.\n   * This method will be used in builder to filter the available actions.\n   * @param messageType \n   */\n  abstract filterMessageType(messageType: MessageType): boolean;\n\n  /**\n   * whether a specific message will trigger this action.\n   * This method will be used when a widget publish a message.\n   */\n  abstract filterMessage(message: Message): boolean;\n\n  abstract onExecute(message: Message, actionConfig?: any): Promise<boolean> | boolean;\n\n  get id(): string{\n    return `${this.widgetId}-${this.name}`;\n  }\n}\n\n/**\n * this class is used for type check\n */\nexport class DummyMessageAction extends MessageAction{\n  filterMessageType(messageType: MessageType): boolean{return true;}\n\n  filterMessage(message: Message): boolean{return true;}\n\n  onExecute(message: Message, actionConfig?: any): Promise<boolean> | boolean{return true;}\n}","import * as React from 'react';\nimport assign = require(\"lodash.assign\");\nimport { Layout, FixedLayoutSetting } from '../types';\nimport { DEFAULT_FIX_LAYOUT_SETTING } from './default-setting';\nimport { LayoutItem } from '../layout-item';\nimport * as utils from '../utils';\nimport './style/layout.scss';\nimport { AppMode } from '../../types/constants';\n\ninterface Props {\n  layout?: Layout;\n  appMode: AppMode;\n  width: number;\n  height: number;\n}\n\nexport class FixedLayoutViewer extends React.Component<Props, {}> {\n  setting: FixedLayoutSetting;\n\n  constructor(props) {\n    super(props);\n\n    this.setting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, this.props.layout.setting);\n  }\n\n  _processLayoutItem(l: Layout, key: number) {\n    const {width, height, appMode, layout} = this.props;\n    const setting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, l.setting);\n    if (layout.setting && (layout.setting as FixedLayoutSetting).gridSize) {\n      setting.gridSize = (layout.setting as FixedLayoutSetting).gridSize;\n    }\n    const pos = utils.calPixelPosition(l.pos, width, height, setting);\n    return <LayoutItem\n      key={key}\n      layout={l}\n      pos={pos}\n      appMode={appMode}>\n    </LayoutItem>\n  }\n\n  render() {\n    const layouts = this.props.layout.content || [];\n    return <div className='fixed-layout' >\n        {layouts.map((layoutItem, index) => {\n          return this._processLayoutItem(layoutItem, index);\n        })}\n      </div>\n  }\n}\n","import * as React from 'react';\nimport classNames = require(\"classnames\");\nimport assign = require('lodash.assign');\nimport { DEFAULT_GRID_LAYOUT_SETTING } from './default-setting';\nimport * as gridUtils from \"./grid-utils\";\nimport { getLayoutItem } from '../utils';\nimport { LayoutItem } from \"../layout-item\";\nimport { LayoutType, GridLayoutSetting } from '../types';\nimport './style/grid.scss';\n\n// Types\nimport {\n  CompactType,\n  EventCallback,\n  Layout,\n} from '../types';\nimport { AppMode } from '../../types/constants';\n\ntype State = {\n  activeDrag?: Layout,\n  width: number,\n  numOfCols: number,\n  breakpoint: string,\n  setting: GridLayoutSetting,\n  pixelLayouts: Array<Layout>,\n  gridLayouts: Array<Layout>\n};\n\nexport type Props = {\n  className?: string,\n  style?: Object,\n  appMode: AppMode,\n  width: number,\n  autoSize?: boolean,\n  layout?: Layout,\n  children?: any\n};\n// End Types\n\nexport class GridLayoutViewer extends React.Component<Props, State> {\n  static displayName = \"GridLayout\";\n\n  static defaultProps: Partial<Props> = {\n    autoSize: true,\n    className: \"\",\n    style: {},\n    layout: null\n  };\n\n  state: State = {\n    width: 0,\n    numOfCols: -1,\n    activeDrag: null,\n    pixelLayouts: [],\n    gridLayouts: [],\n    breakpoint: '',\n    setting: DEFAULT_GRID_LAYOUT_SETTING\n  };\n\n  static getDerivedStateFromProps(nextProps: Props, prevState: State) {\n    const layoutSetting = assign({}, DEFAULT_GRID_LAYOUT_SETTING, nextProps.layout.setting);\n    const { space, padding } = layoutSetting;\n    const breakpoint = gridUtils.getBreakpointFromWidth(layoutSetting.breakpoints, nextProps.width);\n    const colNo = gridUtils.getColsFromBreakpoint(breakpoint, layoutSetting.cols);\n    const colWidth = (nextProps.width - space * (colNo - 1) - padding[0] * 2) / colNo;\n    const gridLayouts = gridUtils.collectLayoutsAtBreakpoint(nextProps.layout.content, breakpoint, layoutSetting);\n    let layouts = gridUtils.generateResponsiveLayout(\n      gridLayouts,\n      colNo,\n      layoutSetting.compactType\n    );\n    const pixelLayouts = layouts.map(layoutItem => {\n      return {\n        id: layoutItem.id,\n        pos: gridUtils.toPixelPosition(layoutItem.pos, layoutSetting, colWidth)\n      };\n    });\n    return {\n      breakpoint: breakpoint,\n      pixelLayouts: pixelLayouts,\n      gridLayouts: layouts,\n      width: nextProps.width,\n      numOfCols: colNo,\n      setting: layoutSetting\n    };\n  }\n\n  /**\n   * Calculates a pixel value for the container.\n   * @return {String} Container height in pixels.\n   */\n  containerHeight() {\n    if (!this.props.autoSize) {\n      return;\n    }\n    const { padding, space, rowHeight } = this.state.setting;\n    const nbRow = gridUtils.bottom(this.props.layout.content || []);\n    const containerPaddingY = padding\n      ? padding[1]\n      : space;\n    return (\n      nbRow * rowHeight +\n      (nbRow - 1) * space +\n      containerPaddingY * 2 +\n      \"px\"\n    );\n  }\n\n  /**\n   * Given a grid item, set its style attributes & surround in a <Draggable>.\n   */\n  processGridItem(l: Layout, key: number) {\n    const content = this.props.layout.content || [];\n    let layoutItem = getLayoutItem(this.state.gridLayouts, l.id);\n    if (!layoutItem) {\n      return null;\n    }\n\n    return <LayoutItem\n        key={key}\n        layout={layoutItem}\n        pos={l.pos}\n        appMode={this.props.appMode}>\n      </LayoutItem>\n  }\n\n  render() {\n    const { className, style } = this.props;\n    const { pixelLayouts, numOfCols } = this.state;\n\n    const mergedClassName = classNames(\"react-grid-layout\", className);\n    const mergedStyle = {\n      height: this.containerHeight(),\n      ...style\n    };\n\n    return (\n      <div className={mergedClassName} style={mergedStyle as any}>\n        {pixelLayouts.map((layoutItem, index) => {\n          return this.processGridItem(layoutItem, index);\n        })}\n      </div>\n    );\n  }\n}\n","\nimport * as React from 'react';\nimport assign = require(\"lodash.assign\");\nimport { DEFAULT_LAYOUT_SETTING } from './default-common-setting';\nimport * as ReactRedux from 'react-redux';\nimport {AllLayoutProps, LayoutProps, LayoutStateProps } from '../types/props';\nimport { IMState} from '../types/state';\nimport { Layout, LayoutType, LayoutActionContext } from './types';\nimport { GridLayoutViewer } from './grid-layout/layout-viewer';\nimport { FixedLayoutViewer } from './fixed-layout/layout-viewer';\nimport { SidebarLayout } from './sidebar-layout/layout';\nimport SectionLayout from './section-layout/layout';\nimport { registerLayoutViewer } from './layout-factory';\nimport { LayoutItem } from './layout-item';\nimport LayoutReduxStoreExtension from './global-layout-redux-store-extension';\nimport ExtensionManager from '../extension-manager';\nimport {ExtensionPoints} from '../extension-spec/extension-spec';\nimport { ActionContext } from './action-context';\nimport { AppMode } from '../types/constants';\nimport * as utils from './utils';\nimport {\n  resizeLayouts,\n  updateSetting\n} from './actions/global-layout-actions';\n\nregisterLayoutViewer(LayoutType.FIXED_LAYOUT, FixedLayoutViewer);\nregisterLayoutViewer(LayoutType.GRID_LAYOUT, GridLayoutViewer);\nregisterLayoutViewer(LayoutType.SIDEBAR_LAYOUT, SidebarLayout);\nregisterLayoutViewer(LayoutType.SECTION_LAYOUT, SectionLayout);\n\n// interface State {\n//   layout: Layout;\n// }\n\nclass JimuLayoutViewer extends React.PureComponent<AllLayoutProps & {width: number, height: number, appMode: AppMode}>{\n  // nodeRef;\n  // mounted: boolean;\n  // _debouncedResize;\n\n  // static getDerivedStateFromProps(nextProps: AllLayoutProps, prevState: State) {\n  //   if (nextProps.layout !== prevState.layout) {\n  //     return {\n  //       layout: nextProps.layout\n  //     };\n  //   }\n  //   return null;\n  // }\n\n  constructor(props){\n    super(props);\n    // this.nodeRef = React.createRef();\n    // this.mounted = false;\n    ExtensionManager.getInstance().registerExtension({\n      epName: ExtensionPoints.ReduxStore,\n      extension: new LayoutReduxStoreExtension()\n    });\n  }\n\n  // componentDidMount() {\n  //   this.mounted = true;\n  //   const node = this.nodeRef.current;\n  //   const rect = node.getBoundingClientRect();\n\n  //   this._debouncedResize = debounce(this.updateDimensions.bind(this), 100);\n  //   window.addEventListener(\"resize\", this._debouncedResize);\n\n  //   this.setState({\n  //     width: rect.width,\n  //     height: rect.height\n  //   });\n  // }\n\n  // componentWillUnmount() {\n  //   window.removeEventListener(\"resize\", this._debouncedResize);\n  // }\n\n  // updateDimensions() {\n  //   const node = this.nodeRef.current;\n  //   const rect = node.getBoundingClientRect();\n  //   this.setState({\n  //     width: rect.width,\n  //     height: rect.height\n  //   });\n  // }\n\n  render(){\n    const actions: LayoutActionContext = {\n      updateSetting: (id, newSetting) => {\n        this.props.dispatch(updateSetting(id, newSetting))\n      },\n      addLayout: () => {},\n      removeLayout: () => {},\n      resizeLayouts: (layouts, breakpoint) => {\n        this.props.dispatch(resizeLayouts(layouts, breakpoint))\n      },\n      activate: () => {},\n      dndLayout: () => {},\n      removeWidget: () => {}\n    };\n\n    // if (!this.mounted) {\n    //   return <div style={style} ref={this.nodeRef}></div>;\n    // }\n    const {width, height, appMode, layout} = this.props;\n    if (!layout) {\n      return null;\n    }\n    const setting = assign({}, DEFAULT_LAYOUT_SETTING, layout.setting);\n    const layoutPos = utils.calPixelPosition(layout.pos, width, height, setting);\n    const mergedStyle = {\n      ...this.props.style,\n      position: 'relative',\n      margin: '0 auto'\n    }\n    return (\n      <ActionContext.Provider value={actions}>\n        <div className=\"layout\" style={mergedStyle as any}>\n          <LayoutItem style={this.props.style} layout={layout} appMode={appMode}\n            pos={layoutPos}>\n          </LayoutItem>\n        </div>\n      </ActionContext.Provider>\n    );\n  }\n}\n\nconst mapStateToProps = (state: IMState) => {\n  return {\n    appConfig: state.appConfig,\n    appMode: state.appMode\n  }\n};\n\n//connect<IMapStateToProps, IMapDispatchToProps, ICompProps, IReduxState>(mapStateToProps, mapDispatchToProps)\nexport default ReactRedux.connect<LayoutStateProps, {}, LayoutProps & {width: number, height: number}>(mapStateToProps)(JimuLayoutViewer);\n","import * as Immutable from 'seamless-immutable';\nimport * as invariant from 'invariant';\nimport { GlobalLayouts, Layout, LayoutInfo, LayoutType, LayoutMap, Position, OrderAdjustType, FixedLayoutSetting } from './types';\nimport { getMaximumId } from './utils';\n\nexport function findRootLayout(layoutMap: LayoutMap): Layout {\n  let root: Layout = null;\n  Object.keys(layoutMap).some(key => {\n    if (typeof layoutMap[key].parentId === 'undefined') {\n      root = layoutMap[key];\n      return true;\n    }\n  });\n  if (root.type === LayoutType.SIDEBAR_LAYOUT) {\n    return filterMainAreaFromSidebar(root.id, layoutMap);\n  }\n  return root;\n}\n\nfunction filterMainAreaFromSidebar(rootId: string, layoutMap: LayoutMap) {\n  let target: Layout = null;\n  Object.keys(layoutMap).some(key => {\n    const layoutItem = layoutMap[key];\n    if (layoutItem.parentId === rootId && (!layoutItem.setting || !('attach' in layoutItem.setting))) {\n      target = layoutMap[key];\n      return true;\n    }\n  });\n  if (target && target.type === LayoutType.SIDEBAR_LAYOUT) {\n    return filterMainAreaFromSidebar(target.id, layoutMap);\n  }\n  return target;\n}\n\nexport function addWidget(widgetId: string, layoutInfo: LayoutInfo,\n  layouts: GlobalLayouts) {\n  const { layoutId, layoutItemId } = layoutInfo;\n  invariant(layouts[layoutId], `layoutId ${layoutId} missing`);\n  let updatedLayouts = layouts;\n  if(!Immutable.isImmutable(layouts)) {\n    updatedLayouts = Immutable(layouts);\n  }\n\n  if (layoutInfo.layoutItemId) { // add widget into a exsting layout item\n    invariant(layouts[layoutId][layoutItemId], `layoutId ${layoutId}.${layoutItemId} missing`);\n    return updatedLayouts.setIn([layoutId, layoutItemId, 'widgetId'], widgetId);\n  }\n  // create a layout item then add widget\n  const rootLayout = findRootLayout(layouts[layoutId] as LayoutMap);\n  const nextId = getMaximumId(layouts[layoutId] as LayoutMap) + 1;\n  const newLayout: Layout = {\n    id: `${nextId}`,\n    layoutId: layoutId,\n    parentId: rootLayout.id,\n    type: LayoutType.WIDGET,\n    widgetId: widgetId,\n    pos: {x: 0, y: 0, w: 300, h: 200}\n  };\n  if (rootLayout.type === LayoutType.GRID_LAYOUT) {\n    newLayout.pos = {x: 0, y: Infinity, w: 4, h: 3};\n  }\n  return updatedLayouts.setIn([layoutId, `${nextId}`], newLayout);\n}\n\nexport function addSection(sectionId: string, layoutInfo: LayoutInfo, layouts: GlobalLayouts) {\n  const { layoutId, layoutItemId } = layoutInfo;\n  invariant(layouts[layoutId], `layoutId ${layoutId} missing`);\n  let updatedLayouts = layouts;\n  if(!Immutable.isImmutable(layouts)) {\n    updatedLayouts = Immutable(layouts);\n  }\n\n  if (layoutInfo.layoutItemId) { // add widget into a exsting layout item\n    invariant(layouts[layoutId][layoutItemId], `layoutId ${layoutId}.${layoutItemId} missing`);\n    return updatedLayouts.setIn([layoutId, layoutItemId, 'sectionId'], sectionId);\n  }\n  // create a layout item then add widget\n  const rootLayout = findRootLayout(layouts[layoutId] as LayoutMap);\n  const nextId = getMaximumId(layouts[layoutId] as LayoutMap) + 1;\n  const newLayout: Layout = {\n    id: `${nextId}`,\n    layoutId: layoutId,\n    parentId: rootLayout.id,\n    type: LayoutType.SECTION_LAYOUT,\n    sectionId: sectionId,\n    pos: {x: 0, y: 0, w: 300, h: 200}\n  };\n  if (rootLayout.type === LayoutType.GRID_LAYOUT) {\n    newLayout.pos = {x: 0, y: Infinity, w: 4, h: 3};\n  }\n  return updatedLayouts.setIn([layoutId, `${nextId}`], newLayout);\n}\n\nexport function addLayout(layoutId: string, parentId: string, layout: Layout,\nlayouts: GlobalLayouts) {\n  invariant(layouts[layoutId], `layoutId ${layoutId} missing`);\n  let updatedLayouts = Immutable.isImmutable(layouts) ? layouts : Immutable(layouts);\n\n  // create a layout item then add widget\n  const nextId = getMaximumId(layouts[layoutId] as LayoutMap) + 1;\n  const newLayout: Layout = {\n    id: `${nextId}`,\n    layoutId: layoutId,\n    parentId: parentId,\n    type: layout.type,\n    pos: layout.pos,\n    setting: layout.setting\n  };\n  return updatedLayouts.setIn([layoutId, `${nextId}`], newLayout);\n}\n\nexport function removeWidget(widgetId: string, layouts: GlobalLayouts) {\n  let updatedLayouts = Immutable.isImmutable(layouts) ? layouts : Immutable(layouts);\n\n  Object.keys(layouts).forEach(layoutId => {\n    Object.keys(layouts[layoutId]).forEach(layoutItemId => {\n      if (layouts[layoutId][layoutItemId].type === LayoutType.WIDGET &&\n        layouts[layoutId][layoutItemId].widgetId === widgetId) {\n        updatedLayouts = updatedLayouts.setIn([layoutId, layoutItemId, 'widgetId'], null);\n      }\n    });\n  });\n  return updatedLayouts;\n}\n\nexport function removeLayout(layoutInfo: LayoutInfo, layouts: GlobalLayouts) {\n  const { layoutId, layoutItemId } = layoutInfo;\n  if (!layouts[layoutId] || !layouts[layoutId][layoutItemId]) {\n    return layouts;\n  }\n  let updatedLayouts = layouts, targetLayout = layouts[layoutId] as LayoutMap;\n  if(!Immutable.isImmutable(layouts)) {\n    updatedLayouts = Immutable(layouts);\n  }\n  if(!Immutable.isImmutable(targetLayout)) {\n    targetLayout = Immutable(targetLayout);\n  }\n\n  const removeDescendants = (itemId: string, layoutMap: LayoutMap) => {\n    let updatedLayoutMap = layoutMap.without(itemId);\n    Object.keys(layoutMap).forEach(key => {\n      if (layoutMap[key].parentId === itemId) {\n        updatedLayoutMap = removeDescendants(key, updatedLayoutMap);\n      }\n    });\n    return updatedLayoutMap;\n  }\n\n  targetLayout = removeDescendants(layoutItemId, targetLayout);\n  return updatedLayouts.set(layoutId, targetLayout);\n}\n\nexport function updateSetting(layoutInfo: LayoutInfo, setting, layouts: GlobalLayouts) {\n  return updateLayout(layoutInfo, null, setting, layouts);\n}\n\nexport function updateLayout(layoutInfo: LayoutInfo, pos: Position, setting, layouts: GlobalLayouts) {\n  const { layoutId, layoutItemId } = layoutInfo;\n  if (!layouts[layoutId] || !layouts[layoutId][layoutItemId]) {\n    return layouts;\n  }\n  let updatedLayouts = Immutable.isImmutable(layouts) ? layouts : Immutable(layouts);\n  if (setting) {\n    let mergedSetting = Immutable(layouts[layoutId][layoutItemId].setting || {}).merge(setting);\n    updatedLayouts = updatedLayouts.setIn([layoutId, layoutItemId, 'setting'], mergedSetting);\n  }\n  if (pos) {\n    let mergedPos = Immutable(layouts[layoutId][layoutItemId].pos).merge(pos);\n    updatedLayouts = updatedLayouts.setIn([layoutId, layoutItemId, 'pos'], mergedPos);\n  }\n  return updatedLayouts;\n}\n\nexport function resizeLayouts(newLayouts: Array<Layout>, breakpoint, layouts: GlobalLayouts) {\n  let updatedLayouts = Immutable.isImmutable(layouts) ? layouts : Immutable(layouts);\n  newLayouts.forEach(layout => {\n    const {layoutId, id } = layout;\n    if (!updatedLayouts[layoutId] || !updatedLayouts[layoutId][id]) {\n      return;\n    }\n    if (breakpoint) {\n      updatedLayouts = updatedLayouts.setIn([layoutId, id, 'pos', breakpoint], layout.pos);\n    } else {\n      updatedLayouts = updatedLayouts.setIn([layoutId, id, 'pos'], layout.pos);\n    }\n  });\n  return updatedLayouts;\n}\n\nexport function activeLayout(layoutInfo: LayoutInfo, layouts: GlobalLayouts) {\n  let updatedLayout = layouts;\n  Object.keys(layouts).forEach(layoutId => {\n    let layoutMap : LayoutMap = Immutable.isImmutable(layouts[layoutId]) ? layouts[layoutId] as LayoutMap : Immutable(layouts[layoutId]);\n    Object.keys(layoutMap).forEach(layoutItemId => {\n      if (layoutId === layoutInfo.layoutId && layoutItemId === layoutInfo.layoutItemId) {\n        layoutMap = layoutMap.setIn([layoutItemId, 'setting', 'active'], true);\n      } else {\n        const setting = Immutable(layoutMap[layoutItemId].setting || {}).without('active');\n        layoutMap = layoutMap.setIn([layoutItemId, 'setting'], setting);\n      }\n    });\n    updatedLayout = updatedLayout.set(layoutId, layoutMap);\n  });\n  return updatedLayout;\n}\n\nexport function findDescendantIdArray(layoutId: string, layoutMap: LayoutMap) {\n  const childrenIdArray = [];\n  const findDescendants = (parentId: string) => {\n    childrenIdArray.push(parentId);\n    Object.keys(layoutMap).forEach(key => {\n      if (layoutMap[key].parentId === parentId) {\n        findDescendants(layoutMap[key].id);\n      }\n    });\n  }\n  findDescendants(layoutId);\n  return childrenIdArray;\n}\n\nexport function dndLayout(layoutInfo: LayoutInfo, parentLayoutInfo: LayoutInfo,\nnewPosition: Position, layouts: GlobalLayouts) {\n  const {layoutId, layoutItemId} = layoutInfo;\n  if (!layouts[layoutId] || !layouts[layoutId][layoutItemId]) {\n    return layouts;\n  }\n  if (!layouts[parentLayoutInfo.layoutId] || !layouts[parentLayoutInfo.layoutId][parentLayoutInfo.layoutItemId]) {\n    return layouts;\n  }\n  const targetLayout = layouts[layoutId][layoutItemId];\n  const parentLayout = layouts[parentLayoutInfo.layoutId][parentLayoutInfo.layoutItemId];\n  if (layoutId === parentLayoutInfo.layoutId && targetLayout.parentId === parentLayout.id) {\n    return layouts; // already in\n  }\n\n  if (layoutId !== parentLayoutInfo.layoutId) {\n    const nextId = getMaximumId(layouts[parentLayoutInfo.layoutId] as LayoutMap);\n    let fromLayoutMap = Immutable.isImmutable(layouts[layoutId]) ?\n      layouts[layoutId] as LayoutMap : Immutable(layouts[layoutId]);\n    let toLayoutMap = Immutable.isImmutable(layouts[parentLayoutInfo.layoutId]) ?\n      layouts[parentLayoutInfo.layoutId] as LayoutMap : Immutable(layouts[parentLayoutInfo.layoutId]);\n    const childrenIdArray = findDescendantIdArray(targetLayout.id, fromLayoutMap);\n    // add tree to parent layout\n    childrenIdArray.forEach(itemId => {\n      let item = Immutable.isImmutable(fromLayoutMap[itemId]) ?\n        fromLayoutMap[itemId] as Immutable.ImmutableObject<Layout> : Immutable(fromLayoutMap[itemId]);\n      const idBeforeMove = item.id;\n      if (itemId === layoutItemId) { // top layout\n        item = item.set('id', `${+item.id + nextId + 1}`)\n          .set('parentId', `${+parentLayout.id}`)\n          .set('pos', newPosition);\n      } else { // children layout\n        // update the id of the layouts to make them unique among the layout\n        item = item.set('id', `${+item.id + nextId + 1}`).set('parentId', `${+item.parentId + nextId + 1}`);\n      }\n\n      invariant(!toLayoutMap[item.id], `layout with id ${item.id} should not in ${parentLayoutInfo.layoutId} before dropping`);\n      toLayoutMap = toLayoutMap.set(item.id, item);\n      fromLayoutMap = fromLayoutMap.without(idBeforeMove);\n    });\n    return layouts.set(layoutId, fromLayoutMap).set(parentLayoutInfo.layoutId, toLayoutMap);\n  } else {\n    // drag and drop in the same layout\n    return layouts.setIn([layoutId, layoutItemId, 'parentId'], parentLayout.id)\n      .setIn([layoutId, layoutItemId, 'pos'], newPosition);\n  }\n}\n\nexport function removeSection(sectionId, layouts: GlobalLayouts) {\n  let updatedLayouts = Immutable.isImmutable(layouts) ? layouts : Immutable(layouts);\n\n  Object.keys(layouts).forEach(layoutId => {\n    let layoutMap = Immutable.isImmutable(layouts[layoutId]) ? layouts[layoutId] as LayoutMap : Immutable(layouts[layoutId]);\n    Object.keys(layouts[layoutId]).forEach(layoutItemId => {\n      if (layouts[layoutId][layoutItemId].type === LayoutType.SECTION_LAYOUT &&\n        layouts[layoutId][layoutItemId].sectionId === sectionId) {\n        layoutMap = layoutMap.without(layoutItemId);\n      }\n    });\n    updatedLayouts = updatedLayouts.set(layoutId, layoutMap);\n  });\n  return updatedLayouts;\n}\n\nexport function changeLayoutOrder(layoutInfo: LayoutInfo, orderType: OrderAdjustType, layouts: GlobalLayouts) {\n  const {layoutId, layoutItemId} = layoutInfo;\n  if (!layouts[layoutId] || !layouts[layoutId][layoutItemId]) {\n    return layouts;\n  }\n  const parentId = layouts[layoutId][layoutItemId].parentId;\n  if (!parentId || !layouts[layoutId][parentId] || layouts[layoutId][parentId].type !== LayoutType.FIXED_LAYOUT) {\n    return layouts;\n  }\n  // collect siblings with the same parentId\n  let siblings:Array<{id: string, order: number}> = [];\n  Object.keys(layouts[layoutId]).forEach(key => {\n    const item = layouts[layoutId][key];\n    const setting = item.setting as FixedLayoutSetting;\n    if (item.parentId === parentId) {\n      siblings.push({\n        id: key,\n        order: item.setting && !isNaN(+setting.order) ? +setting.order : 0\n      });\n    }\n  });\n  siblings = siblings.sort((a, b) => {\n    return a.order - b.order;\n  });\n  let targetIndex = -1;\n  siblings.some((item, index) => {\n    if (item.id === layoutItemId) {\n      targetIndex = index;\n      return true;\n    }\n  });\n\n  let temp = siblings[targetIndex];\n\n  switch(orderType) {\n    case OrderAdjustType.BRING_FORWARD:\n      if (targetIndex < siblings.length - 1) {\n        siblings[targetIndex] = siblings[targetIndex + 1];\n        siblings[targetIndex + 1] = temp;\n      }\n      break;\n    case OrderAdjustType.SEND_BACKWARD:\n      if (targetIndex > 0) {\n        siblings[targetIndex] = siblings[targetIndex - 1];\n        siblings[targetIndex - 1] = temp;\n      }\n      break;\n    case OrderAdjustType.BRING_TO_FRONT:\n      if (targetIndex < siblings.length - 1) {\n        for (let i = targetIndex; i < siblings.length - 1; i++) {\n          siblings[i] = siblings[i + 1];\n        }\n        siblings[siblings.length - 1] = temp;\n      }\n      break;\n    case OrderAdjustType.SEND_TO_BACK:\n      if (targetIndex > 0) {\n        for (let i = targetIndex; i > 0; i--) {\n          siblings[i] = siblings[i - 1];\n        }\n        siblings[0] = temp;\n      }\n      break;\n  }\n\n  let updatedLayouts = Immutable.isImmutable(layouts) ? layouts : Immutable(layouts);\n  siblings.forEach((item, index) => {\n    updatedLayouts = updatedLayouts.setIn([layoutId, item.id, 'setting', 'order'], index);\n  });\n  return updatedLayouts;\n}","import * as Immutable from 'seamless-immutable';\nimport * as utils from '../global-action-utils';\nimport { GlobalLayoutActions } from '../actions/global-layout-actions';\nimport { LayoutType } from '../types';\n\nconst defaultState = Immutable({\n  'default': {\n    '0': {\n      id: '0',\n      pos: {\n        x: 0,\n        y: 0,\n        w: 0,\n        h: 0\n      },\n      type: LayoutType.FIXED_LAYOUT\n    }\n  }\n});\n\nexport function globalLayoutReducer(state=defaultState, action) {\n  switch (action.type) {\n    case GlobalLayoutActions.ADD_WIDGET:\n      return utils.addWidget(action.widgetId, action.layoutInfo, state);\n    case GlobalLayoutActions.ADD_SECTION:\n      return utils.addSection(action.sectionId, action.layoutInfo, state);\n    case GlobalLayoutActions.REMOVE_LAYOUT:\n      return utils.removeLayout(action.layoutInfo, state);\n    case GlobalLayoutActions.RESIZE_LAYOUTS:\n      return utils.resizeLayouts(action.layouts, action.breakpoint, state);\n    case GlobalLayoutActions.UPDATE_SETTING:\n      return utils.updateSetting(action.layoutInfo, action.newSetting, state);\n    case GlobalLayoutActions.REMOVE_WIDGET:\n      return utils.removeWidget(action.widgetId, state);\n    case GlobalLayoutActions.ADD_LAYOUT:\n      return utils.addLayout(action.layoutId, action.parentId,\n        action.layout,\n        state);\n    case GlobalLayoutActions.DRAG_DROP_LAYOUT:\n    {\n      const {layoutInfo, parentLayoutInfo, newPosition} = action;\n      return utils.dndLayout(layoutInfo, parentLayoutInfo, newPosition, state);\n    }\n    case GlobalLayoutActions.ACTIVATE:\n      return utils.activeLayout(action.layoutInfo, state);\n    case GlobalLayoutActions.REMOVE_SECTION:\n      return utils.removeSection(action.sectionId, state);\n    case GlobalLayoutActions.UPDATE_LAYOUT:\n      return utils.updateLayout(action.layoutInfo, action.pos, action.newSetting, state);\n    case GlobalLayoutActions.CHANGE_ORDER:\n      return utils.changeLayoutOrder(action.layoutInfo, action.orderType, state);\n    default:\n      return state;\n  }\n}","import assign = require(\"lodash.assign\");\nimport * as Immutable from 'seamless-immutable';\nimport { Layout, AttachType, SidebarItemSetting, Position } from '../types';\nimport { DEFAULT_SIDEBAR_SETTING } from './default-sidebar-setting';\n\nexport interface SideLayouts {\n  header?: Layout;\n  footer?: Layout;\n  left?: Layout;\n  right?: Layout;\n  main?: Layout;\n}\n\nexport function calculatePosition(sideLayouts: SideLayouts,\nwidth: number,\nheight: number,\nresizingSide?: AttachType,\ndelta?: {w: number, h: number}): {[key: string]: Position} {\n  const layouts = {};\n  const { header, footer, left, right } = sideLayouts;\n\n  if (header) {\n    if (header.setting.toggleOn === true && header.pos.h === null) {\n      layouts['header'] = {\n        x: 0,\n        y: 0,\n        w: width,\n        h: height\n      }\n      return layouts;\n    }\n    let pos = {\n      x: 0,\n      y: 0,\n      w: width,\n      h: header.pos.h\n    };\n    if (header.setting.toggleOn === false) {\n      pos.h = header.setting.min || 0;\n    }\n    layouts['header'] = pos;\n  }\n  if (footer) {\n    if (footer.setting.toggleOn === true && footer.pos.h === null) {\n      layouts['footer'] = {\n        x: 0,\n        y: 0,\n        w: width,\n        h: height\n      }\n      return layouts;\n    }\n    let pos = {\n      x: 0,\n      y: 0,\n      w: width,\n      h: footer.pos.h\n    };\n    if (footer.setting.toggleOn === false) {\n      pos.h = footer.setting.min || 0;\n    }\n    pos.y = height - pos.h;\n    layouts['footer'] = pos;\n  }\n  if (left) {\n    if (left.setting.toggleOn === true && left.pos.w === null) {\n      layouts['left'] = {\n        x: 0,\n        y: 0,\n        w: width,\n        h: height\n      }\n      return layouts;\n    }\n    let pos = {\n      x: 0,\n      y: header && occupySpace(header.setting) ? layouts['header'].h : 0,\n      w: left.pos.w,\n      h: 0\n    }\n    pos.h = height - pos.y - (footer && occupySpace(footer.setting) ? layouts['footer'].h : 0);\n    if (left.setting.toggleOn === false) {\n      pos.w = left.setting.min || 0;\n    }\n    layouts['left'] = pos;\n  }\n  if (right) {\n    if (right.setting.toggleOn === true && right.pos.w === null) {\n      layouts['right'] = {\n        x: 0,\n        y: 0,\n        w: width,\n        h: height\n      }\n      return layouts;\n    }\n    let pos = {\n      x: 0,\n      y: header && occupySpace(header.setting) ? layouts['header'].h : 0,\n      w: right.pos.w,\n      h: 0\n    }\n    pos.h = height - pos.y - (footer && occupySpace(footer.setting) ? layouts['footer'].h : 0);\n    if (right.setting.toggleOn === false) {\n      pos.w = right.setting.min || 0;\n    }\n    pos.x = width - pos.w;\n    layouts['right'] = pos;\n  }\n\n  layouts['main'] = {\n    x: left && occupySpace(left.setting) ? layouts['left'].w : 0,\n    y: header && occupySpace(header.setting) ? layouts['header'].h : 0,\n    w: width - (left && occupySpace(left.setting) ? layouts['left'].w : 0) -\n      (right && occupySpace(right.setting) ? layouts['right'].w : 0),\n    h: height - (header && occupySpace(header.setting) ? layouts['header'].h : 0) -\n      (footer && occupySpace(footer.setting) ? layouts['footer'].h : 0)\n  }\n  if(resizingSide === AttachType.TOP && header && occupySpace(header.setting) && delta) {\n    layouts['main'].h -= delta.h;\n    layouts['main'].y += delta.h;\n  }\n  if(resizingSide === AttachType.BOTTOM && footer && occupySpace(footer.setting) && delta) {\n    layouts['main'].h -= delta.h;\n  }\n  if(resizingSide === AttachType.LEFT && left && occupySpace(left.setting) && delta) {\n    layouts['main'].w -= delta.w;\n    layouts['main'].x += delta.w;\n  }\n  if(resizingSide === AttachType.RIGHT && right && occupySpace(right.setting) && delta) {\n    layouts['main'].w -= delta.w;\n  }\n  return layouts;\n}\n\nexport function collectSidebars(layouts: Array<Layout>, layoutsQueryObject?: string): SideLayouts {\n  const result: SideLayouts = {};\n  layouts.forEach(layout => {\n    const setting: SidebarItemSetting = assign({}, DEFAULT_SIDEBAR_SETTING, layout.setting);\n    let imLayout = Immutable(layout).set('setting', setting);\n    const attach = setting.attach;\n\n    if (layoutsQueryObject) {\n      const params = layoutsQueryObject.split(',');\n      params.forEach(param => {\n        // format: layoutId:layoutItemId:settingKey:settingValue\n        const items = param.split(':');\n        if (items.length === 4) {\n          if (layout.layoutId === items[0] && layout.id === items[1]) {\n            if (items[3] === 'true') {\n              imLayout = imLayout.setIn(['setting', items[2]], true);\n            } else if (items[3] === 'false') {\n              imLayout = imLayout.setIn(['setting', items[2]], false);\n            } else if (!isNaN(+items[3])) {\n              imLayout = imLayout.setIn(['setting', items[2]], +items[3]);\n            } else {\n              imLayout = imLayout.setIn(['setting', items[2]], items[3]);\n            }\n          }\n        }\n      });\n    }\n\n    switch (attach) {\n      case AttachType.TOP:\n        result.header = imLayout;\n        break;\n      case AttachType.BOTTOM:\n        result.footer = imLayout;\n        break;\n      case AttachType.LEFT:\n        result.left = imLayout;\n        break;\n      case AttachType.RIGHT:\n        result.right = imLayout;\n        break;\n      default:\n        result.main = imLayout;\n        break;\n    }\n  });\n  return result;\n}\n\nexport function occupySpace(setting: SidebarItemSetting) {\n  return !setting.overlay;\n}\n\nexport function visible(setting: SidebarItemSetting) {\n  return !setting.togglable || setting.toggleOn;\n}","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@supports (position: -webkit-sticky) or (position: sticky) {\\n  .header {\\n    position: -webkit-sticky;\\n    position: sticky;\\n    top: 0;\\n    z-index: 1050; }\\n  .sidebar {\\n    position: -webkit-sticky;\\n    position: sticky;\\n    z-index: 1000; } }\\n\\n.sidebar-layout {\\n  width: 100%;\\n  height: 100%; }\\n\", \"\"]);\n\n// exports\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./sidebar-layout.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./sidebar-layout.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./sidebar-layout.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sidebar-layout .sidebar_handler_top,\\n.sidebar-layout .sidebar_handler_left,\\n.sidebar-layout .sidebar_handler_bottom,\\n.sidebar-layout .sidebar_handler_right {\\n  position: absolute;\\n  cursor: pointer;\\n  background-color: #fff;\\n  border: 1px solid #ced4da; }\\n  .sidebar-layout .sidebar_handler_top::before,\\n  .sidebar-layout .sidebar_handler_left::before,\\n  .sidebar-layout .sidebar_handler_bottom::before,\\n  .sidebar-layout .sidebar_handler_right::before {\\n    content: '';\\n    display: block;\\n    width: 0;\\n    height: 0;\\n    border: 5px solid transparent; }\\n\\n.sidebar-layout .sidebar_handler_top,\\n.sidebar-layout .sidebar_handler_bottom {\\n  left: 50%;\\n  padding: 5px 18px;\\n  transform: translate(-50%, 0); }\\n\\n.sidebar-layout .sidebar_handler_left,\\n.sidebar-layout .sidebar_handler_right {\\n  top: 50%;\\n  padding: 18px 5px;\\n  transform: translate(0, -50%); }\\n\\n.sidebar-layout .sidebar_handler_top {\\n  bottom: -15px;\\n  border-top: 0; }\\n  .sidebar-layout .sidebar_handler_top::before {\\n    border-bottom: 0;\\n    border-top-color: #343a40; }\\n\\n.sidebar-layout .sidebar_handler_left {\\n  right: -15px;\\n  border-left: 0; }\\n  .sidebar-layout .sidebar_handler_left::before {\\n    border-left: 0;\\n    border-right-color: #343a40; }\\n\\n.sidebar-layout .sidebar_handler_bottom {\\n  top: -15px;\\n  border-bottom: 0; }\\n  .sidebar-layout .sidebar_handler_bottom::before {\\n    border-top: 0;\\n    border-bottom-color: #343a40; }\\n\\n.sidebar-layout .sidebar_handler_right {\\n  left: -15px;\\n  border-right: 0; }\\n  .sidebar-layout .sidebar_handler_right::before {\\n    border-right: 0;\\n    border-left-color: #343a40; }\\n\\n.sidebar-layout .toggle-off .sidebar_handler_left::before,\\n.sidebar-layout .toggle-off .sidebar_handler_right::before {\\n  transform: scaleX(-1); }\\n\\n.sidebar-layout .toggle-off .sidebar_handler_top::before,\\n.sidebar-layout .toggle-off .sidebar_handler_bottom::before {\\n  transform: scaleY(-1); }\\n\", \"\"]);\n\n// exports\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./sidebar.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./sidebar.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/index.js??ref--6-1!../../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./sidebar.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","import * as React from 'react';\nimport assign = require(\"lodash.assign\");\nimport classNames = require(\"classnames\");\nimport { setTransform } from '../utils';\nimport { Layout, Position, SidebarItemSetting, AttachType } from '../types';\nimport { DEFAULT_SIDEBAR_SETTING } from './default-sidebar-setting';\nimport './style/sidebar.scss';\nimport { LayoutItem } from '../layout-item';\nimport { AppMode } from '../../types/constants';\n\ninterface Props {\n  layout: Layout;\n  appMode: AppMode;\n  pos: Position;\n  className?: string;\n  style?: Object;\n  onToggleChange? (id: string, toggle: boolean);\n}\n\nexport class Sidebar extends React.PureComponent<Props> {\n  static defaultProps: Partial<Props> = {\n    onToggleChange: () => {}\n  };\n\n  _getLayoutId() {\n    return this.props.layout ? this.props.layout.id : '';\n  }\n\n  toggleItem() {\n    const setting = assign({}, DEFAULT_SIDEBAR_SETTING, this.props.layout.setting);\n    this.props.onToggleChange(this.props.layout.id, !setting.toggleOn);\n  }\n\n  render() {\n    const { pos, style, layout, className } = this.props;\n    let { w, h } = pos;\n    const setting = layout.setting as SidebarItemSetting;\n    const { attach, togglable, toggleOn } = setting;\n    let layoutItem = null;\n    if (!togglable || (togglable && toggleOn) || setting.min > 0) {\n      layoutItem = <LayoutItem pos={{x:0, y:0, w, h}} layout={layout} appMode={this.props.appMode}></LayoutItem>;\n    }\n    const mergedStyle = {\n      ...setTransform(pos),\n      ...style\n    };\n    const mergedClassNames = classNames(className, {\n      'toggle-on': togglable && toggleOn,\n      'toggle-off': togglable && !toggleOn\n    })\n    return (\n      <div className={mergedClassNames}\n        style={mergedStyle as any}>\n        {layoutItem}\n        {togglable &&\n          <div className={`sidebar_handler_${attach}`} onClick={this.toggleItem.bind(this)}></div>\n        }\n      </div>\n    );\n  }\n}\n","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".fixed-layout {\\n  width: 100%;\\n  height: 100%; }\\n\\n.restricted-fixed-layout {\\n  width: 100%;\\n  height: 100%;\\n  overflow: auto; }\\n\\n.layout-container {\\n  width: 100%;\\n  height: 100%; }\\n\", \"\"]);\n\n// exports\n","import * as Immutable from 'seamless-immutable';\nimport { Layout, FixedLayoutSetting } from '../types';\n\nexport function sortLayoutItems(layoutArray: Array<Layout>): Array<Layout> {\n  const result = [];\n  layoutArray.forEach(layoutItem => {\n    let imLayoutItem = Immutable(layoutItem);\n    if (!layoutItem.setting || isNaN(+(layoutItem.setting as FixedLayoutSetting).order)) {\n      imLayoutItem = imLayoutItem.setIn(['setting', 'order'], 0);\n    }\n    result.push(imLayoutItem);\n  });\n  return result.sort((a: Layout, b: Layout) => {\n    return (a.setting as FixedLayoutSetting).order - (b.setting as FixedLayoutSetting).order;\n  });\n}","import * as React from 'react';\nimport classNames = require(\"classnames\");\nimport assign = require(\"lodash.assign\");\nimport { Layout, FixedLayoutSetting, LayoutActionContext, LayoutInfo } from '../types';\nimport { DropTarget, ConnectDropTarget, DropTargetMonitor, DropTargetConnector } from 'react-dnd';\nimport draggable from '../react-dnd-draggable';\nimport resizable from '../react-dnd-resizable';\nimport * as utils from '../utils';\nimport * as fixedUtils from './fixed-layout-util';\nimport { DEFAULT_FIX_LAYOUT_SETTING } from './default-setting';\nimport './style/layout.scss';\nimport { AppMode } from '../../types/constants';\nimport { LayoutItem } from '../layout-item';\nimport { DND_TYPES } from '../react-dnd-types';\n\nexport interface DropProps {\n  connectDropTarget?: ConnectDropTarget,\n  isOver?: boolean,\n  draggingItem?: {\n    layout: Layout,\n    width: number,\n    height: number,\n    restrict: boolean}\n}\ninterface FixedLayoutProps {\n  layout?: Layout;\n  appMode: AppMode;\n  width: number;\n  height: number;\n  actionContext?: LayoutActionContext;\n}\n\nconst InteractItem = resizable()(draggable(null)(LayoutItem));\n\nclass FixedLayoutPrototype extends React.PureComponent<FixedLayoutProps & DropProps> {\n  static displayName = \"FixedLayout\";\n\n  static defaultProps: Partial<FixedLayoutProps> = {\n    actionContext: {\n      updateSetting: utils.emptyFunc,\n      addLayout: utils.emptyFunc,\n      removeLayout: utils.emptyFunc,\n      resizeLayouts: utils.emptyFunc,\n      dndLayout: utils.emptyFunc,\n      activate: utils.emptyFunc,\n      removeWidget: utils.emptyFunc\n    }\n  };\n\n  ref;\n  clientRect: ClientRect;\n\n  constructor(props) {\n    super(props);\n    utils.autoBindHandlers(this, [\n      '_onItemResizeEnd'\n    ]);\n  }\n\n  componentDidMount() {\n    const domNode = this.ref as HTMLElement;\n    this.clientRect = domNode.getBoundingClientRect();\n  }\n\n  componentDidUpdate() {\n    const domNode = this.ref as HTMLElement;\n    this.clientRect = domNode.getBoundingClientRect();\n  }\n\n  _getFixedPosOfLayoutItem(id: string) {\n    const { width, height, layout } = this.props;\n    const layoutItem = utils.getLayoutItem(this.props.layout.content, id);\n    const itemSetting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, layoutItem.setting);\n    if (layout.setting && (layout.setting as FixedLayoutSetting).gridSize) {\n      itemSetting.gridSize = (layout.setting as FixedLayoutSetting).gridSize;\n    }\n    return utils.calPixelPosition(layoutItem.pos, width, height, itemSetting);\n  }\n\n  _onItemResizeEnd(id: string, x: number, y: number, dw: number, dh: number) {\n    const { actionContext } = this.props;\n    const layoutItem = utils.getLayoutItem(this.props.layout.content, id);\n    const itemSetting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, layoutItem.setting);\n    const pos = this._getFixedPosOfLayoutItem(id);\n    const { width, height } = this.props;\n\n    const newPos = {\n      x: Math.max(0, x),\n      y: Math.max(0, y),\n      w: pos.w + dw,\n      h: pos.h + dh\n    };\n    const relativePos = utils.calLayoutPosition(newPos, width, height, itemSetting);\n\n    const newLayouts = [{\n      id: id,\n      layoutId: layoutItem.layoutId,\n      pos: relativePos\n    }];\n\n    if (newPos.x + newPos.w > width || newPos.y + newPos.h > height) {\n      const layoutWidth = newPos.x + newPos.w > width ? newPos.x + newPos.w : width,\n        layoutHeight = newPos.y + newPos.h > height ? newPos.y + newPos.h : height;\n\n      newLayouts.push({\n        id: this.props.layout.id,\n        layoutId: this.props.layout.layoutId,\n        pos: {\n          x: this.props.layout.pos.x,\n          y: this.props.layout.pos.y,\n          ...this._calLayoutSize(layoutWidth, layoutHeight)\n        }\n      });\n    }\n\n    actionContext.resizeLayouts(newLayouts);\n  }\n\n  _calLayoutSize(width: number, height: number) {\n    let w = width, h = height;\n    const { layout } = this.props;\n    const layoutSetting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, layout.setting);\n    if (!layoutSetting.widthInPixel) {\n      const containerWidth = this.props.width / layout.pos.w;\n      w = Math.round(width / containerWidth);\n    }\n    if (!layoutSetting.heightInPixel) {\n      const containerHeight = this.props.height / layout.pos.h;\n      h = Math.round(height / containerHeight);\n    }\n    return {w, h};\n  }\n\n  _processLayoutItem(l: Layout, key: number, layoutSetting: FixedLayoutSetting) {\n    if (!l) {\n      return;\n    }\n    const { appMode } = this.props;\n    const pos = this._getFixedPosOfLayoutItem(l.id);\n\n    return <InteractItem\n      key={key}\n      pos={pos}\n      layout={l}\n      appMode={appMode}\n      disableInteract={appMode !== AppMode.Design}\n      resizeGrid={[layoutSetting.gridSize, layoutSetting.gridSize]}\n      restrict={layoutSetting.restrict}\n      onResizeEnd={this._onItemResizeEnd}>\n    </InteractItem>;\n  }\n\n  render() {\n    const { layout, connectDropTarget, isOver, draggingItem } = this.props;\n    const layoutSetting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, layout.setting);\n    // const { width, height } = this.props;\n    // const pos = utils.calPixelPosition(layout.pos, width, height, layoutSetting);\n    const layouts = layout.content || [];\n    const sortedLayouts = fixedUtils.sortLayoutItems(layouts);\n    const isDropTaget = isOver === true && draggingItem && !draggingItem.restrict &&\n      (draggingItem.layout.layoutId !== layout.layoutId || draggingItem.layout.parentId !== layout.id);\n    const mergedClasses = classNames('fixed-layout', {\n      'drop-target': isDropTaget === true\n    });\n    return ( connectDropTarget &&\n      connectDropTarget(\n        <div ref={(el) => this.ref = el } className={mergedClasses}\n          data-layoutid={layout.layoutId}\n          data-layoutitemid={layout.id}>\n          {sortedLayouts.map((layoutItem, index) => {\n            return this._processLayoutItem(layoutItem, index, layoutSetting);\n          })}\n        </div>\n      )\n    )\n  }\n}\n\nconst spec = {\n  drop: (props: FixedLayoutProps, monitor: DropTargetMonitor, component: FixedLayoutPrototype) => {\n    if (!component || monitor.didDrop()) {\n      return;\n    }\n    const item = monitor.getItem() as {layout: Layout, width: number, height: number, restrict: boolean};\n    const actionContext = props.actionContext as LayoutActionContext;\n    // adjust the position of a layout item\n    if (item.layout.layoutId === props.layout.layoutId && item.layout.parentId === props.layout.id) {\n      const delta = monitor.getDifferenceFromInitialOffset();\n      const layoutSetting = assign({}, DEFAULT_FIX_LAYOUT_SETTING, props.layout.setting);\n      const { gridSize } = layoutSetting;\n      const pos = component._getFixedPosOfLayoutItem(item.layout.id);\n      const snapX = Math.round((pos.x + delta.x)/gridSize) * gridSize,\n        snapY = Math.round((pos.y + delta.y)/gridSize) * gridSize,\n        snapW = Math.round(pos.w/gridSize) * gridSize,\n        snapH = Math.round(pos.h/gridSize) * gridSize;\n\n      component._onItemResizeEnd(item.layout.id, snapX, snapY, snapW - pos.w, snapH - pos.h);\n    } else if (item.restrict !== true) {\n      // drag and drop a layout item from other layout\n      const clientOffset = monitor.getSourceClientOffset();\n      const { width, height } = item;\n      actionContext.dndLayout({\n        layoutItemId: item.layout.id,\n        layoutId: item.layout.layoutId\n      }, {\n        layoutItemId: props.layout.id,\n        layoutId: props.layout.layoutId\n      }, {\n        x: clientOffset.x - component.clientRect.left,\n        y: clientOffset.y - component.clientRect.top,\n        w: width,\n        h: height\n      });\n    }\n  }\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => {\n  return {\n    connectDropTarget: connect.dropTarget(),\n    isOver: monitor.isOver({shallow: true}),\n    draggingItem: monitor.getItem()\n  }\n}\n\nexport const FixedLayout = DropTarget([DND_TYPES.LAYOUT], spec, collect)(FixedLayoutPrototype);","exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".grid-layout {\\n  width: 100%;\\n  height: 100%; }\\n\\n.layout-grid-item {\\n  box-sizing: border-box;\\n  transition: all 200ms ease; }\\n  .layout-grid-item__content {\\n    width: 100%;\\n    height: 100%;\\n    overflow: auto; }\\n  .layout-grid-item:not(.react-grid-placeholder) {\\n    background: #ccc;\\n    border: 1px solid black; }\\n  .layout-grid-item.cssTransforms {\\n    transition-property: transform; }\\n  .layout-grid-item .text {\\n    font-size: 16px;\\n    text-align: center;\\n    position: absolute;\\n    top: 0;\\n    bottom: 0;\\n    left: 0;\\n    right: 0;\\n    margin: auto;\\n    height: 24px; }\\n  .layout-grid-item .remove {\\n    position: absolute;\\n    right: 2px;\\n    top: 0px;\\n    cursor: pointer; }\\n  .layout-grid-item.grid-item-placeholder {\\n    background: red;\\n    opacity: 0.2;\\n    transition-duration: 100ms;\\n    z-index: 2;\\n    -webkit-user-select: none;\\n    -moz-user-select: none;\\n    -ms-user-select: none;\\n    -o-user-select: none;\\n    user-select: none; }\\n  .layout-grid-item.layout-grid-item--resizing {\\n    z-index: 1;\\n    will-change: width, height; }\\n  .layout-grid-item.layout-grid-item--dragging {\\n    transition: none;\\n    z-index: 3;\\n    will-change: transform; }\\n  .layout-grid-item.layout-grid-item--draggable {\\n    cursor: move; }\\n\\n/*\\n.grid-item-placeholder {\\n  background: red;\\n  opacity: 0.2;\\n  transition-duration: 100ms;\\n  z-index: 2;\\n  -webkit-user-select: none;\\n  -moz-user-select: none;\\n  -ms-user-select: none;\\n  -o-user-select: none;\\n  user-select: none;\\n}\\n*/\\n\", \"\"]);\n\n// exports\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".layout-item {\\n  background: #FFFFFF;\\n  box-sizing: border-box; }\\n  .layout-item__content {\\n    width: 100%;\\n    height: 100%; }\\n  .layout-item.has-focus {\\n    outline: 2px solid #0189F3; }\\n  .layout-item.active {\\n    outline: 2px solid #0189F3; }\\n\\n.drop-target {\\n  background: #D9F0FF;\\n  outline: 1px solid #55BCFF;\\n  box-shadow: inset 0 0 8px 0 rgba(0, 0, 0, 0.15); }\\n\\n.section-layout {\\n  outline: 1px solid #E5E5E5; }\\n\", \"\"]);\n\n// exports\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./layout-item.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./layout-item.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./layout-item.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTZweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTYgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUwLjIgKDU1MDQ3KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5zZXR0aW5nczwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJidWlsZGVyIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZGVzaWduLW1vZGVfc2VjdGlvbl9lZGl0IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtOTg2LjAwMDAwMCwgLTQ5NC4wMDAwMDApIiBmaWxsPSIjRkZGRkZGIj4KICAgICAgICAgICAgPGcgaWQ9InNldGluZ19pY29uLWdyb3VwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg5NDUuMDAwMDAwLCA0ODcuMDAwMDAwKSI+CiAgICAgICAgICAgICAgICA8ZyBpZD0ic2V0dGluZ3MiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQxLjAwMDAwMCwgNy4wMDAwMDApIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMuMjU3MTQyOSw4LjM4MDk1MjM4IEMxMy4yNTcxNDI5LDguMTUyMzgwOTUgMTMuMzMzMzMzMyw3LjkyMzgwOTUyIDEzLjMzMzMzMzMsNy42MTkwNDc2MiBDMTMuMzMzMzMzMyw3LjMxNDI4NTcxIDEzLjMzMzMzMzMsNy4wODU3MTQyOSAxMy4yNTcxNDI5LDYuODU3MTQyODYgTDE0Ljg1NzE0MjksNS41NjE5MDQ3NiBDMTUuMDA5NTIzOCw1LjQwOTUyMzgxIDE1LjAwOTUyMzgsNS4yNTcxNDI4NiAxNC45MzMzMzMzLDUuMTA0NzYxOSBMMTMuNDA5NTIzOCwyLjQzODA5NTI0IEMxMy4zMzMzMzMzLDIuMzYxOTA0NzYgMTMuMTgwOTUyNCwyLjI4NTcxNDI5IDEyLjk1MjM4MSwyLjM2MTkwNDc2IEwxMS4wNDc2MTksMy4xMjM4MDk1MiBDMTAuNjY2NjY2NywyLjgxOTA0NzYyIDEwLjIwOTUyMzgsMi41OTA0NzYxOSA5Ljc1MjM4MDk1LDIuMzYxOTA0NzYgTDkuNDQ3NjE5MDUsMC4zODA5NTIzODEgQzkuNTIzODA5NTIsMC4xNTIzODA5NTIgOS4yOTUyMzgxLDAgOS4xNDI4NTcxNCwwIEw2LjA5NTIzODEsMCBDNS45NDI4NTcxNCwwIDUuNzE0Mjg1NzEsMC4xNTIzODA5NTIgNS43MTQyODU3MSwwLjMwNDc2MTkwNSBMNS40MDk1MjM4MSwyLjM2MTkwNDc2IEM0Ljk1MjM4MDk1LDIuNTE0Mjg1NzEgNC41NzE0Mjg1NywyLjgxOTA0NzYyIDQuMTE0Mjg1NzEsMy4xMjM4MDk1MiBMMi4yODU3MTQyOSwyLjM2MTkwNDc2IEMyLjA1NzE0Mjg2LDIuMjg1NzE0MjkgMS45MDQ3NjE5LDIuMzYxOTA0NzYgMS43NTIzODA5NSwyLjUxNDI4NTcxIEwwLjIyODU3MTQyOSw1LjE4MDk1MjM4IEMwLjE1MjM4MDk1Miw1LjI1NzE0Mjg2IDAuMjI4NTcxNDI5LDUuNDg1NzE0MjkgMC4zODA5NTIzODEsNS42MzgwOTUyNCBMMS45ODA5NTIzOCw2Ljg1NzE0Mjg2IEMxLjk4MDk1MjM4LDcuMDg1NzE0MjkgMS45MDQ3NjE5LDcuMzE0Mjg1NzEgMS45MDQ3NjE5LDcuNjE5MDQ3NjIgQzEuOTA0NzYxOSw3LjkyMzgwOTUyIDEuOTA0NzYxOSw4LjE1MjM4MDk1IDEuOTgwOTUyMzgsOC4zODA5NTIzOCBMMC4zODA5NTIzODEsOS42NzYxOTA0OCBDMC4yMjg1NzE0MjksOS44Mjg1NzE0MyAwLjIyODU3MTQyOSw5Ljk4MDk1MjM4IDAuMzA0NzYxOTA1LDEwLjEzMzMzMzMgTDEuODI4NTcxNDMsMTIuOCBDMS45MDQ3NjE5LDEyLjg3NjE5MDUgMi4wNTcxNDI4NiwxMi45NTIzODEgMi4yODU3MTQyOSwxMi44NzYxOTA1IEw0LjE5MDQ3NjE5LDEyLjExNDI4NTcgQzQuNTcxNDI4NTcsMTIuNDE5MDQ3NiA1LjAyODU3MTQzLDEyLjY0NzYxOSA1LjQ4NTcxNDI5LDEyLjg3NjE5MDUgTDUuNzkwNDc2MTksMTQuODU3MTQyOSBDNS43OTA0NzYxOSwxNS4wMDk1MjM4IDUuOTQyODU3MTQsMTUuMTYxOTA0OCA2LjE3MTQyODU3LDE1LjE2MTkwNDggTDkuMjE5MDQ3NjIsMTUuMTYxOTA0OCBDOS4zNzE0Mjg1NywxNS4xNjE5MDQ4IDkuNiwxNS4wMDk1MjM4IDkuNiwxNC44NTcxNDI5IEw5LjkwNDc2MTksMTIuODc2MTkwNSBDMTAuMzYxOTA0OCwxMi42NDc2MTkgMTAuODE5MDQ3NiwxMi40MTkwNDc2IDExLjIsMTIuMTE0Mjg1NyBMMTMuMTA0NzYxOSwxMi44NzYxOTA1IEMxMy4yNTcxNDI5LDEyLjk1MjM4MSAxMy40ODU3MTQzLDEyLjg3NjE5MDUgMTMuNTYxOTA0OCwxMi43MjM4MDk1IEwxNS4wODU3MTQzLDEwLjA1NzE0MjkgQzE1LjE2MTkwNDgsOS45MDQ3NjE5IDE1LjE2MTkwNDgsOS42NzYxOTA0OCAxNS4wMDk1MjM4LDkuNiBMMTMuMjU3MTQyOSw4LjM4MDk1MjM4IEwxMy4yNTcxNDI5LDguMzgwOTUyMzggWiBNNy42MTkwNDc2MiwxMC4yODU3MTQzIEM2LjE3MTQyODU3LDEwLjI4NTcxNDMgNC45NTIzODA5NSw5LjA2NjY2NjY3IDQuOTUyMzgwOTUsNy42MTkwNDc2MiBDNC45NTIzODA5NSw2LjE3MTQyODU3IDYuMTcxNDI4NTcsNC45NTIzODA5NSA3LjYxOTA0NzYyLDQuOTUyMzgwOTUgQzkuMDY2NjY2NjcsNC45NTIzODA5NSAxMC4yODU3MTQzLDYuMTcxNDI4NTcgMTAuMjg1NzE0Myw3LjYxOTA0NzYyIEMxMC4yODU3MTQzLDkuMDY2NjY2NjcgOS4wNjY2NjY2NywxMC4yODU3MTQzIDcuNjE5MDQ3NjIsMTAuMjg1NzE0MyBMNy42MTkwNDc2MiwxMC4yODU3MTQzIFoiIGlkPSJTaGFwZSI+PC9wYXRoPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=\"","module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTNweCIgaGVpZ2h0PSIxNnB4IiB2aWV3Qm94PSIwIDAgMTMgMTYiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUwLjIgKDU1MDQ3KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5kZWxldGU8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iYnVpbGRlciIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9ImRlc2lnbi1tb2RlX3NlY3Rpb25fZWRpdCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTk1NS4wMDAwMDAsIC00OTQuMDAwMDAwKSIgZmlsbD0iI0ZGRkZGRiI+CiAgICAgICAgICAgIDxnIGlkPSJzZXRpbmdfaWNvbi1ncm91cCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoOTQ1LjAwMDAwMCwgNDg3LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9ImRlbGV0ZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMDAwMDAwLCA3LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0wLjg4ODg4ODg4OSwxNC4yMjIyMjIyIEMwLjg4ODg4ODg4OSwxNS4yIDEuNjg4ODg4ODksMTYgMi42NjY2NjY2NywxNiBMOS43Nzc3Nzc3OCwxNiBDMTAuNzU1NTU1NiwxNiAxMS41NTU1NTU2LDE1LjIgMTEuNTU1NTU1NiwxNC4yMjIyMjIyIEwxMS41NTU1NTU2LDMuNTU1NTU1NTYgTDAuODg4ODg4ODg5LDMuNTU1NTU1NTYgTDAuODg4ODg4ODg5LDE0LjIyMjIyMjIgTDAuODg4ODg4ODg5LDE0LjIyMjIyMjIgWiBNMTIuNDQ0NDQ0NCwwLjg4ODg4ODg4OSBMOS4zMzMzMzMzMywwLjg4ODg4ODg4OSBMOC40NDQ0NDQ0NCwwIEw0LDAgTDMuMTExMTExMTEsMC44ODg4ODg4ODkgTDAsMC44ODg4ODg4ODkgTDAsMi42NjY2NjY2NyBMMTIuNDQ0NDQ0NCwyLjY2NjY2NjY3IEwxMi40NDQ0NDQ0LDAuODg4ODg4ODg5IEwxMi40NDQ0NDQ0LDAuODg4ODg4ODg5IFoiIGlkPSJTaGFwZSI+PC9wYXRoPgogICAgICAgICAgICAgICAgPC9nPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=\"","var escape = require(\"../../../../node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".layout-widget {\\n  width: 100%;\\n  height: 100%; }\\n  .layout-widget .settings {\\n    position: absolute;\\n    height: 32px;\\n    width: 60px;\\n    display: flex;\\n    justify-content: space-evenly;\\n    right: 0;\\n    top: -32px;\\n    background: #0189F3;\\n    border: 0; }\\n    .layout-widget .settings .settings-item {\\n      width: 32px;\\n      height: 32px;\\n      background-position: center;\\n      background-repeat: no-repeat;\\n      opacity: 0.8;\\n      cursor: pointer;\\n      opacity: 0.8; }\\n      .layout-widget .settings .settings-item:hover {\\n        opacity: 1; }\\n      .layout-widget .settings .settings-item + .settings-item {\\n        position: relative; }\\n        .layout-widget .settings .settings-item + .settings-item::before {\\n          content: ' ';\\n          display: block;\\n          position: absolute;\\n          border-left: 1px solid #fff;\\n          left: -1px;\\n          top: 4px;\\n          bottom: 4px;\\n          opacity: 0.2; }\\n    .layout-widget .settings .delete {\\n      background-image: url(\" + escape(require(\"./images/delete.svg\")) + \");\\n      background-size: 13px 16px; }\\n    .layout-widget .settings .config {\\n      background-image: url(\" + escape(require(\"./images/settings.svg\")) + \");\\n      background-size: 16px; }\\n  .layout-widget .highlight {\\n    position: absolute;\\n    left: 0;\\n    top: 0;\\n    width: 100%;\\n    height: 100%;\\n    background-color: rgba(232, 75, 75, 0.4); }\\n  .layout-widget.placeholder {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    outline: 1px solid #E5E5E5; }\\n    .layout-widget.placeholder .handler {\\n      cursor: pointer;\\n      font-size: 24px; }\\n\", \"\"]);\n\n// exports\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./widget.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./widget.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./widget.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","import * as React from 'react';\nimport { connect } from 'react-redux';\nimport WidgetManager from '../widget-manager';\nimport {IMState, IMRuntimeInfo } from '../types/state';\nimport {AppMode} from '../types/constants';\nimport {autoBindHandlers} from './utils';\nimport { ActionContext } from './action-context';\nimport {Layout} from './types';\nimport \"./style/widget.scss\";\nimport {publishCurrentEditWidgetChangeToBuilder, publishRemoveWidgetToBuilder, letBuilderPopupChooseWidget} from '../app-builder-sync';\n\ninterface State{\n  showSettings: boolean;\n}\ninterface OwnProps{\n  layout: Layout;\n  widgetId?: string;\n}\ninterface StateProps{\n  runtimeInfo: IMRuntimeInfo;\n  appMode: AppMode\n}\nclass WidgetRendererComponent extends React.PureComponent<OwnProps & StateProps, State>{\n  state: State = {\n    showSettings: false\n  };\n\n  constructor(props) {\n    super(props);\n    autoBindHandlers(this, ['showSetting', 'hideSetting']);\n  }\n\n  componentDidMount(){\n    if (this.props.widgetId) {\n      WidgetManager.getInstance().loadWidgetClass(this.props.widgetId);\n    }\n  }\n\n  componentDidUpdate(){\n    if (this.props.widgetId) {\n      (!this.props.runtimeInfo || !this.props.runtimeInfo.isClassLoaded) &&\n        WidgetManager.getInstance().loadWidgetClass(this.props.widgetId);\n    }\n  }\n\n  showSetting() {\n    const { appMode, widgetId } = this.props;\n    if (appMode === AppMode.Config && widgetId) {\n      this.setState({\n        showSettings: true\n      });\n    }\n  }\n\n  hideSetting() {\n    this.setState({\n      showSettings: false\n    });\n  }\n\n  render(){\n    const { appMode, layout } = this.props;\n    const { showSettings } = this.state;\n    if (this.props.widgetId) {\n      let WidgetClass = WidgetManager.getInstance().getWidgetClass(this.props.widgetId);\n\n      if (WidgetClass) {\n        return <ActionContext.Consumer>\n        {actions =>\n          <div className=\"layout-widget\"\n          data-widgetid={this.props.widgetId}\n          onMouseEnter={this.showSetting}\n          onMouseLeave={this.hideSetting}>\n            <WidgetClass></WidgetClass>\n            { appMode === AppMode.Design && <div className=\"widget-mask\" style={{\n              position: 'absolute',\n              left: 0,\n              top: 0,\n              width: '100%',\n              height: '100%'\n            }}></div> }\n            { appMode === AppMode.Config && showSettings && <div className=\"settings\">\n              <div onClick={() => {\n                actions.removeWidget(this.props.widgetId);\n                publishRemoveWidgetToBuilder(this.props.widgetId);\n              }} className=\"settings-item with-sep delete\"></div>\n              <div onClick={() => publishCurrentEditWidgetChangeToBuilder(this.props.widgetId)} className=\"settings-item config\"></div>\n            </div> }\n            { appMode === AppMode.Config && this.props.runtimeInfo.isHighlight && <div className=\"highlight\"> </div> }\n          </div>\n        }\n        </ActionContext.Consumer>\n      }\n      //return this.props.widgetId + ' is Loading...' ;\n      return <div className='jimu-small-loading'></div>\n    } else if (appMode !== AppMode.Run) {\n      return <ActionContext.Consumer>\n        {actions => <div className=\"layout-widget placeholder\" style={{width: '100%', height: '100%'}}>\n          <div className=\"handler\" onClick={() => letBuilderPopupChooseWidget(layout.layoutId, layout.id)}>+</div>\n          </div>\n        }\n      </ActionContext.Consumer>\n    }\n    return null;\n  }\n}\n\nconst mapStateToProps = (state: IMState, ownProps: OwnProps) => {\n  return {\n    runtimeInfo: state.widgetsRuntimeInfo[ownProps.widgetId],\n    appMode: state.appMode\n  }\n};\n\nexport default connect<StateProps, {}, OwnProps>(mapStateToProps)(WidgetRendererComponent);\n\n\n","exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"/*\\n.action-handler {\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  width: 100%;\\n  height: 100%;\\n  border: 1px solid $edit-box-default-color;\\n  */\\n.handle {\\n  position: absolute; }\\n  .handle.handle-resize-corner {\\n    width: 14px;\\n    height: 14px;\\n    background-color: #3899ec;\\n    border: 1px solid #fff;\\n    border-radius: 50%;\\n    z-index: 1; }\\n    .handle.handle-resize-corner.top.left {\\n      top: -8px;\\n      left: -8px; }\\n    .handle.handle-resize-corner.top.right {\\n      top: -8px;\\n      right: -8px; }\\n    .handle.handle-resize-corner.bottom.right {\\n      bottom: -8px;\\n      right: -8px; }\\n    .handle.handle-resize-corner.bottom.left {\\n      bottom: -8px;\\n      left: -8px; }\\n  .handle.handle-resize-side.top {\\n    height: 8px;\\n    left: 8px;\\n    right: 8px;\\n    top: -4px;\\n    box-shadow: none; }\\n    .handle.handle-resize-side.top:after {\\n      content: \\\"\\\";\\n      width: 14px;\\n      height: 14px;\\n      background-color: #3899ec;\\n      border: 1px solid #fff;\\n      border-radius: 50%;\\n      position: absolute;\\n      left: 50%;\\n      top: 50%;\\n      margin-left: -8px;\\n      margin-top: -8px; }\\n  .handle.handle-resize-side.right {\\n    width: 8px;\\n    top: 8px;\\n    bottom: 8px;\\n    right: -4px;\\n    box-shadow: none; }\\n    .handle.handle-resize-side.right:after {\\n      content: \\\"\\\";\\n      width: 14px;\\n      height: 14px;\\n      background-color: #3899ec;\\n      border: 1px solid #fff;\\n      border-radius: 50%;\\n      position: absolute;\\n      top: 50%;\\n      right: 50%;\\n      margin-top: -8px;\\n      margin-right: -8px; }\\n  .handle.handle-resize-side.bottom {\\n    height: 8px;\\n    left: 8px;\\n    right: 8px;\\n    bottom: -4px;\\n    box-shadow: none; }\\n    .handle.handle-resize-side.bottom:after {\\n      content: \\\"\\\";\\n      width: 14px;\\n      height: 14px;\\n      background-color: #3899ec;\\n      border: 1px solid #fff;\\n      border-radius: 50%;\\n      position: absolute;\\n      left: 50%;\\n      bottom: 50%;\\n      margin-left: -8px;\\n      margin-bottom: -8px; }\\n  .handle.handle-resize-side.left {\\n    width: 8px;\\n    top: 8px;\\n    bottom: 8px;\\n    left: -4px;\\n    box-shadow: none; }\\n    .handle.handle-resize-side.left:after {\\n      content: \\\"\\\";\\n      width: 14px;\\n      height: 14px;\\n      background-color: #3899ec;\\n      border: 1px solid #fff;\\n      border-radius: 50%;\\n      position: absolute;\\n      top: 50%;\\n      left: 50%;\\n      margin-top: -8px;\\n      margin-left: -8px; }\\n\\n.widget-mask {\\n  cursor: move; }\\n\\n/* }*/\\n\", \"\"]);\n\n// exports\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./handle.scss\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n// Hot Module Replacement\nif(module.hot) {\n\t// When the styles change, update the <style> tags\n\tif(!content.locals) {\n\t\tmodule.hot.accept(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./handle.scss\", function() {\n\t\t\tvar newContent = require(\"!!../../../../node_modules/css-loader/index.js??ref--6-1!../../../../node_modules/sass-loader/lib/loader.js??ref--6-2!../../../../node_modules/postcss-loader/lib/index.js??ref--6-3!./handle.scss\");\n\t\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\t\t\tupdate(newContent);\n\t\t});\n\t}\n\t// When the module is disposed, remove the <style> tags\n\tmodule.hot.dispose(function() { update(); });\n}","import * as React from 'react';\nimport assign = require('lodash.assign');\nimport * as Immutable from 'seamless-immutable';\nimport classNames = require(\"classnames\");\nimport { DropTarget, ConnectDropTarget, DropTargetMonitor, DropTargetConnector } from 'react-dnd';\nimport draggable from '../react-dnd-draggable';\nimport resizable from '../react-dnd-resizable';\nimport { DND_TYPES } from '../react-dnd-types';\nimport { DEFAULT_GRID_LAYOUT_SETTING } from './default-setting';\nimport * as gridUtils from \"./grid-utils\";\nimport * as utils from \"../utils\";\nimport { Position } from '../types';\nimport { LayoutItem } from '../layout-item';\nimport './style/grid.scss';\n\n// Types\nimport {\n  Layout,\n  GridLayoutSetting,\n  LayoutActionContext\n} from '../types';\nimport { AppMode } from '../../types/constants';\n\ninterface State {\n  // activeDrag?: Layout;\n  width: number;\n  numOfCols: number;\n  colWidth: number;\n  breakpoint: string;\n  pixelLayouts: {[key: string]: Position};\n  gridLayouts: {[key: string]: Position};\n  layout: Layout;\n  setting: GridLayoutSetting;\n};\n\ninterface GridLayoutProps {\n  width: number;\n  layout?: Layout;\n  appMode: AppMode;\n  actionContext?: LayoutActionContext;\n  className?: string,\n  style?: Object,\n  autoSize?: boolean\n};\n\nexport interface DropProps {\n  connectDropTarget?: ConnectDropTarget,\n  isOver?: boolean,\n  draggingItem?: {layout: Layout}\n}\n\nconst InteractItem = resizable()(draggable(null)(LayoutItem));\n\n/**\n * A reactive, fluid grid layout with draggable, resizable components.\n */\nclass GridLayoutPrototype extends React.Component<GridLayoutProps & DropProps, State> {\n  static displayName = \"GridLayout\";\n\n  static defaultProps: Partial<GridLayoutProps> = {\n    autoSize: true,\n    className: \"\",\n    style: {},\n    layout: null,\n    actionContext: {\n      updateSetting: utils.emptyFunc,\n      addLayout: utils.emptyFunc,\n      removeLayout: utils.emptyFunc,\n      resizeLayouts: utils.emptyFunc,\n      dndLayout: utils.emptyFunc,\n      activate: utils.emptyFunc,\n      removeWidget: utils.emptyFunc\n    }\n  };\n\n  state: State = {\n    // activeDrag: null,\n    breakpoint: '',\n    width: 0,\n    numOfCols: -1,\n    colWidth: 0,\n    pixelLayouts: {},\n    gridLayouts: {},\n    setting: DEFAULT_GRID_LAYOUT_SETTING,\n    layout: null\n  };\n\n  ref;\n  clientRect: ClientRect;\n\n  constructor(props: GridLayoutProps, context: any) {\n    super(props, context);\n    utils.autoBindHandlers(this, [\n      '_onItemResize'\n    ]);\n  }\n\n  componentDidMount() {\n    const domNode = this.ref as HTMLElement;\n    this.clientRect = domNode.getBoundingClientRect();\n  }\n\n  componentDidUpdate() {\n    const domNode = this.ref as HTMLElement;\n    this.clientRect = domNode.getBoundingClientRect();\n  }\n\n  static getDerivedStateFromProps(nextProps: GridLayoutProps, prevState: State) {\n    if (nextProps.layout !== prevState.layout) {\n      const layoutSetting = assign({}, DEFAULT_GRID_LAYOUT_SETTING, nextProps.layout.setting);\n      const { space, padding } = layoutSetting;\n      const breakpoint = gridUtils.getBreakpointFromWidth(layoutSetting.breakpoints, nextProps.width);\n      const colNo = gridUtils.getColsFromBreakpoint(breakpoint, layoutSetting.cols);\n      const colWidth = (nextProps.width - space * (colNo - 1) - padding[0] * 2) / colNo;\n      const breakpointLayouts = gridUtils.collectLayoutsAtBreakpoint(nextProps.layout.content, breakpoint, layoutSetting);\n      const layouts = gridUtils.generateResponsiveLayout(\n        breakpointLayouts,\n        colNo,\n        layoutSetting.compactType\n      );\n      const pixelLayouts = {}, gridLayouts = {};\n      layouts.forEach(layoutItem => {\n        gridLayouts[layoutItem.id] = Immutable(layoutItem.pos);\n        pixelLayouts[layoutItem.id] = Immutable(gridUtils.toPixelPosition(layoutItem.pos, layoutSetting, colWidth));\n      });\n\n      return {\n        breakpoint: breakpoint,\n        pixelLayouts: pixelLayouts,\n        gridLayouts: gridLayouts,\n        width: nextProps.width,\n        numOfCols: colNo,\n        colWidth: colWidth,\n        setting: layoutSetting,\n        layout: nextProps.layout\n      };\n    }\n    return null;\n  }\n\n  _onItemResize(id: string, x: number, y: number, dw: number, dh: number) {\n    const { numOfCols, gridLayouts, pixelLayouts, setting, colWidth, breakpoint } = this.state;\n    const l = gridLayouts[id];\n    const pixelLayout = pixelLayouts[id];\n\n    const resizingPos = {\n      x: x,\n      y: y,\n      w: pixelLayout.w + dw,\n      h: pixelLayout.h + dh\n    };\n    const moveToPosition = gridUtils.toGridPosition(resizingPos, setting, numOfCols, colWidth);\n\n    const layouts = Object.keys(gridLayouts).map(key => {\n      if (key !== id) {\n        return {\n          id: key,\n          pos: gridLayouts[key]\n        };\n      } else {\n        return {\n          id: key,\n          pos: moveToPosition\n        };\n      }\n    });\n\n    const isUserAction = true;\n    let newLayout = gridUtils.moveElement(\n      layouts,\n      id,\n      setting.compactType,\n      numOfCols,\n      moveToPosition.x,\n      moveToPosition.y,\n      isUserAction,\n      false,\n    );\n\n    // Re-compact the layout and set the drag placeholder.\n    newLayout = gridUtils.compact(newLayout, setting.compactType, numOfCols);\n    const newPixelLayouts = {}, newGridLayouts = {};\n\n    newLayout.forEach(layoutItem => {\n      const dPos = layoutItem.id === id ? resizingPos : null;\n      newGridLayouts[layoutItem.id] = Immutable(layoutItem.pos);\n      newPixelLayouts[layoutItem.id] = Immutable(gridUtils.toPixelPosition(layoutItem.pos, setting, colWidth, dPos, dPos))\n    });\n\n    const { actionContext } = this.props;\n\n    const newLayouts = Object.keys(newGridLayouts).map(key => {\n      return {\n        id: key,\n        layoutId: this.props.layout.layoutId,\n        pos: newGridLayouts[key]\n      };\n    });\n\n    actionContext.resizeLayouts(newLayouts, breakpoint);\n  }\n\n  /**\n   * Given a grid item, set its style attributes & surround in a <Draggable>.\n   */\n  processGridItem(l: Layout, key: number) {\n    const { pixelLayouts } = this.state;\n    const { appMode } = this.props;\n    const imPos = pixelLayouts[l.id];\n    const pos = {\n      x: imPos.x,\n      y: imPos.y,\n      w: imPos.w,\n      h: imPos.h\n    };\n\n    return <InteractItem\n      key={key}\n      pos={pos}\n      layout={l}\n      appMode={appMode}\n      disableInteract={appMode !== AppMode.Design}\n      onResizeEnd={this._onItemResize}>\n    </InteractItem>;\n  }\n\n  render() {\n    const { className, style, layout, connectDropTarget, isOver, draggingItem } = this.props;\n    const layouts = layout.content || [];\n    const isDropTaget = isOver === true && draggingItem &&\n      (draggingItem.layout.layoutId !== layout.layoutId || draggingItem.layout.parentId !== layout.id);\n    const mergedClassName = classNames(\"grid-layout\", className, {\n      'drop-target': isDropTaget === true\n    });\n\n    return ( connectDropTarget &&\n      connectDropTarget(\n        <div ref={(el) => this.ref = el } className={mergedClassName} style={style}\n          data-layoutitemid={layout.id}\n          data-layoutid={layout.layoutId}>\n          {layouts.map((layoutItem, index) => {\n            return this.processGridItem(layoutItem, index);\n          })}\n        </div>\n      )\n    );\n  }\n}\n\nconst spec = {\n  drop: (props: GridLayoutProps, monitor: DropTargetMonitor, component: GridLayoutPrototype) => {\n    if (!component || monitor.didDrop()) {\n      return;\n    }\n    const item = monitor.getItem() as {layout: Layout, width: number, height: number, restrict: boolean};\n    const actionContext = props.actionContext as LayoutActionContext;\n    // adjust the position of a layout item\n    if (item.layout.layoutId === props.layout.layoutId && item.layout.parentId === props.layout.id) {\n      const delta = monitor.getDifferenceFromInitialOffset();\n      const { pixelLayouts } = component.state;\n      const pixelLayout = pixelLayouts[item.layout.id];\n      component._onItemResize(item.layout.id, pixelLayout.x + delta.x, pixelLayout.y + delta.y, 0, 0);\n    } else if (item.restrict !== true) {\n      // drag and drop a layout item from other layout\n      const { width, height } = item;\n      const clientOffset = monitor.getSourceClientOffset();\n      const { colWidth, setting } = component.state;\n      actionContext.dndLayout({\n        layoutItemId: item.layout.id,\n        layoutId: item.layout.layoutId\n      }, {\n        layoutItemId: props.layout.id,\n        layoutId: props.layout.layoutId\n      }, {\n        x: Math.round((clientOffset.x - component.clientRect.left) / colWidth),\n        y: Math.round((clientOffset.y - component.clientRect.top) / setting.rowHeight),\n        w: Math.round(width / colWidth),\n        h: Math.round(height / setting.rowHeight)\n      });\n    }\n  }\n}\n\nconst collect = (connect: DropTargetConnector, monitor: DropTargetMonitor) => {\n  return {\n    connectDropTarget: connect.dropTarget(),\n    isOver: monitor.isOver({shallow: true}),\n    draggingItem: monitor.getItem()\n  }\n}\n\nexport const GridLayout = DropTarget([DND_TYPES.LAYOUT], spec, collect)(GridLayoutPrototype);","\nimport * as React from 'react';\nimport assign = require(\"lodash.assign\");\nimport { DragDropContext } from 'react-dnd';\nimport HTML5Backend from 'react-dnd-html5-backend';\n// import debounce = require(\"lodash.debounce\");\nimport { DEFAULT_LAYOUT_SETTING } from './default-common-setting';\nimport * as ReactRedux from 'react-redux';\nimport {AllLayoutProps, LayoutProps, LayoutStateProps } from '../types/props';\nimport { IMState} from '../types/state';\nimport resizable from './react-dnd-resizable';\nimport { Layout, LayoutType, Position, LayoutActionContext, LayoutMap, CommonLayoutSetting, LayoutInfo } from './types';\nimport * as utils from './utils';\nimport { GridLayout } from './grid-layout/layout';\nimport { FixedLayout } from './fixed-layout/layout';\nimport { SidebarLayout } from './sidebar-layout/layout';\nimport SectionLayout from './section-layout/layout';\nimport { registerLayout } from './layout-factory';\nimport { LayoutItem } from './layout-item';\nimport { ActionContext } from './action-context';\nimport LayoutReduxStoreExtension from './global-layout-redux-store-extension';\nimport GlobalLayoutReduxStoreExtension from './global-layout-redux-store-extension';\nimport ExtensionManager from '../extension-manager';\nimport {ExtensionPoints} from '../extension-spec/extension-spec';\n\nimport {\n  addLayout,\n  removeLayout,\n  resizeLayouts,\n  activate,\n  updateSetting,\n  removeWidget,\n  dndLayout,\n  removeSection\n} from './actions/global-layout-actions';\nimport { AppMode } from '../types/constants';\n\nregisterLayout(LayoutType.FIXED_LAYOUT, FixedLayout);\nregisterLayout(LayoutType.GRID_LAYOUT, GridLayout);\nregisterLayout(LayoutType.SIDEBAR_LAYOUT, SidebarLayout);\nregisterLayout(LayoutType.SECTION_LAYOUT, SectionLayout);\n\n// interface State {\n//   width?: number;\n//   height?: number;\n//   layout?: Layout;\n//   layoutPos?: Position;\n// }\n\n// const ResizableLayoutItem = resizable()(LayoutItem);\n\nclass JimuLayout extends React.PureComponent<AllLayoutProps & {width: number, height: number, appMode: AppMode}>{\n  // nodeRef;\n  // mounted: boolean;\n  // _debouncedResize;\n  // state: State = {\n  //   layout: null\n  // }\n\n  layoutActions: LayoutActionContext;\n\n  // static getDerivedStateFromProps(nextProps: AllLayoutProps & {width: number, height: number}, prevState: State) {\n  //   if (nextProps.layout !== prevState.layout) {\n  //     const {layout, width, height} = nextProps;\n  //     const setting = assign({}, DEFAULT_LAYOUT_SETTING, layout.setting);\n  //     const layoutPos = utils.calPixelPosition(layout.pos, width, height, setting);\n  //     return {\n  //       layout: nextProps.layout,\n  //       width: nextProps.width,\n  //       height: nextProps.height,\n  //       layoutPos: layoutPos\n  //     };\n  //   }\n  //   return null;\n  // }\n\n  constructor(props){\n    super(props);\n    // this.nodeRef = React.createRef();\n    // this.mounted = false;\n    ExtensionManager.getInstance().registerExtension({\n      epName: ExtensionPoints.ReduxStore,\n      extension: new LayoutReduxStoreExtension()\n    });\n    ExtensionManager.getInstance().registerExtension({\n      epName: ExtensionPoints.ReduxStore,\n      extension: new GlobalLayoutReduxStoreExtension()\n    });\n\n    this.layoutActions = {\n      updateSetting: (info, newSetting) => {\n        this.props.dispatch(updateSetting(info, newSetting));\n      },\n      addLayout: (layoutId, parentId, layout) => {\n        this.props.dispatch(addLayout(layoutId, parentId, layout));\n      },\n      removeLayout: (info) => {\n        this.props.dispatch(removeLayout(info));\n      },\n      resizeLayouts: (layouts, breakpoint) => {\n        this.props.dispatch(resizeLayouts(layouts, breakpoint));\n      },\n      activate: (info) => {\n        this.props.dispatch(activate(info));\n      },\n      dndLayout: (layoutInfo, parentId, newPosition) => {\n        this.props.dispatch(dndLayout(layoutInfo, parentId, newPosition));\n      },\n      removeWidget: (widgetId) => {\n        this.props.dispatch(removeWidget(widgetId));\n      },\n      removeSection: (sectionId) => {\n        this.props.dispatch(removeSection(sectionId));\n      }\n    };\n  }\n\n  // _onItemResize(id: string, x: number, y: number, dw: number, dh: number) {\n  //   if (!this._isInDesignMode()) {\n  //     return;\n  //   }\n  //   const {width, height} = this.state;\n  //   this.setState({\n  //     width: width + dw,\n  //     height: height + dh\n  //   });\n  // }\n\n  // _onItemResizeEnd(id: string, x: number, y: number, dw: number, dh: number) {\n  //   if (!this._isInDesignMode()) {\n  //     return;\n  //   }\n  //   const { pos } = this.props.layout;\n  //   const {width, height} = this.state;\n  //   const setting = assign({}, DEFAULT_LAYOUT_SETTING, this.props.layout.setting);\n  //   const layoutPos = utils.calPixelPosition(pos, width, height, setting);\n\n  //   layoutPos.w += dw;\n  //   layoutPos.h += dh;\n\n  //   const newPos = utils.calLayoutPosition(layoutPos, width, height, setting);\n  //   this.props.dispatch(resizeLayouts([{\n  //     id: id,\n  //     layoutId: this.props.layout.layoutId,\n  //     pos: newPos\n  //   }]));\n  // }\n\n  _isInDesignMode() {\n    const { appMode } = this.props;\n    return appMode === AppMode.Design;\n  }\n\n  render(){\n    const {width, height, layout, appMode} = this.props;\n    if (!layout) {\n      return null;\n    }\n\n    const setting = assign({}, DEFAULT_LAYOUT_SETTING, layout.setting);\n    const layoutPos = utils.calPixelPosition(layout.pos, width, height, setting);\n    const style = {\n      width: '100%',\n      height: '100%'\n    };\n\n    return (\n      <ActionContext.Provider value={this.layoutActions}>\n        <div className=\"layout\" style={style}>\n          <LayoutItem\n            layout={layout}\n            pos={layoutPos}\n            appMode={appMode}\n            style={{\n              position: 'relative',\n              margin: '0 auto'\n            }}>\n          </LayoutItem>\n        </div>\n      </ActionContext.Provider>\n    );\n  }\n}\n\nconst mapStateToProps = (state: IMState) => {\n  return {\n    appConfig: state.appConfig,\n    appMode: state.appMode\n  }\n};\n\n//connect<IMapStateToProps, IMapDispatchToProps, ICompProps, IReduxState>(mapStateToProps, mapDispatchToProps)\nconst connectedLayoutEntry = ReactRedux.connect<LayoutStateProps, {}, LayoutProps & {width: number, height: number}>(\n  mapStateToProps)(JimuLayout);\n\nexport default DragDropContext(HTML5Backend)(connectedLayoutEntry);","// TODO: remove unused imports\n// import * as React from 'react';\n// import { connect } from 'react-redux';\n// import {ImmutableObject, ImmutableArray} from 'seamless-immutable';\nimport * as SeamlessImmutable from 'seamless-immutable';\nimport {store} from './store';\nimport {AppConfig, IMAppConfig, IMWidgetJson, IMWidgetContext} from './types/app-config';\n// import {IMState} from './types/state';\nimport {getWidgetContext, getAllWidgets, addWidgetDefaultLabelAndIcon} from './utils/app-config';\nimport WidgetManager from './widget-manager';\nimport MessageManager from './message-manager';\nimport ExtensionManager from './extension-manager';\nimport SessionManager from './session-manager';\nimport {AppConfigProcessorExtension, ExtensionPoints, AppConfigServiceExtension} from './extension-spec/extension-spec';\n\nimport { getItemData } from '@esri/arcgis-rest-items';\nimport { AppMode } from './types/constants';\n\nexport default class ConfigManager{\n  \n  static instance: ConfigManager;\n\n  static getInstance(){\n    if(!ConfigManager.instance){\n      ConfigManager.instance = new ConfigManager();\n    }\n    return ConfigManager.instance;\n  }\n\n  loadAppConfig(): Promise<IMAppConfig>{\n    return this.loadRawAppConfig().then(appConfig => {\n      this.processAppConfigAfterLoad(appConfig);\n      return this.loadAllWidgetsManifest(appConfig);\n    }).then(appConfig => {\n      this.addDefaultLabelAndIcon(appConfig);\n      return this.loadAndUpgradeAllWidgetsConfig(appConfig);\n    }).then(appConfig => {\n      return this.registerAllWidgetExtensions(appConfig);\n    }).then(appConfig => {\n      return this.applyAppConfigProcessorExtension(appConfig);\n    }).then(appConfig => {\n      return this.createAllWidgetMessageActions(appConfig);\n    }).then(appConfig => {\n      this.setDocumentTitle(appConfig.attributes.title);\n      return SeamlessImmutable(appConfig);\n    });\n  }\n\n  private setDocumentTitle(title: string) {\n    if(!title){\n      return;\n    }\n    if(!store.getState().appContext.isBuilder && (store.getState().appMode === AppMode.Preview || store.getState().appMode === AppMode.Run)) {\n      //TODO sanitize\n      document.title = title;\n    }\n  }\n\n  registerAllWidgetExtensions(appConfig: AppConfig): Promise<AppConfig> {\n    return ExtensionManager.getInstance().registerAllWidgetExtensions(appConfig).then(() => {\n      return appConfig;\n    });\n  }\n\n  createAllWidgetMessageActions(appConfig: AppConfig): Promise<AppConfig> {\n    return MessageManager.getInstance().createMessageActions(appConfig as IMAppConfig).then(() => {\n      return appConfig;\n    });\n  }\n\n  loadRawAppConfig(): Promise<AppConfig>{\n    let extension = ExtensionManager.getInstance().getExtensions(ExtensionPoints.AppConfigService)[0];\n    if(!extension){\n      return this.loadAppConfigWithDefault();\n    }\n\n    return (extension as AppConfigServiceExtension).loadAppConfig();\n  }\n\n  /**\n   * By default, app support these URL parameters that related to load app config:\n   *  ?config=<url>: relative or absolute URL\n   *  ?id=<app id>: the item id.\n   *    * How to get portal URL?\n   *      TODO\n   */\n  loadAppConfigWithDefault(): Promise<AppConfig>{\n    if(!store.getState().appContext.isBuilder){\n      if(store.getState().queryObject.id){\n        return this.loadAppConfigFromPortal(store.getState().queryObject.id);\n      }\n    }\n    let configUrl = store.getState().queryObject.config;\n    if(!configUrl){\n      configUrl = 'config.json';\n    }\n    return fetch(configUrl).then(res => {\n      return res.json();\n    }).then(appConfig => {\n      return appConfig;\n    });\n  }\n\n  loadAppConfigFromPortal(appId: string): Promise<AppConfig>{\n    const sessionManager = SessionManager.getInstance();\n\n    // init session from the cookie if any\n    sessionManager.initFromLocalStorage();\n\n    // fetch the item's data\n    return getItemData(appId, {\n      authentication: sessionManager.getSession()\n    })\n    // retry if request was unauthenticated and the item is not shared with everyone\n    .catch(sessionManager.handleAuthError.bind(sessionManager));\n  }\n\n  applyAppConfigProcessorExtension(appConfig: AppConfig): Promise<AppConfig>{\n    let extension = ExtensionManager.getInstance().getExtensions(ExtensionPoints.AppConfigProcessor)[0];\n    if(!extension){\n      return Promise.resolve(appConfig);\n    }\n\n    return (extension as AppConfigProcessorExtension).process(appConfig);\n  }\n\n  loadAllWidgetsManifest(appConfig: AppConfig): Promise<AppConfig>{\n    let promises = [];\n    getAllWidgets(appConfig as IMAppConfig).forEach((w: IMWidgetJson, info) => {\n      if(!w.uri){\n        return;\n      }\n      promises.push(WidgetManager.getInstance().loadWidgetManifest(w).then(manifest => {\n        w.manifest = manifest;\n        return w;\n      }));\n    });\n\n    return Promise.all(promises).then(manifests => {\n      return appConfig;\n    });\n  }\n\n  loadAndUpgradeAllWidgetsConfig(appConfig: AppConfig): Promise<AppConfig>{\n    let promises = [];\n    getAllWidgets(appConfig as IMAppConfig).forEach((w: IMWidgetJson, info) => {\n      if(!w.uri){\n        return;\n      }\n      promises.push(WidgetManager.getInstance().loadWidgetConfig(w));\n    });\n\n    return Promise.all(promises).then(manifests => {\n      return appConfig;\n    })\n  }\n\n  processAppConfigAfterLoad(appConfig: AppConfig){\n    this.addWidgetContext(appConfig);\n    this.addDefaultValues(appConfig);\n  }\n\n  addWidgetContext(appConfig: AppConfig){\n    getAllWidgets(appConfig as IMAppConfig).forEach(w => {\n      let uriInfo = getWidgetContext(w.uri);\n      w.context = uriInfo as IMWidgetContext;\n    });\n  }\n\n  addDefaultValues(appConfig: AppConfig) {\n    // this.addDefaultPortalUrl(appConfig);\n    // this.addDefaultGeometryService(appConfig);\n    // this.addDefaultStyle(appConfig);\n    // this.addDefaultMap(appConfig);\n    // this.addDefaultDataSource(appConfig);\n    // this.addDefaultSharedTheme(appConfig);\n    if(!appConfig.attributes){\n      appConfig.attributes = {} as any;\n    }\n\n    //TODO for demo\n    if(!appConfig.sharedArea){\n      appConfig.sharedArea = {\n        header: {},\n        footer: {},\n        leftArea: {},\n        rightArea: {},\n        layout: '__app_layout'\n      } as any;\n    }\n\n    let defaultAppLayout = {\n      '__app_layout': {\n        \"0\": {\n          \"id\": \"0\",\n          \"pos\": {\n            \"x\": 0,\n            \"y\": 0,\n            \"w\": 100,\n            \"h\": 100\n          },\n          \"type\": \"sidebar\",\n          \"setting\": {\n            \"widthInPixel\": false,\n            \"alignCenter\": true,\n            \"heightInPixel\": false\n          }\n        },\n        \"1\": {\n          \"id\": \"1\",\n          \"parentId\": \"0\",\n          \"pos\": {\n            \"x\": 0,\n            \"y\": 0,\n            \"h\": 50\n          },\n          \"type\": \"fixed\",\n          \"setting\": {\n            \"attach\": \"top\",\n            \"togglable\": false\n          }\n        },\n        \"2\": {\n          \"id\": \"2\",\n          \"parentId\": \"0\",\n          \"pos\": {\n            \"x\": 0,\n            \"y\": 0,\n            \"h\": 50\n          },\n          \"type\": \"fixed\",\n          \"setting\": {\n            \"attach\": \"bottom\",\n            \"togglable\": false\n          }\n        },\n        \"3\": {\n          \"id\": \"3\",\n          \"parentId\": \"0\",\n          \"pos\": {\n            \"x\": 0,\n            \"y\": 0,\n            \"w\": 50\n          },\n          \"type\": \"fixed\",\n          \"setting\": {\n            \"attach\": \"left\",\n            \"togglable\": false\n          }\n        },\n        \"4\": {\n          \"id\": \"4\",\n          \"parentId\": \"0\",\n          \"pos\": {\n            \"x\": 0,\n            \"y\": 0,\n            \"w\": 50\n          },\n          \"type\": \"fixed\",\n          \"setting\": {\n            \"attach\": \"right\",\n            \"togglable\": false\n          }\n        }\n      }\n    } as any;\n\n    if(!appConfig.layouts){\n      appConfig.layouts = defaultAppLayout;\n    }else if(!appConfig.layouts['__app_layout']){\n      appConfig.layouts = Object.assign(appConfig.layouts, defaultAppLayout);\n    }\n    return appConfig;\n  }\n\n\n  addDefaultLabelAndIcon(appConfig: AppConfig){\n    getAllWidgets(appConfig as IMAppConfig).forEach(widgetJson => {\n      addWidgetDefaultLabelAndIcon(widgetJson);\n    });\n\n  }\n}\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport * as invariant from 'invariant';\n\nimport {ImmutableObject} from 'seamless-immutable';\nimport debounce = require(\"lodash.debounce\");\nimport {connect} from 'react-redux';\nimport ConfigManager from './config-manager';\nimport {IMAppConfig} from './types/app-config';\nimport * as actions from './app-actions';\n\nimport JimuLayout from './layouts/layout-entry';\nimport JimuLayoutViewer from './layouts/layout-viewer-entry';\nimport { AppConfig, IMPageJson } from './types/app-config';\nimport { generateLayoutStructure } from './layouts/utils';\nimport { GlobalLayouts, Layout, AttachType, SidebarItemSetting } from './layouts/types';\nimport {UrlParameters} from './types/url-parameters';\nimport { isMobileSize } from './utils/utils';\n\ninterface Props{\n  dispatch;\n  appConfig: IMAppConfig;\n  queryObject: UrlParameters;\n  isMobile: boolean;\n}\n\nclass AppRootComponent extends React.PureComponent<Props, {width: number, height: number}>{\n  rootRef;\n  mounted: boolean;\n  _debouncedResize;\n\n  constructor(props){\n    super(props);\n    this.rootRef = React.createRef();\n    this.mounted = false;\n  }\n\n  componentDidMount(){\n    ConfigManager.getInstance().loadAppConfig().then(appConfig => {\n      this.props.dispatch(actions.appConfigLoaded(appConfig));\n\n      this.props.dispatch(actions.initStoreExtensionState());\n    });\n    this._debouncedResize = debounce(this.updateDimensions.bind(this), 100);\n    window.addEventListener(\"resize\", this._debouncedResize);\n    this.mounted = true;\n    const node: HTMLElement = this.rootRef.current;\n    const rect = node.getBoundingClientRect();\n    this.setState({\n      width: rect.width,\n      height: rect.height\n    });\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"resize\", this._debouncedResize);\n  }\n\n  updateDimensions() {\n    const windowWidth = window.innerWidth ||\n      document.documentElement.clientWidth ||\n      document.body.clientWidth\n    const windowHeight = window.innerHeight ||\n      document.documentElement.clientHeight ||\n      document.body.clientHeight\n    this.setState({ width: windowWidth, height: windowHeight });\n\n    let isMobile = isMobileSize({ width: windowWidth, height: windowHeight });\n    if(this.props.isMobile !== isMobile){\n      this.props.dispatch(actions.isMobileChanged(isMobile));\n    }\n  }\n\n  _prepareLayout() {\n\n  }\n\n  render(){\n    if (!this.mounted) {\n      return <div style={{height: '100vh', width: '100vw'}} ref={this.rootRef}></div>;\n    }\n\n    if(!this.props.appConfig) {\n      return <div style={{height: '100vh', width: '100vw', display: 'flex', justifyContent: 'center', alignItems: 'center'}}>Loading...</div>;\n    }\n    const pageId = this.props.queryObject.page ? this.props.queryObject.page: 'default';\n    const page = this.props.appConfig.pages[pageId];\n    const layoutId = this.props.isMobile && page.mobileLayout ? page.mobileLayout : page.layout;\n\n    const rootLayout = preparePageLayout(page, this.props.appConfig, this.props.isMobile);\n    let skin = this.props.appConfig.skin;\n    let skinsFolder = window.amdRequire.toUrl('skins');\n    const {width, height} = this.state;\n    return <div ref={this.rootRef} style={{width: '100%', height: '100%'}}>\n        { skin ? ReactDOM.createPortal(\n        <link type=\"text/css\" rel=\"stylesheet\" href={`${skinsFolder}/${skin}/index.css`} />,\n        document.head) : null }\n        {renderPageLayout(page, rootLayout, width, height)}\n    </div>;\n  }\n}\n\nconst mapStateToProps = state => {\n  return {\n    appConfig: state.appConfig,\n    queryObject: state.queryObject,\n    isMobile: state.appContext.isMobile\n  };\n};\n\nexport default connect(mapStateToProps)(AppRootComponent)\n\nfunction renderPageLayout(pageJson: IMPageJson, layout: Layout, width: number, height: number) {\n  if (window.jimuConfig.isInBuilder) {\n    return <div className='page'>\n      <JimuLayout layout={layout} width={width} height={height}></JimuLayout>\n    </div>;\n  }\n  return <div className='page'>\n    <JimuLayoutViewer layout={layout} width={width} height={height}></JimuLayoutViewer>\n  </div>;\n}\n\nfunction preparePageLayout(page: IMPageJson, appConfig: ImmutableObject<AppConfig>, isMobile: boolean) {\n  const layoutId = isMobile && page.mobileLayout ? page.mobileLayout : page.layout;\n  const layout = appConfig.layouts[layoutId];\n  invariant(layout, `Unknown layout id. ${layoutId}`);\n  const pageBodyLayout = generateLayoutStructure(layoutId, appConfig.layouts as GlobalLayouts);\n\n  let sa = appConfig.sharedArea;\n  if(sa) {\n    const saLayoutId = isMobile && sa.mobileLayout ? sa.mobileLayout : sa.layout;\n    const saLayout = appConfig.layouts[saLayoutId];\n    invariant(layout, `Unknown sharedArea layout id. ${saLayoutId}`);\n    const filterSaLayout = handleSharedArea(sa, saLayout as {[key:string]: Layout}, page);\n    const filterLayouts = appConfig.layouts.set(saLayoutId, filterSaLayout);\n    let pageLayout = generateLayoutStructure(saLayoutId, filterLayouts as GlobalLayouts);\n    pageLayout = pageLayout.update('content', value => [].concat(pageLayout.content || [], pageBodyLayout));\n    return pageLayout;\n  } else {\n    return pageBodyLayout;\n  }\n}\n\nfunction handleSharedArea(sharedArea, saLayout: {[key:string]: Layout}, page: IMPageJson){\n  const layout = {};\n  let keys = ['header', 'footer', 'leftArea', 'rightArea'];\n\n  //shared area must use sidebar-layout\n  Object.keys(saLayout).forEach(key => {\n    const setting = saLayout[key].setting as SidebarItemSetting || {};\n    switch (setting.attach) {\n      case AttachType.TOP: {\n        if(sharedArea['header'] && page.sharedArea && page.sharedArea.header){\n          layout[key] = saLayout[key];\n        }\n        break;\n      }\n      case AttachType.BOTTOM: {\n        if(sharedArea['footer'] && page.sharedArea && page.sharedArea.footer){\n          layout[key] = saLayout[key];\n        }\n        break;\n      }\n      case AttachType.LEFT: {\n        if(sharedArea['leftArea'] && page.sharedArea && page.sharedArea.leftArea){\n          layout[key] = saLayout[key];\n        }\n        break;\n      }\n      case AttachType.RIGHT: {\n        if(sharedArea['rightArea'] && page.sharedArea && page.sharedArea.rightArea){\n          layout[key] = saLayout[key];\n        }\n        break;\n      }\n      default: {\n        // if (saLayout[key].type === LayoutType.SIDEBAR_LAYOUT) {\n          layout[key] = saLayout[key]\n        // }\n        break;\n      }\n    }\n  })\n  return layout;\n}\n\n","import * as SeamlessImmutable from 'seamless-immutable';\nimport {ImmutableObject} from \"seamless-immutable\";\n\nimport {ActionKeys, ActionTypes, AppConfigChangedAction, WidgetStatePropChangeAction, QueryObjectChangedAction} from './app-actions';\nimport {State, IMState, IMRuntimeInfo, DataSourceInfo} from './types/state';\nimport {IMWidgetJson, WidgetJson} from './types/app-config';\nimport {AppMode} from './types/constants';\nimport ExtensionManager from './extension-manager';\nimport {ExtensionPoints, ReduxStoreExtension} from './extension-spec/extension-spec';\nimport {DataSourceStatus} from './data-source/base-types';\n\n\nexport default function rootReducer(state: IMState, action: ActionTypes){\n  if(!state){\n    return initState();\n  }\n  switch(action.type){\n    case ActionKeys.InitStoreExtensionState:\n      return initStoreExtensionState(state);\n    case ActionKeys.AppConfigLoaded:\n      let s = state.set('appConfig', action.appConfig);\n      if(action.appConfig.attributes.portalUrl){\n        s = s.set('portalUrl', action.appConfig.attributes.portalUrl);\n      }\n      return s;\n    case ActionKeys.InitPortalUrl:\n      return state.set('portalUrl', action.portalUrl);\n    case ActionKeys.AppConfigChanged:\n      return handleAppConfigChange(state, action);\n    case ActionKeys.AppModeChanged:\n      return state.set('appMode', action.mode);\n    case ActionKeys.AppContextInit:\n      return state.set('appContext', action.appContext);\n    case ActionKeys.JimuCoreNlsLoaded:\n      return state.set('jimuCoreNls', action.nls);\n    case ActionKeys.QueryObjectChanged:\n      return handleQueryObjectChange(state, action);\n      \n    case ActionKeys.SetAppInBuilder:\n      return state.set('appContext', state.appContext.merge({isInBuilder: true}));\n\n    case ActionKeys.WidgetClassLoaded:\n      return handleWidgetClassLoaded(state, action.widgetId);\n    case ActionKeys.OpenWidget:\n      return handleOpenWidet(state, action.widgetId);\n    case ActionKeys.CloseWidget:\n      return handleCloseWidet(state, action.widgetId);\n    case ActionKeys.ToggleWidgetHighLight:\n      return toggleWidgetHighlight(state, action.widgetId, action.isHighlight);\n    case ActionKeys.SetWidgetIsSettingState:\n      if(action.isSetting === false){\n        return state.setIn(['widgetsRuntimeInfo', action.widgetId, 'isSetting'], false);\n      }\n      //only one widget can be is setting\n      Object.keys(state.widgetsRuntimeInfo).forEach(wId => {\n        if(state.widgetsRuntimeInfo[wId].isSetting){\n          state = state.setIn(['widgetsRuntimeInfo', wId, 'isSetting'], false);\n        }\n      });\n      return state.setIn(['widgetsRuntimeInfo', action.widgetId, 'isSetting'], true);\n\n    case ActionKeys.LayoutClassLoaded:\n      return state.setIn(['isLayoutClassLoaded', action.layoutName], true);\n\n    case ActionKeys.DataSourceStatusChanged:\n      return state.setIn(['dataSourcesInfo', action.dataSourceId, 'status'], action.status);\n      \n    case ActionKeys.WidgetStatePropChange:\n      return handleWidgetPropChange(state, action);\n    \n    case ActionKeys.DataSourceCurrentIndexesChanged:\n      return state.setIn(['dataSourcesInfo', action.dataSourceId, 'currentIndexes'], action.currentIndexes);\n\n    case ActionKeys.SessionStart:\n      return state.set('token', action.token);\n    case ActionKeys.UserSignIn:\n      return state.set('user', SeamlessImmutable(action.user));\n    case ActionKeys.UserSignOut:\n      return state.merge({ token: null, user: null });\n    \n    case ActionKeys.IsMobileChanged:\n      return state.setIn(['appContext', 'isMobile'], action.isMobile);\n\n    default:\n      return dispatchActionToExtension(state, action);\n  }\n}\n\nfunction initState(): IMState{\n  const INIT_STATE: State = ({\n    appConfig: null,\n    // TODO: how to get portal URL from environment config?\n    portalUrl: 'https://www.arcgis.com/sharing/rest',\n    widgetsRuntimeInfo: SeamlessImmutable({}) as ImmutableObject<{[id: string]: IMRuntimeInfo}>,\n\n    appContext: null,\n\n    appMode: AppMode.Run,\n    jimuCoreNls: null,\n    queryObject: null,\n\n    dataSourcesInfo: SeamlessImmutable({}) as ImmutableObject<{[dsId: string]: DataSourceInfo}>,\n\n    widgetState: {},\n\n    token: null,\n    user: null\n  });\n\n  return SeamlessImmutable(INIT_STATE);\n}\n\nfunction initStoreExtensionState(state: IMState): IMState{\n  let extensions = ExtensionManager.getInstance().getExtensions(ExtensionPoints.ReduxStore);\n  for(let i = 0; i < extensions.length; i++){\n    let storeExt = extensions[i] as ReduxStoreExtension;\n    let storeKeySegs = storeExt.getStoreKey().split('.');\n    if(state.getIn(storeKeySegs)){\n      continue;\n    }\n    state = state.setIn(storeKeySegs, storeExt.getInitLocalState());\n  }\n\n  return state;\n}\n\nfunction dispatchActionToExtension(state: IMState, action): IMState{\n  let extensions = ExtensionManager.getInstance().getExtensions(ExtensionPoints.ReduxStore);\n  for(let i = 0; i < extensions.length; i++){\n    let storeExt = extensions[i] as ReduxStoreExtension;\n    if(storeExt.getActions().indexOf(action.type) > -1){\n      let storeKeySegs = storeExt.getStoreKey().split('.');\n      let localState = state.getIn(storeKeySegs);\n      return state.setIn(storeKeySegs, storeExt.getReducer()(localState, action, state));\n    }\n  }\n\n  return state;\n}\n\nfunction handleAppConfigChange(state: IMState, action: AppConfigChangedAction){\n  state = state.set('appConfig', action.appConfig);\n  state = state.set('widgetsRuntimeInfo', state.widgetsRuntimeInfo.without.apply(state.widgetsRuntimeInfo, action.appConfigDiff.removedWidgets));\n  return state;\n}\n\nfunction handleQueryObjectChange(state: IMState, action: QueryObjectChangedAction){\n  state = state.set('queryObject', SeamlessImmutable(action.query));\n  return state;\n}\n\nfunction handleWidgetPropChange(state: IMState, action: WidgetStatePropChangeAction){\n  let storeKeySegs = action.propKey.split('.');\n  return state.setIn(['widgetState', action.widgetId].concat(storeKeySegs), action.value);\n}\n\nfunction handleWidgetClassLoaded(state: IMState, widgetId: string){\n  if(!state.widgetsRuntimeInfo[widgetId]){\n    return state.setIn(['widgetsRuntimeInfo', widgetId], {\n      isClassLoaded: true,\n      state: 'closed',\n      windowState: 'normal',\n    } as IMRuntimeInfo);\n  }\n  if(state.widgetsRuntimeInfo[widgetId].isClassLoaded){\n    return state;\n  }\n\n  return state.setIn(['widgetsRuntimeInfo', widgetId, 'isClassLoaded'], true);\n}\n\nfunction handleOpenWidet(state: IMState, widgetId: string){\n  if(state.widgetsRuntimeInfo[widgetId].state !== 'closed'){\n    return state;\n  }\n\n  return state.setIn(['widgetsRuntimeInfo', widgetId, 'state'], 'opened');\n}\n\nfunction handleCloseWidet(state: IMState, widgetId: string){\n  if(state.widgetsRuntimeInfo[widgetId].state === 'closed'){\n    return state;\n  }\n\n  return state.setIn(['widgetsRuntimeInfo', widgetId, 'state'], 'closed');\n}\n\nfunction toggleWidgetHighlight(state: IMState, widgetId: string, isHighlight: boolean){\n  if(isHighlight === false){\n    return state.setIn(['widgetsRuntimeInfo', widgetId, 'isHighlight'], false);\n  }\n  //only one widget can be is highlight\n  Object.keys(state.widgetsRuntimeInfo).forEach(wId => {\n    if(state.widgetsRuntimeInfo[wId].isHighlight){\n      state = state.setIn(['widgetsRuntimeInfo', wId, 'isHighlight'], false);\n    }\n  });\n  return state.setIn(['widgetsRuntimeInfo', widgetId, 'isHighlight'], true);\n}\n//////////////////////// handle actions to app\n\nfunction handleWidgetChanged(state: IMState, widgetJson: WidgetJson){\n  // this._updateDataSourceForWidget(newJson);\n  // let oldJson = state.appConfig.getConfigElementById(widgetJson.id).asMutable();\n\n  // oldJson.label = widgetJson.label;\n  // oldJson.icon = widgetJson.icon;\n  // oldJson.config = widgetJson.config;\n\n  // return state.set('appConfig', state.appConfig.updateConfigElementJson(oldJson));\n  return state;\n}\n/////////////////////utils\n\n\n","import * as React from 'react';\nimport {Provider } from 'react-redux';\nimport {store} from './store';\nimport ConfigManager from './config-manager';\nimport * as actions from './app-actions';\nimport AppRootComponent from './app-root-component';\nimport {HistoryProvider} from './browser-history';\n\n\ninterface ErrorState{\n  error: Error;\n}\nclass ErrorBoundary extends React.Component<{}, ErrorState> {\n  constructor(props) {\n    super(props);\n    this.state = { error: null };\n  }\n\n  componentDidCatch(error, info) {\n    // Display fallback UI\n    this.setState({ error: error });\n  }\n\n  render() {\n    if (this.state.error) {\n      return <h1>this.state.error</h1>;\n    }\n    return this.props.children;\n  }\n}\n\ninterface State{\n  appConfigLoaded: boolean;\n}\n\nexport default class AppRoot extends React.PureComponent<{}, State>{\n  constructor(props){\n    super(props);\n  }\n\n  render(){\n    return <Provider store={store}>\n      <ErrorBoundary>\n        <HistoryProvider>\n          <AppRootComponent/>\n        </HistoryProvider>\n      </ErrorBoundary>\n    </Provider>;\n  }\n}\n\n","import * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport * as ReactRedux from 'react-redux';\nimport * as queryString from 'query-string';\nimport * as SeamlessImmutable from 'seamless-immutable';\nimport * as classNames from 'classnames';\nimport {ImmutableObject, ImmutableArray} from 'seamless-immutable';\n\nimport I18NManager from './lib/i18n-manager';\nimport ExtensionManager from './lib/extension-manager';\nimport {ExtensionPoints} from './lib/extension-spec/extension-spec';\nimport AppRoot from './lib/app-root';\nimport {isMobileBrowser, isMobileSize} from './lib/utils/utils';\nimport {listenBuilderEvents, publishAppStateChangeToBuilder} from './lib/app-builder-sync';\nimport {store} from './lib/store';\nimport {AppContext} from './lib/types/state';\nimport {initAppContext, jimuCoreNlsLoaded, queryObjectChanged} from './lib/app-actions';\nimport {LayoutInfo} from './lib/layouts/types';\nimport * as layoutActions from './lib/layouts/actions/global-layout-actions';\nimport BaseWidget from './lib/base-widget';\nimport WidgetManager from './lib/widget-manager';\nimport DataSourceManager from './lib/data-source-manager';\nimport MessageManager from './lib/message-manager';\nimport SessionManager from './lib/session-manager';\nimport * as appActions from './lib/app-actions';\nimport * as appBuilderSync from './lib/app-builder-sync';\nimport * as extensionSpec from './lib/extension-spec/extension-spec';\nimport * as utils from './lib/utils/utils';\nimport * as urlUtils from './lib/utils/url-utils';\nimport * as appConfigUtils from './lib/utils/app-config';\n\nexport {AppRoot, React, ReactDOM, ExtensionManager, ExtensionPoints, BaseWidget, WidgetManager, DataSourceManager, urlUtils, SessionManager, LayoutInfo, layoutActions,\nappActions, appBuilderSync, extensionSpec, utils, appConfigUtils, store, ReactRedux, I18NManager, MessageManager, SeamlessImmutable, ImmutableArray, ImmutableObject, classNames,\n};\n\nexport * from './lib/types/props';\nexport * from './lib/types/state';\nexport * from './lib/types/app-config';\nexport * from './lib/types/jimu-config';\nexport * from './lib/types/url-parameters';\nexport * from './lib/types/state';\nexport * from './lib/types/app-info';\nexport * from './lib/types/manifest';\nexport * from './lib/data-source/base-types';\nexport * from './lib/amd-loader';\nexport * from './lib/message/base-types';\nexport * from './lib/types/constants';\nexport * from './lib/browser-history';\n\nexport function init(): Promise<void>{\n  let isMobile = isMobileSize({\n    width: window.innerWidth,\n    height: window.innerHeight\n  });\n  let queryObject = queryString.parse(location.search);\n  \n  let appContext:AppContext = {\n    isInBuilder: window.jimuConfig.isInBuilder,\n    isBuilder: window.jimuConfig.isBuilder,\n    locale: window.jimuConfig.locale,\n    appPath: window.jimuConfig.appPath,\n    isRTL: isRTL(window.jimuConfig.locale),\n    isMobile: isMobile\n  };\n\n  setRTL(appContext.locale);\n  store.dispatch(initAppContext(appContext));\n  store.dispatch(queryObjectChanged(queryObject));\n\n  if(!window.jimuConfig.isBuilder){\n    listenBuilderEvents();\n  }\n\n  let currentState = store.getState();\n  store.subscribe(() => {\n    if(!window.jimuConfig.isBuilder){\n      if(currentState !== store.getState()){\n        currentState = store.getState();\n        publishAppStateChangeToBuilder();\n      }\n    }\n\n    window._appState = store.getState();\n  });\n\n  return I18NManager.getInstance().loadNls('jimu-core/lib/nls/strings').then((jimuNls) => {\n    store.dispatch(jimuCoreNlsLoaded(jimuNls))\n    return;\n  })\n}\n\nfunction localeIsSame(locale1, locale2){\n  return locale1.split('-')[0] === locale2.split('-')[0];\n}\n\nfunction isRTL(locale){\n  var isRTLLocale = false;\n  var rtlLocales = [\"ar\", \"he\"];\n  for (var i = 0; i < rtlLocales.length; i++) {\n    if (localeIsSame(rtlLocales[i], locale)) {\n      isRTLLocale = true;\n    }\n  }\n  return isRTLLocale;\n}\n\nfunction setRTL(locale){\n  var dirNode = document.getElementsByTagName(\"html\")[0];\n  let isRTLLocale = isRTL(locale);\n\n  if (isRTLLocale) {\n    dirNode.setAttribute(\"dir\", \"rtl\");\n    dirNode.className += \" esriRtl jimu-rtl\";\n    dirNode.className += \" \" + locale + \" \" +\n      (locale.indexOf(\"-\") !== -1 ? locale.split(\"-\")[0] : \"\");\n  }else {\n    dirNode.setAttribute(\"dir\", \"ltr\");\n    dirNode.className += \" esriLtr jimu-ltr\";\n    dirNode.className += \" \" + locale + \" \" +\n      (locale.indexOf(\"-\") !== -1 ? locale.split(\"-\")[0] : \"\");\n  }\n}\n"],"sourceRoot":""}